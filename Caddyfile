# Bijmantra Caddy Configuration
# Automatic HTTPS and reverse proxy

{
    # Global options
    email admin@example.com  # Change this for Let's Encrypt
}

# Development configuration (localhost)
localhost {
    # API routes
    handle /brapi/* {
        reverse_proxy backend:8000
    }

    handle /api/* {
        reverse_proxy backend:8000
    }

    handle /docs* {
        reverse_proxy backend:8000
    }

    handle /redoc* {
        reverse_proxy backend:8000
    }

    handle /openapi.json {
        reverse_proxy backend:8000
    }

    # Frontend (React PWA)
    handle /* {
        root * /srv/frontend
        try_files {path} /index.html
        file_server
    }

    # Logging
    log {
        output file /var/log/caddy/access.log
    }
}

# Production configuration (uncomment and modify for production)
# your-domain.com {
#     # API routes
#     handle /brapi/* {
#         reverse_proxy backend:8000
#     }
#
#     handle /api/* {
#         reverse_proxy backend:8000
#     }
#
#     # Frontend (React PWA)
#     handle /* {
#         root * /srv/frontend
#         try_files {path} /index.html
#         file_server
#         
#         # PWA headers
#         header {
#             # Security headers
#             Strict-Transport-Security "max-age=31536000; includeSubDomains; preload"
#             X-Content-Type-Options "nosniff"
#             X-Frame-Options "SAMEORIGIN"
#             X-XSS-Protection "1; mode=block"
#             
#             # PWA headers
#             Cache-Control "public, max-age=31536000, immutable"
#             Service-Worker-Allowed "/"
#         }
#     }
#
#     # Logging
#     log {
#         output file /var/log/caddy/access.log
#     }
# }
