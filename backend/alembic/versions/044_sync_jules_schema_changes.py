"""sync_jules_schema_changes

Revision ID: 044
Revises: 043
Create Date: 2026-02-02 09:02:09.549633+00:00

"""
from alembic import op
import sqlalchemy as sa
from sqlalchemy.dialects import postgresql
import geoalchemy2

# revision identifiers, used by Alembic.
revision = '044'
down_revision = '043'
branch_labels = None
depends_on = None


def upgrade() -> None:
    # ### commands auto generated by Alembic - please adjust! ###
    op.create_table('annotation_tasks',
    sa.Column('dataset_id', sa.String(), nullable=False),
    sa.Column('name', sa.String(), nullable=False),
    sa.Column('annotation_type', sa.Enum('CLASSIFICATION', 'BOUNDING_BOX', 'SEGMENTATION', 'KEYPOINTS', name='annotationtype'), nullable=False),
    sa.Column('status', sa.Enum('PENDING', 'IN_PROGRESS', 'COMPLETED', 'REVIEW', 'APPROVED', 'REJECTED', name='annotationstatus'), nullable=False),
    sa.Column('priority', sa.String(), nullable=True),
    sa.Column('description', sa.Text(), nullable=True),
    sa.Column('total_images', sa.Integer(), nullable=True),
    sa.Column('completed_images', sa.Integer(), nullable=True),
    sa.Column('assigned_to', sa.JSON(), nullable=True),
    sa.Column('completed_at', sa.DateTime(timezone=True), nullable=True),
    sa.Column('id', sa.Integer(), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=False),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index(op.f('ix_annotation_tasks_dataset_id'), 'annotation_tasks', ['dataset_id'], unique=False)
    op.create_index(op.f('ix_annotation_tasks_id'), 'annotation_tasks', ['id'], unique=False)
    op.create_table('vision_annotations',
    sa.Column('image_id', sa.String(), nullable=False),
    sa.Column('dataset_id', sa.String(), nullable=False),
    sa.Column('annotation_type', sa.Enum('CLASSIFICATION', 'BOUNDING_BOX', 'SEGMENTATION', 'KEYPOINTS', name='annotationtype'), nullable=False),
    sa.Column('data', sa.JSON(), nullable=False),
    sa.Column('status', sa.Enum('PENDING', 'IN_PROGRESS', 'COMPLETED', 'REVIEW', 'APPROVED', 'REJECTED', name='annotationstatus'), nullable=False),
    sa.Column('annotator_id', sa.String(), nullable=False),
    sa.Column('reviewer_id', sa.String(), nullable=True),
    sa.Column('review_notes', sa.Text(), nullable=True),
    sa.Column('id', sa.Integer(), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=False),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index(op.f('ix_vision_annotations_annotator_id'), 'vision_annotations', ['annotator_id'], unique=False)
    op.create_index(op.f('ix_vision_annotations_dataset_id'), 'vision_annotations', ['dataset_id'], unique=False)
    op.create_index(op.f('ix_vision_annotations_id'), 'vision_annotations', ['id'], unique=False)
    op.create_index(op.f('ix_vision_annotations_image_id'), 'vision_annotations', ['image_id'], unique=False)
    op.create_index(op.f('ix_vision_annotations_reviewer_id'), 'vision_annotations', ['reviewer_id'], unique=False)
    op.create_table('vision_models',
    sa.Column('organization_id', sa.Integer(), nullable=False),
    sa.Column('name', sa.String(), nullable=False),
    sa.Column('description', sa.Text(), nullable=True),
    sa.Column('version', sa.String(), nullable=False),
    sa.Column('format', sa.String(), nullable=False),
    sa.Column('file_path', sa.String(), nullable=False),
    sa.Column('metrics', sa.JSON(), nullable=True),
    sa.Column('size_bytes', sa.Integer(), nullable=True),
    sa.Column('is_public', sa.Boolean(), nullable=True),
    sa.Column('created_by', sa.String(), nullable=True),
    sa.Column('id', sa.Integer(), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=False),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index(op.f('ix_vision_models_id'), 'vision_models', ['id'], unique=False)
    op.create_index(op.f('ix_vision_models_organization_id'), 'vision_models', ['organization_id'], unique=False)
    op.create_table('annotation_task_items',
    sa.Column('task_id', sa.Integer(), nullable=False),
    sa.Column('image_id', sa.String(), nullable=False),
    sa.Column('status', sa.Enum('PENDING', 'IN_PROGRESS', 'COMPLETED', 'REVIEW', 'APPROVED', 'REJECTED', name='annotationstatus'), nullable=False),
    sa.Column('annotation_id', sa.Integer(), nullable=True),
    sa.Column('assigned_to', sa.String(), nullable=True),
    sa.Column('id', sa.Integer(), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=False),
    sa.ForeignKeyConstraint(['annotation_id'], ['vision_annotations.id'], ),
    sa.ForeignKeyConstraint(['task_id'], ['annotation_tasks.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index(op.f('ix_annotation_task_items_id'), 'annotation_task_items', ['id'], unique=False)
    op.create_table('budget_categories',
    sa.Column('organization_id', sa.Integer(), nullable=False),
    sa.Column('name', sa.String(length=255), nullable=False),
    sa.Column('allocated', sa.Float(), nullable=True),
    sa.Column('color', sa.String(length=50), nullable=True),
    sa.Column('year', sa.Integer(), nullable=False),
    sa.Column('id', sa.Integer(), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=False),
    sa.ForeignKeyConstraint(['organization_id'], ['organizations.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index(op.f('ix_budget_categories_id'), 'budget_categories', ['id'], unique=False)
    op.create_index(op.f('ix_budget_categories_organization_id'), 'budget_categories', ['organization_id'], unique=False)
    op.create_table('print_jobs',
    sa.Column('organization_id', sa.Integer(), nullable=False),
    sa.Column('job_id', sa.String(length=50), nullable=False),
    sa.Column('template_id', sa.String(length=50), nullable=False),
    sa.Column('status', sa.Enum('pending', 'processing', 'completed', 'failed', 'cancelled', name='printjobstatus'), nullable=True),
    sa.Column('completed_at', sa.DateTime(timezone=True), nullable=True),
    sa.Column('label_count', sa.Integer(), nullable=True),
    sa.Column('copies', sa.Integer(), nullable=True),
    sa.Column('items', sa.JSON(), nullable=True),
    sa.Column('created_by', sa.String(length=255), nullable=True),
    sa.Column('id', sa.Integer(), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=False),
    sa.ForeignKeyConstraint(['organization_id'], ['organizations.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index(op.f('ix_print_jobs_id'), 'print_jobs', ['id'], unique=False)
    op.create_index(op.f('ix_print_jobs_job_id'), 'print_jobs', ['job_id'], unique=True)
    op.create_index(op.f('ix_print_jobs_organization_id'), 'print_jobs', ['organization_id'], unique=False)
    op.create_index(op.f('ix_print_jobs_status'), 'print_jobs', ['status'], unique=False)
    op.create_table('speed_breeding_chambers',
    sa.Column('organization_id', sa.Integer(), nullable=False),
    sa.Column('name', sa.String(length=255), nullable=False),
    sa.Column('location', sa.String(length=255), nullable=True),
    sa.Column('status', sa.String(length=50), nullable=True),
    sa.Column('capacity', sa.Integer(), nullable=True),
    sa.Column('current_temperature', sa.Float(), nullable=True),
    sa.Column('current_humidity', sa.Float(), nullable=True),
    sa.Column('current_light_hours', sa.Float(), nullable=True),
    sa.Column('id', sa.Integer(), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=False),
    sa.ForeignKeyConstraint(['organization_id'], ['organizations.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index(op.f('ix_speed_breeding_chambers_id'), 'speed_breeding_chambers', ['id'], unique=False)
    op.create_index(op.f('ix_speed_breeding_chambers_organization_id'), 'speed_breeding_chambers', ['organization_id'], unique=False)
    op.create_table('speed_breeding_protocols',
    sa.Column('organization_id', sa.Integer(), nullable=False),
    sa.Column('name', sa.String(length=255), nullable=False),
    sa.Column('description', sa.Text(), nullable=True),
    sa.Column('crop', sa.String(length=100), nullable=True),
    sa.Column('photoperiod', sa.Integer(), nullable=True),
    sa.Column('temperature_day', sa.Float(), nullable=True),
    sa.Column('temperature_night', sa.Float(), nullable=True),
    sa.Column('humidity', sa.Float(), nullable=True),
    sa.Column('light_intensity', sa.Float(), nullable=True),
    sa.Column('days_to_flower', sa.Integer(), nullable=True),
    sa.Column('days_to_harvest', sa.Integer(), nullable=True),
    sa.Column('generations_per_year', sa.Float(), nullable=True),
    sa.Column('success_rate', sa.Float(), nullable=True),
    sa.Column('status', sa.String(length=50), nullable=True),
    sa.Column('id', sa.Integer(), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=False),
    sa.ForeignKeyConstraint(['organization_id'], ['organizations.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index(op.f('ix_speed_breeding_protocols_crop'), 'speed_breeding_protocols', ['crop'], unique=False)
    op.create_index(op.f('ix_speed_breeding_protocols_id'), 'speed_breeding_protocols', ['id'], unique=False)
    op.create_index(op.f('ix_speed_breeding_protocols_organization_id'), 'speed_breeding_protocols', ['organization_id'], unique=False)
    op.create_table('vision_deployments',
    sa.Column('organization_id', sa.Integer(), nullable=False),
    sa.Column('model_id', sa.Integer(), nullable=False),
    sa.Column('target', sa.String(), nullable=False),
    sa.Column('format', sa.String(), nullable=False),
    sa.Column('endpoint_url', sa.String(), nullable=False),
    sa.Column('status', sa.String(), nullable=True),
    sa.Column('requests_count', sa.Integer(), nullable=True),
    sa.Column('avg_latency_ms', sa.Float(), nullable=True),
    sa.Column('id', sa.Integer(), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=False),
    sa.ForeignKeyConstraint(['model_id'], ['vision_models.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index(op.f('ix_vision_deployments_id'), 'vision_deployments', ['id'], unique=False)
    op.create_index(op.f('ix_vision_deployments_organization_id'), 'vision_deployments', ['organization_id'], unique=False)
    op.create_table('expenses',
    sa.Column('organization_id', sa.Integer(), nullable=False),
    sa.Column('budget_category_id', sa.Integer(), nullable=False),
    sa.Column('description', sa.String(length=255), nullable=False),
    sa.Column('amount', sa.Float(), nullable=False),
    sa.Column('date', sa.DateTime(), nullable=False),
    sa.Column('project', sa.String(length=255), nullable=True),
    sa.Column('id', sa.Integer(), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=False),
    sa.ForeignKeyConstraint(['budget_category_id'], ['budget_categories.id'], ),
    sa.ForeignKeyConstraint(['organization_id'], ['organizations.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index(op.f('ix_expenses_id'), 'expenses', ['id'], unique=False)
    op.create_index(op.f('ix_expenses_organization_id'), 'expenses', ['organization_id'], unique=False)
    op.create_table('proposals',
    sa.Column('organization_id', sa.Integer(), nullable=False),
    sa.Column('user_id', sa.Integer(), nullable=True),
    sa.Column('title', sa.String(length=255), nullable=False),
    sa.Column('description', sa.Text(), nullable=True),
    sa.Column('action_type', sa.Enum('create_trial', 'create_cross', 'record_observation', 'generate_report', 'sql_query', 'custom', name='actiontype'), nullable=False),
    sa.Column('status', sa.Enum('draft', 'pending_review', 'approved', 'rejected', 'executed', 'failed', name='proposalstatus'), nullable=True),
    sa.Column('target_data', sa.JSON(), nullable=True),
    sa.Column('ai_rationale', sa.Text(), nullable=True),
    sa.Column('confidence_score', sa.Integer(), nullable=True),
    sa.Column('reviewer_notes', sa.Text(), nullable=True),
    sa.Column('execution_result', sa.JSON(), nullable=True),
    sa.Column('executed_at', sa.DateTime(), nullable=True),
    sa.Column('created_by_ai', sa.Boolean(), nullable=True),
    sa.Column('id', sa.Integer(), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=False),
    sa.ForeignKeyConstraint(['organization_id'], ['organizations.id'], ),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index(op.f('ix_proposals_id'), 'proposals', ['id'], unique=False)
    op.create_index(op.f('ix_proposals_organization_id'), 'proposals', ['organization_id'], unique=False)
    op.create_index(op.f('ix_proposals_user_id'), 'proposals', ['user_id'], unique=False)
    op.create_table('shared_items',
    sa.Column('organization_id', sa.Integer(), nullable=False),
    sa.Column('item_type', sa.String(length=50), nullable=False),
    sa.Column('item_id', sa.String(length=100), nullable=False),
    sa.Column('shared_by_id', sa.Integer(), nullable=False),
    sa.Column('shared_with_id', sa.Integer(), nullable=False),
    sa.Column('permission', sa.String(length=20), nullable=True),
    sa.Column('shared_at', sa.DateTime(), nullable=True),
    sa.Column('id', sa.Integer(), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=False),
    sa.ForeignKeyConstraint(['organization_id'], ['organizations.id'], ),
    sa.ForeignKeyConstraint(['shared_by_id'], ['users.id'], ),
    sa.ForeignKeyConstraint(['shared_with_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index(op.f('ix_shared_items_id'), 'shared_items', ['id'], unique=False)
    op.create_index(op.f('ix_shared_items_organization_id'), 'shared_items', ['organization_id'], unique=False)
    op.create_table('speed_breeding_batches',
    sa.Column('organization_id', sa.Integer(), nullable=False),
    sa.Column('protocol_id', sa.Integer(), nullable=False),
    sa.Column('chamber_id', sa.Integer(), nullable=True),
    sa.Column('name', sa.String(length=255), nullable=False),
    sa.Column('generation', sa.String(length=50), nullable=True),
    sa.Column('entries', sa.Integer(), nullable=True),
    sa.Column('start_date', sa.String(length=50), nullable=True),
    sa.Column('expected_harvest', sa.String(length=50), nullable=True),
    sa.Column('status', sa.String(length=50), nullable=True),
    sa.Column('progress', sa.Integer(), nullable=True),
    sa.Column('id', sa.Integer(), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=False),
    sa.ForeignKeyConstraint(['chamber_id'], ['speed_breeding_chambers.id'], ),
    sa.ForeignKeyConstraint(['organization_id'], ['organizations.id'], ),
    sa.ForeignKeyConstraint(['protocol_id'], ['speed_breeding_protocols.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index(op.f('ix_speed_breeding_batches_id'), 'speed_breeding_batches', ['id'], unique=False)
    op.create_index(op.f('ix_speed_breeding_batches_organization_id'), 'speed_breeding_batches', ['organization_id'], unique=False)
    op.drop_index(op.f('ix_security_threats_category'), table_name='security_threats')
    op.drop_index(op.f('ix_security_threats_severity'), table_name='security_threats')
    op.drop_index(op.f('ix_security_threats_source_ip'), table_name='security_threats')
    op.drop_index(op.f('ix_security_threats_timestamp'), table_name='security_threats')
    op.drop_index(op.f('ix_security_threats_user_id'), table_name='security_threats')
    op.drop_table('security_threats')
    op.drop_index(op.f('idx_scales_org_id'), table_name='scales')
    op.drop_index(op.f('ix_scales_organization_id'), table_name='scales')
    op.drop_index(op.f('ix_scales_scale_db_id'), table_name='scales')
    op.drop_index(op.f('ix_scales_scale_name'), table_name='scales')
    op.drop_table('scales')
    op.drop_index(op.f('idx_observation_levels_org_id'), table_name='observation_levels')
    op.drop_index(op.f('ix_observation_levels_level_name'), table_name='observation_levels')
    op.drop_index(op.f('ix_observation_levels_organization_id'), table_name='observation_levels')
    op.drop_table('observation_levels')
    op.drop_index(op.f('ix_vector_doc_type_source'), table_name='vector_documents')
    op.drop_index(op.f('ix_vector_documents_content_hash'), table_name='vector_documents')
    op.drop_index(op.f('ix_vector_documents_doc_id'), table_name='vector_documents')
    op.drop_index(op.f('ix_vector_documents_doc_type'), table_name='vector_documents')
    op.drop_index(op.f('ix_vector_documents_embedding'), table_name='vector_documents', postgresql_ops={'embedding': 'vector_cosine_ops'}, postgresql_with={'lists': '100'}, postgresql_using='ivfflat')
    op.drop_index(op.f('ix_vector_documents_source_id'), table_name='vector_documents')
    op.drop_index(op.f('ix_vector_documents_source_type'), table_name='vector_documents')
    op.drop_table('vector_documents')
    op.drop_index(op.f('idx_traits_org_id'), table_name='traits')
    op.drop_index(op.f('ix_traits_organization_id'), table_name='traits')
    op.drop_index(op.f('ix_traits_trait_db_id'), table_name='traits')
    op.drop_index(op.f('ix_traits_trait_name'), table_name='traits')
    op.drop_table('traits')
    op.drop_index(op.f('idx_germplasm_attribute_values_org_id'), table_name='germplasm_attribute_values')
    op.drop_index(op.f('ix_germplasm_attribute_values_attribute_db_id'), table_name='germplasm_attribute_values')
    op.drop_index(op.f('ix_germplasm_attribute_values_attribute_value_db_id'), table_name='germplasm_attribute_values')
    op.drop_index(op.f('ix_germplasm_attribute_values_germplasm_id'), table_name='germplasm_attribute_values')
    op.drop_index(op.f('ix_germplasm_attribute_values_organization_id'), table_name='germplasm_attribute_values')
    op.drop_table('germplasm_attribute_values')
    op.drop_index(op.f('ix_audit_actor_timestamp'), table_name='security_audit_log')
    op.drop_index(op.f('ix_audit_severity_timestamp'), table_name='security_audit_log')
    op.drop_index(op.f('ix_audit_source_ip_timestamp'), table_name='security_audit_log')
    op.drop_index(op.f('ix_audit_timestamp_category'), table_name='security_audit_log')
    op.drop_index(op.f('ix_security_audit_log_action'), table_name='security_audit_log')
    op.drop_index(op.f('ix_security_audit_log_actor'), table_name='security_audit_log')
    op.drop_index(op.f('ix_security_audit_log_category'), table_name='security_audit_log')
    op.drop_index(op.f('ix_security_audit_log_severity'), table_name='security_audit_log')
    op.drop_index(op.f('ix_security_audit_log_source_ip'), table_name='security_audit_log')
    op.drop_index(op.f('ix_security_audit_log_target'), table_name='security_audit_log')
    op.drop_index(op.f('ix_security_audit_log_timestamp'), table_name='security_audit_log')
    op.drop_table('security_audit_log')
    # op.drop_table('spatial_ref_sys')
    op.drop_index(op.f('idx_methods_org_id'), table_name='methods')
    op.drop_index(op.f('ix_methods_method_db_id'), table_name='methods')
    op.drop_index(op.f('ix_methods_method_name'), table_name='methods')
    op.drop_index(op.f('ix_methods_organization_id'), table_name='methods')
    op.drop_table('methods')
    op.drop_index(op.f('idx_germplasm_attribute_definitions_org_id'), table_name='germplasm_attribute_definitions')
    op.drop_index(op.f('ix_germplasm_attribute_definitions_attribute_category'), table_name='germplasm_attribute_definitions')
    op.drop_index(op.f('ix_germplasm_attribute_definitions_attribute_db_id'), table_name='germplasm_attribute_definitions')
    op.drop_index(op.f('ix_germplasm_attribute_definitions_attribute_name'), table_name='germplasm_attribute_definitions')
    op.drop_index(op.f('ix_germplasm_attribute_definitions_organization_id'), table_name='germplasm_attribute_definitions')
    op.drop_table('germplasm_attribute_definitions')
    op.drop_index(op.f('ix_blocked_entity'), table_name='security_blocked')
    op.drop_index(op.f('ix_security_blocked_entity_type'), table_name='security_blocked')
    op.drop_index(op.f('ix_security_blocked_entity_value'), table_name='security_blocked')
    op.drop_index(op.f('ix_security_blocked_expires_at'), table_name='security_blocked')
    op.drop_table('security_blocked')
    op.drop_index(op.f('ix_security_responses_action'), table_name='security_responses')
    op.drop_index(op.f('ix_security_responses_target'), table_name='security_responses')
    op.drop_index(op.f('ix_security_responses_threat_id'), table_name='security_responses')
    op.drop_index(op.f('ix_security_responses_timestamp'), table_name='security_responses')
    op.drop_table('security_responses')
    op.drop_index(op.f('idx_abiotic_stresses_org_id'), table_name='abiotic_stresses')
    op.alter_column('activity_logs', 'created_at',
               existing_type=postgresql.TIMESTAMP(),
               type_=sa.DateTime(timezone=True),
               existing_nullable=False)
    op.alter_column('activity_logs', 'updated_at',
               existing_type=postgresql.TIMESTAMP(),
               type_=sa.DateTime(timezone=True),
               existing_nullable=False)
    op.drop_index(op.f('idx_activity_logs_org_id'), table_name='activity_logs')
    op.drop_index(op.f('ix_activity_logs_created_at'), table_name='activity_logs')
    op.create_index(op.f('ix_activity_logs_id'), 'activity_logs', ['id'], unique=False)
    op.drop_constraint(op.f('activity_logs_user_id_fkey'), 'activity_logs', type_='foreignkey')
    op.drop_constraint(op.f('activity_logs_organization_id_fkey'), 'activity_logs', type_='foreignkey')
    op.create_foreign_key(None, 'activity_logs', 'users', ['user_id'], ['id'])
    op.create_foreign_key(None, 'activity_logs', 'organizations', ['organization_id'], ['id'])
    op.create_index(op.f('ix_ai_usage_daily_id'), 'ai_usage_daily', ['id'], unique=False)
    op.create_index(op.f('ix_ai_usage_daily_organization_id'), 'ai_usage_daily', ['organization_id'], unique=False)
    op.alter_column('backups', 'created_at',
               existing_type=postgresql.TIMESTAMP(),
               nullable=True)
    op.alter_column('backups', 'updated_at',
               existing_type=postgresql.TIMESTAMP(),
               nullable=True)
    op.drop_index(op.f('idx_backups_org_id'), table_name='backups')
    op.drop_index(op.f('ix_backups_backup_type'), table_name='backups')
    op.drop_index(op.f('ix_backups_created_at'), table_name='backups')
    op.drop_index(op.f('ix_backups_status'), table_name='backups')
    op.alter_column('breeding_methods', 'created_at',
               existing_type=postgresql.TIMESTAMP(),
               type_=sa.DateTime(timezone=True),
               existing_nullable=False)
    op.alter_column('breeding_methods', 'updated_at',
               existing_type=postgresql.TIMESTAMP(),
               type_=sa.DateTime(timezone=True),
               existing_nullable=False)
    op.drop_index(op.f('idx_breeding_methods_org_id'), table_name='breeding_methods')
    op.alter_column('call_sets', 'created_at',
               existing_type=postgresql.TIMESTAMP(),
               type_=sa.DateTime(timezone=True),
               nullable=False,
               existing_server_default=sa.text('now()'))
    op.alter_column('call_sets', 'updated_at',
               existing_type=postgresql.TIMESTAMP(),
               type_=sa.DateTime(timezone=True),
               nullable=False,
               existing_server_default=sa.text('now()'))
    op.drop_index(op.f('idx_call_sets_org_id'), table_name='call_sets')
    op.create_index(op.f('ix_call_sets_id'), 'call_sets', ['id'], unique=False)
    op.alter_column('calls', 'created_at',
               existing_type=postgresql.TIMESTAMP(),
               type_=sa.DateTime(timezone=True),
               nullable=False,
               existing_server_default=sa.text('now()'))
    op.alter_column('calls', 'updated_at',
               existing_type=postgresql.TIMESTAMP(),
               type_=sa.DateTime(timezone=True),
               nullable=False,
               existing_server_default=sa.text('now()'))
    op.drop_index(op.f('idx_calls_org_id'), table_name='calls')
    op.create_index(op.f('ix_calls_id'), 'calls', ['id'], unique=False)
    op.create_index(op.f('ix_carbon_measurements_id'), 'carbon_measurements', ['id'], unique=False)
    op.alter_column('carbon_sequestration', 'practice_changes',
               existing_type=postgresql.JSONB(astext_type=sa.Text()),
               type_=sa.JSON(),
               existing_nullable=True)
    op.alter_column('carbon_sequestration', 'created_at',
               existing_type=postgresql.TIMESTAMP(timezone=True),
               nullable=False,
               existing_server_default=sa.text('now()'))
    op.alter_column('carbon_sequestration', 'updated_at',
               existing_type=postgresql.TIMESTAMP(timezone=True),
               nullable=False,
               existing_server_default=sa.text('now()'))
    op.create_index(op.f('ix_carbon_sequestration_field_id'), 'carbon_sequestration', ['field_id'], unique=False)
    op.create_index(op.f('ix_carbon_sequestration_id'), 'carbon_sequestration', ['id'], unique=False)
    op.drop_constraint(op.f('carbon_sequestration_field_id_fkey'), 'carbon_sequestration', type_='foreignkey')
    op.drop_constraint(op.f('carbon_sequestration_organization_id_fkey'), 'carbon_sequestration', type_='foreignkey')
    op.create_foreign_key(None, 'carbon_sequestration', 'organizations', ['organization_id'], ['id'])
    op.create_foreign_key(None, 'carbon_sequestration', 'locations', ['field_id'], ['id'])
    op.create_index(op.f('ix_carbon_stocks_id'), 'carbon_stocks', ['id'], unique=False)
    op.alter_column('collaboration_activities', 'created_at',
               existing_type=postgresql.TIMESTAMP(),
               type_=sa.DateTime(timezone=True),
               existing_nullable=False)
    op.alter_column('collaboration_activities', 'updated_at',
               existing_type=postgresql.TIMESTAMP(),
               type_=sa.DateTime(timezone=True),
               existing_nullable=False)
    op.drop_index(op.f('idx_collaboration_activities_org_id'), table_name='collaboration_activities')
    op.create_index(op.f('ix_collaboration_activities_id'), 'collaboration_activities', ['id'], unique=False)
    op.alter_column('collaboration_comments', 'created_at',
               existing_type=postgresql.TIMESTAMP(),
               type_=sa.DateTime(timezone=True),
               existing_nullable=False)
    op.alter_column('collaboration_comments', 'updated_at',
               existing_type=postgresql.TIMESTAMP(),
               type_=sa.DateTime(timezone=True),
               existing_nullable=False)
    op.drop_index(op.f('idx_collaboration_comments_org_id'), table_name='collaboration_comments')
    op.create_index(op.f('ix_collaboration_comments_id'), 'collaboration_comments', ['id'], unique=False)
    op.create_index(op.f('ix_collaboration_comments_user_id'), 'collaboration_comments', ['user_id'], unique=False)
    op.create_index(op.f('ix_collaboration_comments_workspace_id'), 'collaboration_comments', ['workspace_id'], unique=False)
    op.alter_column('collaboration_tasks', 'created_at',
               existing_type=postgresql.TIMESTAMP(),
               type_=sa.DateTime(timezone=True),
               existing_nullable=False)
    op.alter_column('collaboration_tasks', 'updated_at',
               existing_type=postgresql.TIMESTAMP(),
               type_=sa.DateTime(timezone=True),
               existing_nullable=False)
    op.drop_index(op.f('idx_collaboration_tasks_org_id'), table_name='collaboration_tasks')
    op.create_index(op.f('ix_collaboration_tasks_id'), 'collaboration_tasks', ['id'], unique=False)
    op.alter_column('collaboration_workspaces', 'created_at',
               existing_type=postgresql.TIMESTAMP(),
               type_=sa.DateTime(timezone=True),
               existing_nullable=False)
    op.alter_column('collaboration_workspaces', 'updated_at',
               existing_type=postgresql.TIMESTAMP(),
               type_=sa.DateTime(timezone=True),
               existing_nullable=False)
    op.drop_index(op.f('idx_collaboration_workspaces_org_id'), table_name='collaboration_workspaces')
    op.create_index(op.f('ix_collaboration_workspaces_id'), 'collaboration_workspaces', ['id'], unique=False)
    op.alter_column('conversation_participants', 'created_at',
               existing_type=postgresql.TIMESTAMP(),
               type_=sa.DateTime(timezone=True),
               existing_nullable=False,
               existing_server_default=sa.text('now()'))
    op.alter_column('conversation_participants', 'updated_at',
               existing_type=postgresql.TIMESTAMP(),
               type_=sa.DateTime(timezone=True),
               existing_nullable=False,
               existing_server_default=sa.text('now()'))
    op.drop_constraint(op.f('uq_conversation_participant'), 'conversation_participants', type_='unique')
    op.create_index(op.f('ix_conversation_participants_id'), 'conversation_participants', ['id'], unique=False)
    op.alter_column('conversations', 'created_at',
               existing_type=postgresql.TIMESTAMP(),
               type_=sa.DateTime(timezone=True),
               existing_nullable=False,
               existing_server_default=sa.text('now()'))
    op.alter_column('conversations', 'updated_at',
               existing_type=postgresql.TIMESTAMP(),
               type_=sa.DateTime(timezone=True),
               existing_nullable=False,
               existing_server_default=sa.text('now()'))
    op.create_index(op.f('ix_conversations_id'), 'conversations', ['id'], unique=False)
    op.alter_column('crop_calendars', 'created_at',
               existing_type=postgresql.TIMESTAMP(timezone=True),
               nullable=False,
               existing_server_default=sa.text('now()'))
    op.alter_column('crop_calendars', 'updated_at',
               existing_type=postgresql.TIMESTAMP(timezone=True),
               nullable=False,
               existing_server_default=sa.text('now()'))
    op.create_index(op.f('ix_crop_calendars_id'), 'crop_calendars', ['id'], unique=False)
    op.drop_constraint(op.f('crop_calendars_organization_id_fkey'), 'crop_calendars', type_='foreignkey')
    op.create_foreign_key(None, 'crop_calendars', 'organizations', ['organization_id'], ['id'])
    op.alter_column('crop_suitabilities', 'limiting_factors',
               existing_type=postgresql.JSONB(astext_type=sa.Text()),
               type_=sa.JSON(),
               existing_nullable=True)
    op.alter_column('crop_suitabilities', 'recommendations',
               existing_type=postgresql.JSONB(astext_type=sa.Text()),
               type_=sa.JSON(),
               existing_nullable=True)
    op.alter_column('crop_suitabilities', 'created_at',
               existing_type=postgresql.TIMESTAMP(timezone=True),
               nullable=False,
               existing_server_default=sa.text('now()'))
    op.alter_column('crop_suitabilities', 'updated_at',
               existing_type=postgresql.TIMESTAMP(timezone=True),
               nullable=False,
               existing_server_default=sa.text('now()'))
    op.create_index(op.f('ix_crop_suitabilities_id'), 'crop_suitabilities', ['id'], unique=False)
    op.drop_constraint(op.f('crop_suitabilities_organization_id_fkey'), 'crop_suitabilities', type_='foreignkey')
    op.drop_constraint(op.f('crop_suitabilities_location_id_fkey'), 'crop_suitabilities', type_='foreignkey')
    op.create_foreign_key(None, 'crop_suitabilities', 'locations', ['location_id'], ['id'])
    op.create_foreign_key(None, 'crop_suitabilities', 'organizations', ['organization_id'], ['id'])
    op.alter_column('crosses', 'created_at',
               existing_type=postgresql.TIMESTAMP(),
               type_=sa.DateTime(timezone=True),
               existing_nullable=False)
    op.alter_column('crosses', 'updated_at',
               existing_type=postgresql.TIMESTAMP(),
               type_=sa.DateTime(timezone=True),
               existing_nullable=False)
    op.drop_index(op.f('idx_crosses_org_id'), table_name='crosses')
    op.alter_column('crossing_projects', 'created_at',
               existing_type=postgresql.TIMESTAMP(),
               type_=sa.DateTime(timezone=True),
               existing_nullable=False)
    op.alter_column('crossing_projects', 'updated_at',
               existing_type=postgresql.TIMESTAMP(),
               type_=sa.DateTime(timezone=True),
               existing_nullable=False)
    op.drop_index(op.f('idx_crossing_projects_org_id'), table_name='crossing_projects')
    op.drop_constraint(op.f('dh_batches_batch_code_key'), 'dh_batches', type_='unique')
    op.create_index(op.f('ix_dh_batches_batch_code'), 'dh_batches', ['batch_code'], unique=True)
    op.create_index(op.f('ix_dh_batches_id'), 'dh_batches', ['id'], unique=False)
    op.drop_constraint(op.f('dh_protocols_protocol_code_key'), 'dh_protocols', type_='unique')
    op.create_index(op.f('ix_dh_protocols_id'), 'dh_protocols', ['id'], unique=False)
    op.create_index(op.f('ix_dh_protocols_protocol_code'), 'dh_protocols', ['protocol_code'], unique=True)
    op.alter_column('disease_risk_forecasts', 'contributing_factors',
               existing_type=postgresql.JSONB(astext_type=sa.Text()),
               type_=sa.JSON(),
               existing_nullable=True)
    op.alter_column('disease_risk_forecasts', 'recommended_actions',
               existing_type=postgresql.JSONB(astext_type=sa.Text()),
               type_=sa.JSON(),
               existing_nullable=True)
    op.alter_column('disease_risk_forecasts', 'created_at',
               existing_type=postgresql.TIMESTAMP(timezone=True),
               nullable=False,
               existing_server_default=sa.text('now()'))
    op.alter_column('disease_risk_forecasts', 'updated_at',
               existing_type=postgresql.TIMESTAMP(timezone=True),
               nullable=False,
               existing_server_default=sa.text('now()'))
    op.create_index(op.f('ix_disease_risk_forecasts_crop_name'), 'disease_risk_forecasts', ['crop_name'], unique=False)
    op.create_index(op.f('ix_disease_risk_forecasts_id'), 'disease_risk_forecasts', ['id'], unique=False)
    op.create_index(op.f('ix_disease_risk_forecasts_location_id'), 'disease_risk_forecasts', ['location_id'], unique=False)
    op.drop_constraint(op.f('disease_risk_forecasts_organization_id_fkey'), 'disease_risk_forecasts', type_='foreignkey')
    op.drop_constraint(op.f('disease_risk_forecasts_location_id_fkey'), 'disease_risk_forecasts', type_='foreignkey')
    op.create_foreign_key(None, 'disease_risk_forecasts', 'locations', ['location_id'], ['id'])
    op.create_foreign_key(None, 'disease_risk_forecasts', 'organizations', ['organization_id'], ['id'])
    op.drop_index(op.f('idx_diseases_org_id'), table_name='diseases')
    op.create_index(op.f('ix_dispatch_items_id'), 'dispatch_items', ['id'], unique=False)
    op.drop_constraint(op.f('dispatches_dispatch_number_key'), 'dispatches', type_='unique')
    op.create_index(op.f('ix_dispatches_dispatch_number'), 'dispatches', ['dispatch_number'], unique=True)
    op.create_index(op.f('ix_dispatches_id'), 'dispatches', ['id'], unique=False)
    op.create_index(op.f('ix_dus_entries_id'), 'dus_entries', ['id'], unique=False)
    op.create_index(op.f('ix_dus_scores_id'), 'dus_scores', ['id'], unique=False)
    op.drop_constraint(op.f('dus_trials_trial_code_key'), 'dus_trials', type_='unique')
    op.create_index(op.f('ix_dus_trials_id'), 'dus_trials', ['id'], unique=False)
    op.create_index(op.f('ix_dus_trials_trial_code'), 'dus_trials', ['trial_code'], unique=True)
    op.create_index(op.f('ix_emission_factors_id'), 'emission_factors', ['id'], unique=False)
    op.create_index(op.f('ix_emission_sources_id'), 'emission_sources', ['id'], unique=False)
    op.alter_column('events', 'created_at',
               existing_type=postgresql.TIMESTAMP(),
               type_=sa.DateTime(timezone=True),
               existing_nullable=False)
    op.alter_column('events', 'updated_at',
               existing_type=postgresql.TIMESTAMP(),
               type_=sa.DateTime(timezone=True),
               existing_nullable=False)
    op.drop_index(op.f('idx_events_org_id'), table_name='events')
    op.drop_index(op.f('ix_events_db_id'), table_name='events')
    op.drop_index(op.f('ix_events_org_id'), table_name='events')
    op.drop_index(op.f('ix_events_type'), table_name='events')
    op.create_index(op.f('ix_events_event_db_id'), 'events', ['event_db_id'], unique=True)
    op.create_index(op.f('ix_events_event_type'), 'events', ['event_type'], unique=False)
    op.create_index(op.f('ix_events_organization_id'), 'events', ['organization_id'], unique=False)
    op.alter_column('fertilizer_recommendations', 'target_yield',
               existing_type=sa.DOUBLE_PRECISION(precision=53),
               comment='Target yield value',
               existing_nullable=False)
    op.alter_column('fertilizer_recommendations', 'yield_unit',
               existing_type=sa.VARCHAR(length=20),
               comment='Unit for yield (t/ha, kg/ha, bu/ac)',
               existing_nullable=False,
               existing_server_default=sa.text("'t/ha'::character varying"))
    op.alter_column('fertilizer_recommendations', 'n_kg_ha',
               existing_type=sa.DOUBLE_PRECISION(precision=53),
               comment='Nitrogen recommendation in kg/ha',
               existing_nullable=False,
               existing_server_default=sa.text("'0'::double precision"))
    op.alter_column('fertilizer_recommendations', 'p_kg_ha',
               existing_type=sa.DOUBLE_PRECISION(precision=53),
               comment='Phosphorus (P2O5) recommendation in kg/ha',
               existing_nullable=False,
               existing_server_default=sa.text("'0'::double precision"))
    op.alter_column('fertilizer_recommendations', 'k_kg_ha',
               existing_type=sa.DOUBLE_PRECISION(precision=53),
               comment='Potassium (K2O) recommendation in kg/ha',
               existing_nullable=False,
               existing_server_default=sa.text("'0'::double precision"))
    op.alter_column('fertilizer_recommendations', 's_kg_ha',
               existing_type=sa.DOUBLE_PRECISION(precision=53),
               comment='Sulfur recommendation in kg/ha',
               existing_nullable=True,
               existing_server_default=sa.text("'0'::double precision"))
    op.alter_column('fertilizer_recommendations', 'zn_kg_ha',
               existing_type=sa.DOUBLE_PRECISION(precision=53),
               comment='Zinc recommendation in kg/ha',
               existing_nullable=True,
               existing_server_default=sa.text("'0'::double precision"))
    op.alter_column('fertilizer_recommendations', 'application_timing',
               existing_type=postgresql.JSONB(astext_type=sa.Text()),
               comment='Split application schedule with timing and amounts',
               existing_nullable=True)
    op.alter_column('fertilizer_recommendations', 'estimated_cost',
               existing_type=sa.DOUBLE_PRECISION(precision=53),
               comment='Total estimated fertilizer cost',
               existing_nullable=True)
    op.alter_column('fertilizer_recommendations', 'currency',
               existing_type=sa.VARCHAR(length=3),
               comment='ISO 4217 currency code',
               existing_nullable=True,
               existing_server_default=sa.text("'USD'::character varying"))
    op.alter_column('fertilizer_recommendations', 'recommendation_date',
               existing_type=sa.DATE(),
               comment='Date recommendation was generated',
               existing_nullable=False)
    op.alter_column('fertilizer_recommendations', 'valid_until',
               existing_type=sa.DATE(),
               comment='Recommendation expiration date',
               existing_nullable=True)
    op.alter_column('fertilizer_recommendations', 'notes',
               existing_type=sa.TEXT(),
               comment='Additional recommendations or caveats',
               existing_nullable=True)
    op.alter_column('fertilizer_recommendations', 'created_at',
               existing_type=postgresql.TIMESTAMP(timezone=True),
               nullable=False,
               existing_server_default=sa.text('now()'))
    op.alter_column('fertilizer_recommendations', 'updated_at',
               existing_type=postgresql.TIMESTAMP(timezone=True),
               nullable=False,
               existing_server_default=sa.text('now()'))
    op.create_index('ix_fert_rec_org_crop', 'fertilizer_recommendations', ['organization_id', 'crop_name'], unique=False)
    op.create_index('ix_fert_rec_org_date', 'fertilizer_recommendations', ['organization_id', 'recommendation_date'], unique=False)
    op.create_index('ix_fert_rec_org_field', 'fertilizer_recommendations', ['organization_id', 'field_id'], unique=False)
    op.create_index(op.f('ix_fertilizer_recommendations_field_id'), 'fertilizer_recommendations', ['field_id'], unique=False)
    op.create_index(op.f('ix_fertilizer_recommendations_id'), 'fertilizer_recommendations', ['id'], unique=False)
    op.create_index(op.f('ix_fertilizer_recommendations_soil_test_id'), 'fertilizer_recommendations', ['soil_test_id'], unique=False)
    op.drop_index(op.f('idx_field_book_entries_org_id'), table_name='field_book_entries')
    op.drop_index(op.f('idx_field_book_observations_org_id'), table_name='field_book_observations')
    op.drop_index(op.f('idx_field_book_studies_org_id'), table_name='field_book_studies')
    op.drop_index(op.f('idx_field_book_traits_org_id'), table_name='field_book_traits')
    op.add_column('fields', sa.Column('geometry', geoalchemy2.types.Geometry(geometry_type='POLYGON', srid=4326, dimension=2, from_text='ST_GeomFromEWKT', name='geometry'), nullable=True))
    op.alter_column('fields', 'created_at',
               existing_type=postgresql.TIMESTAMP(timezone=True),
               nullable=False,
               existing_server_default=sa.text('now()'))
    op.alter_column('fields', 'updated_at',
               existing_type=postgresql.TIMESTAMP(timezone=True),
               nullable=False,
               existing_server_default=sa.text('now()'))
    # op.create_index('idx_fields_geometry', 'fields', ['geometry'], unique=False, postgresql_using='gist')
    op.create_index(op.f('ix_fields_id'), 'fields', ['id'], unique=False)
    op.drop_constraint(op.f('fields_organization_id_fkey'), 'fields', type_='foreignkey')
    op.drop_constraint(op.f('fields_location_id_fkey'), 'fields', type_='foreignkey')
    op.create_foreign_key(None, 'fields', 'locations', ['location_id'], ['id'])
    op.create_foreign_key(None, 'fields', 'organizations', ['organization_id'], ['id'])
    op.drop_constraint(op.f('firms_firm_code_key'), 'firms', type_='unique')
    op.create_index(op.f('ix_firms_firm_code'), 'firms', ['firm_code'], unique=True)
    op.create_index(op.f('ix_firms_id'), 'firms', ['id'], unique=False)
    op.alter_column('gdd_predictions', 'created_at',
               existing_type=postgresql.TIMESTAMP(timezone=True),
               nullable=False,
               existing_server_default=sa.text('now()'))
    op.alter_column('gdd_predictions', 'updated_at',
               existing_type=postgresql.TIMESTAMP(timezone=True),
               nullable=False,
               existing_server_default=sa.text('now()'))
    op.create_index(op.f('ix_gdd_predictions_crop_name'), 'gdd_predictions', ['crop_name'], unique=False)
    op.create_index(op.f('ix_gdd_predictions_field_id'), 'gdd_predictions', ['field_id'], unique=False)
    op.create_index(op.f('ix_gdd_predictions_id'), 'gdd_predictions', ['id'], unique=False)
    op.create_index(op.f('ix_gdd_predictions_organization_id'), 'gdd_predictions', ['organization_id'], unique=False)
    op.alter_column('generated_reports', 'created_at',
               existing_type=postgresql.TIMESTAMP(),
               type_=sa.DateTime(timezone=True),
               existing_nullable=False)
    op.alter_column('generated_reports', 'updated_at',
               existing_type=postgresql.TIMESTAMP(),
               type_=sa.DateTime(timezone=True),
               existing_nullable=False)
    op.drop_index(op.f('idx_generated_reports_org_id'), table_name='generated_reports')
    op.create_index(op.f('ix_generated_reports_id'), 'generated_reports', ['id'], unique=False)
    op.create_index(op.f('ix_generated_reports_schedule_id'), 'generated_reports', ['schedule_id'], unique=False)
    op.alter_column('genome_maps', 'created_at',
               existing_type=postgresql.TIMESTAMP(),
               type_=sa.DateTime(timezone=True),
               nullable=False,
               existing_server_default=sa.text('now()'))
    op.alter_column('genome_maps', 'updated_at',
               existing_type=postgresql.TIMESTAMP(),
               type_=sa.DateTime(timezone=True),
               nullable=False,
               existing_server_default=sa.text('now()'))
    op.drop_index(op.f('idx_genome_maps_org_id'), table_name='genome_maps')
    op.create_index(op.f('ix_genome_maps_id'), 'genome_maps', ['id'], unique=False)
    op.alter_column('germplasm', 'created_at',
               existing_type=postgresql.TIMESTAMP(),
               type_=sa.DateTime(timezone=True),
               existing_nullable=False)
    op.alter_column('germplasm', 'updated_at',
               existing_type=postgresql.TIMESTAMP(),
               type_=sa.DateTime(timezone=True),
               existing_nullable=False)
    op.drop_index(op.f('idx_germplasm_org_id'), table_name='germplasm')
    op.alter_column('germplasm_attributes', 'created_at',
               existing_type=postgresql.TIMESTAMP(),
               type_=sa.DateTime(timezone=True),
               existing_nullable=False)
    op.alter_column('germplasm_attributes', 'updated_at',
               existing_type=postgresql.TIMESTAMP(),
               type_=sa.DateTime(timezone=True),
               existing_nullable=False)
    op.drop_index(op.f('idx_germplasm_attributes_org_id'), table_name='germplasm_attributes')
    op.drop_index(op.f('ix_germplasm_collection_members_unique'), table_name='germplasm_collection_members')
    op.drop_column('germplasm_collection_members', 'created_at')
    op.drop_column('germplasm_collection_members', 'updated_at')
    op.alter_column('germplasm_collections', 'created_at',
               existing_type=postgresql.TIMESTAMP(),
               nullable=True)
    op.alter_column('germplasm_collections', 'updated_at',
               existing_type=postgresql.TIMESTAMP(),
               nullable=True)
    op.drop_index(op.f('idx_germplasm_collections_org_id'), table_name='germplasm_collections')
    op.drop_index(op.f('ix_germplasm_collections_status'), table_name='germplasm_collections')
    op.alter_column('growing_degree_day_logs', 'daily_gdd',
               existing_type=sa.DOUBLE_PRECISION(precision=53),
               comment='GDD accumulated on this day (always >= 0)',
               existing_nullable=False)
    op.alter_column('growing_degree_day_logs', 'cumulative_gdd',
               existing_type=sa.DOUBLE_PRECISION(precision=53),
               comment='Total GDD since planting date',
               existing_nullable=False)
    op.alter_column('growing_degree_day_logs', 'base_temperature',
               existing_type=sa.DOUBLE_PRECISION(precision=53),
               comment='Base temperature in Celsius (crop-specific)',
               existing_nullable=False,
               existing_server_default=sa.text("'10'::double precision"))
    op.alter_column('growing_degree_day_logs', 'max_temperature',
               existing_type=sa.DOUBLE_PRECISION(precision=53),
               comment='Daily maximum temperature in Celsius',
               existing_nullable=True)
    op.alter_column('growing_degree_day_logs', 'min_temperature',
               existing_type=sa.DOUBLE_PRECISION(precision=53),
               comment='Daily minimum temperature in Celsius',
               existing_nullable=True)
    op.alter_column('growing_degree_day_logs', 'growth_stage',
               existing_type=sa.VARCHAR(length=100),
               comment="Predicted or observed growth stage (e.g., 'V6', 'R1', 'Flowering')",
               existing_nullable=True)
    op.alter_column('growing_degree_day_logs', 'created_at',
               existing_type=postgresql.TIMESTAMP(timezone=True),
               nullable=False,
               existing_server_default=sa.text('now()'))
    op.alter_column('growing_degree_day_logs', 'updated_at',
               existing_type=postgresql.TIMESTAMP(timezone=True),
               nullable=False,
               existing_server_default=sa.text('now()'))
    op.drop_index(op.f('ix_gdd_crop_name'), table_name='growing_degree_day_logs')
    op.drop_index(op.f('ix_gdd_log_date'), table_name='growing_degree_day_logs')
    op.drop_index(op.f('ix_gdd_organization_id'), table_name='growing_degree_day_logs')
    op.create_index('ix_gdd_org_crop_date', 'growing_degree_day_logs', ['organization_id', 'crop_name', 'log_date'], unique=False)
    op.create_index('ix_gdd_org_field_date', 'growing_degree_day_logs', ['organization_id', 'field_id', 'log_date'], unique=False)
    op.create_index(op.f('ix_growing_degree_day_logs_crop_name'), 'growing_degree_day_logs', ['crop_name'], unique=False)
    op.create_index(op.f('ix_growing_degree_day_logs_field_id'), 'growing_degree_day_logs', ['field_id'], unique=False)
    op.create_index(op.f('ix_growing_degree_day_logs_id'), 'growing_degree_day_logs', ['id'], unique=False)
    op.create_index(op.f('ix_growing_degree_day_logs_log_date'), 'growing_degree_day_logs', ['log_date'], unique=False)
    op.create_index(op.f('ix_growing_degree_day_logs_organization_id'), 'growing_degree_day_logs', ['organization_id'], unique=False)
    op.alter_column('health_alerts', 'created_at',
               existing_type=postgresql.TIMESTAMP(),
               nullable=True)
    op.alter_column('health_alerts', 'updated_at',
               existing_type=postgresql.TIMESTAMP(),
               nullable=True)
    op.drop_index(op.f('idx_health_alerts_org_id'), table_name='health_alerts')
    op.drop_index(op.f('ix_health_alerts_acknowledged'), table_name='health_alerts')
    op.drop_index(op.f('ix_health_alerts_severity'), table_name='health_alerts')
    op.alter_column('images', 'created_at',
               existing_type=postgresql.TIMESTAMP(),
               type_=sa.DateTime(timezone=True),
               existing_nullable=False)
    op.alter_column('images', 'updated_at',
               existing_type=postgresql.TIMESTAMP(),
               type_=sa.DateTime(timezone=True),
               existing_nullable=False)
    op.drop_index(op.f('idx_images_org_id'), table_name='images')
    op.drop_index(op.f('ix_images_db_id'), table_name='images')
    op.drop_index(op.f('ix_images_name'), table_name='images')
    op.drop_index(op.f('ix_images_org_id'), table_name='images')
    op.create_index(op.f('ix_images_image_db_id'), 'images', ['image_db_id'], unique=True)
    op.create_index(op.f('ix_images_image_name'), 'images', ['image_name'], unique=False)
    op.create_index(op.f('ix_images_organization_id'), 'images', ['organization_id'], unique=False)
    op.create_index(op.f('ix_impact_metrics_id'), 'impact_metrics', ['id'], unique=False)
    op.create_index(op.f('ix_impact_reports_id'), 'impact_reports', ['id'], unique=False)
    op.alter_column('iot_aggregates', 'created_at',
               existing_type=postgresql.TIMESTAMP(),
               type_=sa.DateTime(timezone=True),
               existing_nullable=False,
               existing_server_default=sa.text('now()'))
    op.alter_column('iot_aggregates', 'updated_at',
               existing_type=postgresql.TIMESTAMP(),
               type_=sa.DateTime(timezone=True),
               existing_nullable=False,
               existing_server_default=sa.text('now()'))
    op.create_index(op.f('ix_iot_aggregates_id'), 'iot_aggregates', ['id'], unique=False)
    op.alter_column('iot_alert_events', 'created_at',
               existing_type=postgresql.TIMESTAMP(),
               type_=sa.DateTime(timezone=True),
               existing_nullable=False,
               existing_server_default=sa.text('now()'))
    op.alter_column('iot_alert_events', 'updated_at',
               existing_type=postgresql.TIMESTAMP(),
               type_=sa.DateTime(timezone=True),
               existing_nullable=False,
               existing_server_default=sa.text('now()'))
    op.create_index(op.f('ix_iot_alert_events_id'), 'iot_alert_events', ['id'], unique=False)
    op.alter_column('iot_alert_rules', 'created_at',
               existing_type=postgresql.TIMESTAMP(),
               type_=sa.DateTime(timezone=True),
               existing_nullable=False,
               existing_server_default=sa.text('now()'))
    op.alter_column('iot_alert_rules', 'updated_at',
               existing_type=postgresql.TIMESTAMP(),
               type_=sa.DateTime(timezone=True),
               existing_nullable=False,
               existing_server_default=sa.text('now()'))
    op.drop_index(op.f('idx_iot_alert_rules_org_id'), table_name='iot_alert_rules')
    op.create_index(op.f('ix_iot_alert_rules_id'), 'iot_alert_rules', ['id'], unique=False)
    op.alter_column('iot_devices', 'created_at',
               existing_type=postgresql.TIMESTAMP(),
               type_=sa.DateTime(timezone=True),
               existing_nullable=False,
               existing_server_default=sa.text('now()'))
    op.alter_column('iot_devices', 'updated_at',
               existing_type=postgresql.TIMESTAMP(),
               type_=sa.DateTime(timezone=True),
               existing_nullable=False,
               existing_server_default=sa.text('now()'))
    op.drop_index(op.f('idx_iot_devices_org_id'), table_name='iot_devices')
    op.create_index(op.f('ix_iot_devices_field_id'), 'iot_devices', ['field_id'], unique=False)
    op.create_index(op.f('ix_iot_devices_id'), 'iot_devices', ['id'], unique=False)
    op.create_index(op.f('ix_iot_devices_study_id'), 'iot_devices', ['study_id'], unique=False)
    op.alter_column('iot_environment_links', 'created_at',
               existing_type=postgresql.TIMESTAMP(),
               type_=sa.DateTime(timezone=True),
               existing_nullable=False,
               existing_server_default=sa.text('now()'))
    op.alter_column('iot_environment_links', 'updated_at',
               existing_type=postgresql.TIMESTAMP(),
               type_=sa.DateTime(timezone=True),
               existing_nullable=False,
               existing_server_default=sa.text('now()'))
    op.create_index(op.f('ix_iot_environment_links_id'), 'iot_environment_links', ['id'], unique=False)
    op.alter_column('iot_sensors', 'created_at',
               existing_type=postgresql.TIMESTAMP(),
               type_=sa.DateTime(timezone=True),
               existing_nullable=False,
               existing_server_default=sa.text('now()'))
    op.alter_column('iot_sensors', 'updated_at',
               existing_type=postgresql.TIMESTAMP(),
               type_=sa.DateTime(timezone=True),
               existing_nullable=False,
               existing_server_default=sa.text('now()'))
    op.create_index(op.f('ix_iot_sensors_id'), 'iot_sensors', ['id'], unique=False)
    op.alter_column('iot_telemetry', 'created_at',
               existing_type=postgresql.TIMESTAMP(),
               type_=sa.DateTime(timezone=True),
               existing_nullable=False,
               existing_server_default=sa.text('now()'))
    op.alter_column('iot_telemetry', 'updated_at',
               existing_type=postgresql.TIMESTAMP(),
               type_=sa.DateTime(timezone=True),
               existing_nullable=False,
               existing_server_default=sa.text('now()'))
    op.create_index(op.f('ix_iot_telemetry_id'), 'iot_telemetry', ['id'], unique=False)
    op.alter_column('ipm_strategies', 'prevention_methods',
               existing_type=postgresql.JSONB(astext_type=sa.Text()),
               type_=sa.JSON(),
               existing_nullable=True)
    op.alter_column('ipm_strategies', 'monitoring_methods',
               existing_type=postgresql.JSONB(astext_type=sa.Text()),
               type_=sa.JSON(),
               existing_nullable=True)
    op.alter_column('ipm_strategies', 'biological_controls',
               existing_type=postgresql.JSONB(astext_type=sa.Text()),
               type_=sa.JSON(),
               existing_nullable=True)
    op.alter_column('ipm_strategies', 'physical_controls',
               existing_type=postgresql.JSONB(astext_type=sa.Text()),
               type_=sa.JSON(),
               existing_nullable=True)
    op.alter_column('ipm_strategies', 'chemical_controls',
               existing_type=postgresql.JSONB(astext_type=sa.Text()),
               type_=sa.JSON(),
               existing_nullable=True)
    op.alter_column('ipm_strategies', 'growth_stages',
               existing_type=postgresql.JSONB(astext_type=sa.Text()),
               type_=sa.JSON(),
               existing_nullable=True)
    op.alter_column('ipm_strategies', 'created_at',
               existing_type=postgresql.TIMESTAMP(timezone=True),
               nullable=False,
               existing_server_default=sa.text('now()'))
    op.alter_column('ipm_strategies', 'updated_at',
               existing_type=postgresql.TIMESTAMP(timezone=True),
               nullable=False,
               existing_server_default=sa.text('now()'))
    op.create_index(op.f('ix_ipm_strategies_field_id'), 'ipm_strategies', ['field_id'], unique=False)
    op.create_index(op.f('ix_ipm_strategies_id'), 'ipm_strategies', ['id'], unique=False)
    op.drop_constraint(op.f('ipm_strategies_field_id_fkey'), 'ipm_strategies', type_='foreignkey')
    op.drop_constraint(op.f('ipm_strategies_organization_id_fkey'), 'ipm_strategies', type_='foreignkey')
    op.create_foreign_key(None, 'ipm_strategies', 'organizations', ['organization_id'], ['id'])
    op.create_foreign_key(None, 'ipm_strategies', 'locations', ['field_id'], ['id'])
    op.execute("DO $$ BEGIN CREATE TYPE irrigationstatus AS ENUM ('planned', 'in_progress', 'completed', 'canceled'); EXCEPTION WHEN duplicate_object THEN null; END $$;")
    op.execute("ALTER TABLE irrigation_schedules ALTER COLUMN status DROP DEFAULT")
    op.execute("ALTER TABLE irrigation_schedules ALTER COLUMN status TYPE irrigationstatus USING status::irrigationstatus")
    op.execute("ALTER TABLE irrigation_schedules ALTER COLUMN status SET DEFAULT 'planned'::irrigationstatus")
    # op.alter_column('irrigation_schedules', 'status',
    #            existing_type=sa.VARCHAR(length=20),
    #            type_=sa.Enum('planned', 'in_progress', 'completed', 'canceled', name='irrigationstatus'),
    #            existing_nullable=True,
    #            existing_server_default=sa.text("'planned'::character varying"))
    op.alter_column('irrigation_schedules', 'created_at',
               existing_type=postgresql.TIMESTAMP(timezone=True),
               nullable=False,
               existing_server_default=sa.text('now()'))
    op.alter_column('irrigation_schedules', 'updated_at',
               existing_type=postgresql.TIMESTAMP(timezone=True),
               nullable=False,
               existing_server_default=sa.text('now()'))
    op.create_index(op.f('ix_irrigation_schedules_field_id'), 'irrigation_schedules', ['field_id'], unique=False)
    op.create_index(op.f('ix_irrigation_schedules_id'), 'irrigation_schedules', ['id'], unique=False)
    op.drop_constraint(op.f('irrigation_schedules_organization_id_fkey'), 'irrigation_schedules', type_='foreignkey')
    op.create_foreign_key(None, 'irrigation_schedules', 'organizations', ['organization_id'], ['id'])
    op.alter_column('linkage_groups', 'created_at',
               existing_type=postgresql.TIMESTAMP(),
               type_=sa.DateTime(timezone=True),
               nullable=False,
               existing_server_default=sa.text('now()'))
    op.alter_column('linkage_groups', 'updated_at',
               existing_type=postgresql.TIMESTAMP(),
               type_=sa.DateTime(timezone=True),
               nullable=False,
               existing_server_default=sa.text('now()'))
    op.drop_index(op.f('idx_linkage_groups_org_id'), table_name='linkage_groups')
    op.create_index(op.f('ix_linkage_groups_id'), 'linkage_groups', ['id'], unique=False)
    op.alter_column('lists', 'created_at',
               existing_type=postgresql.TIMESTAMP(),
               type_=sa.DateTime(timezone=True),
               existing_nullable=False)
    op.alter_column('lists', 'updated_at',
               existing_type=postgresql.TIMESTAMP(),
               type_=sa.DateTime(timezone=True),
               existing_nullable=False)
    op.drop_index(op.f('idx_lists_org_id'), table_name='lists')
    op.create_index(op.f('ix_lists_id'), 'lists', ['id'], unique=False)
    op.alter_column('locations', 'created_at',
               existing_type=postgresql.TIMESTAMP(),
               type_=sa.DateTime(timezone=True),
               existing_nullable=False)
    op.alter_column('locations', 'updated_at',
               existing_type=postgresql.TIMESTAMP(),
               type_=sa.DateTime(timezone=True),
               existing_nullable=False)
    op.drop_index(op.f('idx_locations_org_id'), table_name='locations')
    op.create_index(op.f('ix_locations_organization_id'), 'locations', ['organization_id'], unique=False)
    op.alter_column('marker_positions', 'created_at',
               existing_type=postgresql.TIMESTAMP(),
               type_=sa.DateTime(timezone=True),
               nullable=False,
               existing_server_default=sa.text('now()'))
    op.alter_column('marker_positions', 'updated_at',
               existing_type=postgresql.TIMESTAMP(),
               type_=sa.DateTime(timezone=True),
               nullable=False,
               existing_server_default=sa.text('now()'))
    op.drop_index(op.f('idx_marker_positions_org_id'), table_name='marker_positions')
    op.create_index(op.f('ix_marker_positions_id'), 'marker_positions', ['id'], unique=False)
    op.create_index(op.f('ix_marker_positions_variant_name'), 'marker_positions', ['variant_name'], unique=False)
    op.alter_column('messages', 'created_at',
               existing_type=postgresql.TIMESTAMP(),
               type_=sa.DateTime(timezone=True),
               existing_nullable=False,
               existing_server_default=sa.text('now()'))
    op.alter_column('messages', 'updated_at',
               existing_type=postgresql.TIMESTAMP(),
               type_=sa.DateTime(timezone=True),
               existing_nullable=False,
               existing_server_default=sa.text('now()'))
    op.create_index(op.f('ix_messages_id'), 'messages', ['id'], unique=False)
    op.alter_column('notification_preferences', 'created_at',
               existing_type=postgresql.TIMESTAMP(),
               type_=sa.DateTime(timezone=True),
               existing_nullable=False)
    op.alter_column('notification_preferences', 'updated_at',
               existing_type=postgresql.TIMESTAMP(),
               type_=sa.DateTime(timezone=True),
               existing_nullable=False)
    op.drop_index(op.f('idx_notification_preferences_org_id'), table_name='notification_preferences')
    op.drop_constraint(op.f('uq_notification_pref_user_category'), 'notification_preferences', type_='unique')
    op.create_index(op.f('ix_notification_preferences_id'), 'notification_preferences', ['id'], unique=False)
    op.drop_constraint(op.f('notification_preferences_organization_id_fkey'), 'notification_preferences', type_='foreignkey')
    op.drop_constraint(op.f('notification_preferences_user_id_fkey'), 'notification_preferences', type_='foreignkey')
    op.create_foreign_key(None, 'notification_preferences', 'users', ['user_id'], ['id'])
    op.create_foreign_key(None, 'notification_preferences', 'organizations', ['organization_id'], ['id'])
    op.alter_column('notifications', 'created_at',
               existing_type=postgresql.TIMESTAMP(),
               type_=sa.DateTime(timezone=True),
               existing_nullable=False)
    op.alter_column('notifications', 'updated_at',
               existing_type=postgresql.TIMESTAMP(),
               type_=sa.DateTime(timezone=True),
               existing_nullable=False)
    op.drop_index(op.f('idx_notifications_org_id'), table_name='notifications')
    op.drop_index(op.f('ix_notifications_created_at'), table_name='notifications')
    op.create_index(op.f('ix_notifications_id'), 'notifications', ['id'], unique=False)
    op.drop_constraint(op.f('notifications_user_id_fkey'), 'notifications', type_='foreignkey')
    op.drop_constraint(op.f('notifications_organization_id_fkey'), 'notifications', type_='foreignkey')
    op.create_foreign_key(None, 'notifications', 'users', ['user_id'], ['id'])
    op.create_foreign_key(None, 'notifications', 'organizations', ['organization_id'], ['id'])
    op.drop_index(op.f('idx_nursery_locations_org_id'), table_name='nursery_locations')
    op.alter_column('observation_units', 'created_at',
               existing_type=postgresql.TIMESTAMP(),
               type_=sa.DateTime(timezone=True),
               existing_nullable=False)
    op.alter_column('observation_units', 'updated_at',
               existing_type=postgresql.TIMESTAMP(),
               type_=sa.DateTime(timezone=True),
               existing_nullable=False)
    op.drop_index(op.f('idx_observation_units_org_id'), table_name='observation_units')
    op.drop_index(op.f('ix_observation_units_db_id'), table_name='observation_units')
    op.drop_index(op.f('ix_observation_units_name'), table_name='observation_units')
    op.drop_index(op.f('ix_observation_units_org_id'), table_name='observation_units')
    op.create_index(op.f('ix_observation_units_observation_unit_db_id'), 'observation_units', ['observation_unit_db_id'], unique=True)
    op.create_index(op.f('ix_observation_units_observation_unit_name'), 'observation_units', ['observation_unit_name'], unique=False)
    op.create_index(op.f('ix_observation_units_organization_id'), 'observation_units', ['organization_id'], unique=False)
    op.alter_column('observation_variables', 'created_at',
               existing_type=postgresql.TIMESTAMP(),
               type_=sa.DateTime(timezone=True),
               existing_nullable=False)
    op.alter_column('observation_variables', 'updated_at',
               existing_type=postgresql.TIMESTAMP(),
               type_=sa.DateTime(timezone=True),
               existing_nullable=False)
    op.drop_index(op.f('idx_observation_variables_org_id'), table_name='observation_variables')
    op.drop_index(op.f('ix_observation_variables_db_id'), table_name='observation_variables')
    op.drop_index(op.f('ix_observation_variables_name'), table_name='observation_variables')
    op.drop_index(op.f('ix_observation_variables_org_id'), table_name='observation_variables')
    op.create_index(op.f('ix_observation_variables_observation_variable_db_id'), 'observation_variables', ['observation_variable_db_id'], unique=True)
    op.create_index(op.f('ix_observation_variables_observation_variable_name'), 'observation_variables', ['observation_variable_name'], unique=False)
    op.create_index(op.f('ix_observation_variables_organization_id'), 'observation_variables', ['organization_id'], unique=False)
    op.alter_column('observations', 'created_at',
               existing_type=postgresql.TIMESTAMP(),
               type_=sa.DateTime(timezone=True),
               existing_nullable=False)
    op.alter_column('observations', 'updated_at',
               existing_type=postgresql.TIMESTAMP(),
               type_=sa.DateTime(timezone=True),
               existing_nullable=False)
    op.drop_index(op.f('idx_observations_org_id'), table_name='observations')
    op.drop_index(op.f('ix_observations_db_id'), table_name='observations')
    op.drop_index(op.f('ix_observations_org_id'), table_name='observations')
    op.drop_index(op.f('ix_observations_unit_id'), table_name='observations')
    op.drop_index(op.f('ix_observations_variable_id'), table_name='observations')
    op.create_index(op.f('ix_observations_germplasm_id'), 'observations', ['germplasm_id'], unique=False)
    op.create_index(op.f('ix_observations_observation_db_id'), 'observations', ['observation_db_id'], unique=True)
    op.create_index(op.f('ix_observations_observation_unit_id'), 'observations', ['observation_unit_id'], unique=False)
    op.create_index(op.f('ix_observations_observation_variable_id'), 'observations', ['observation_variable_id'], unique=False)
    op.create_index(op.f('ix_observations_organization_id'), 'observations', ['organization_id'], unique=False)
    op.alter_column('offline_data_cache', 'created_at',
               existing_type=postgresql.TIMESTAMP(),
               type_=sa.DateTime(timezone=True),
               existing_nullable=False)
    op.alter_column('offline_data_cache', 'updated_at',
               existing_type=postgresql.TIMESTAMP(),
               type_=sa.DateTime(timezone=True),
               existing_nullable=False)
    op.drop_index(op.f('idx_offline_data_cache_org_id'), table_name='offline_data_cache')
    op.drop_constraint(op.f('uq_user_cache_category'), 'offline_data_cache', type_='unique')
    op.create_index(op.f('ix_offline_data_cache_id'), 'offline_data_cache', ['id'], unique=False)
    op.create_index(op.f('ix_offline_data_cache_organization_id'), 'offline_data_cache', ['organization_id'], unique=False)
    op.alter_column('ontologies', 'created_at',
               existing_type=postgresql.TIMESTAMP(),
               type_=sa.DateTime(timezone=True),
               existing_nullable=False)
    op.alter_column('ontologies', 'updated_at',
               existing_type=postgresql.TIMESTAMP(),
               type_=sa.DateTime(timezone=True),
               existing_nullable=False)
    op.drop_index(op.f('idx_ontologies_org_id'), table_name='ontologies')
    op.create_index(op.f('ix_ontologies_id'), 'ontologies', ['id'], unique=False)
    # op.alter_column('organizations', 'created_at',
    #            existing_type=postgresql.TIMESTAMP(),
    #            type_=sa.DateTime(timezone=True),
    #            existing_nullable=False)
    # op.alter_column('organizations', 'updated_at',
    #            existing_type=postgresql.TIMESTAMP(),
    #            type_=sa.DateTime(timezone=True),
    #            existing_nullable=False)
    op.alter_column('people', 'created_at',
               existing_type=postgresql.TIMESTAMP(),
               type_=sa.DateTime(timezone=True),
               existing_nullable=False)
    op.alter_column('people', 'updated_at',
               existing_type=postgresql.TIMESTAMP(),
               type_=sa.DateTime(timezone=True),
               existing_nullable=False)
    op.drop_index(op.f('idx_people_org_id'), table_name='people')
    op.create_index(op.f('ix_people_organization_id'), 'people', ['organization_id'], unique=False)
    op.alter_column('pest_observations', 'weather_conditions',
               existing_type=postgresql.JSONB(astext_type=sa.Text()),
               type_=sa.JSON(),
               existing_nullable=True)
    op.alter_column('pest_observations', 'image_urls',
               existing_type=postgresql.JSONB(astext_type=sa.Text()),
               type_=sa.JSON(),
               existing_nullable=True)
    op.alter_column('pest_observations', 'created_at',
               existing_type=postgresql.TIMESTAMP(timezone=True),
               nullable=False,
               existing_server_default=sa.text('now()'))
    op.alter_column('pest_observations', 'updated_at',
               existing_type=postgresql.TIMESTAMP(timezone=True),
               nullable=False,
               existing_server_default=sa.text('now()'))
    op.create_index(op.f('ix_pest_observations_id'), 'pest_observations', ['id'], unique=False)
    op.create_index(op.f('ix_pest_observations_study_id'), 'pest_observations', ['study_id'], unique=False)
    op.drop_constraint(op.f('pest_observations_organization_id_fkey'), 'pest_observations', type_='foreignkey')
    op.drop_constraint(op.f('pest_observations_field_id_fkey'), 'pest_observations', type_='foreignkey')
    op.drop_constraint(op.f('pest_observations_study_id_fkey'), 'pest_observations', type_='foreignkey')
    op.create_foreign_key(None, 'pest_observations', 'locations', ['field_id'], ['id'])
    op.create_foreign_key(None, 'pest_observations', 'studies', ['study_id'], ['id'])
    op.create_foreign_key(None, 'pest_observations', 'organizations', ['organization_id'], ['id'])
    op.drop_constraint(op.f('phenomic_datasets_dataset_code_key'), 'phenomic_datasets', type_='unique')
    op.create_index(op.f('ix_phenomic_datasets_id'), 'phenomic_datasets', ['id'], unique=False)
    op.drop_constraint(op.f('phenomic_models_model_code_key'), 'phenomic_models', type_='unique')
    op.create_index(op.f('ix_phenomic_models_id'), 'phenomic_models', ['id'], unique=False)
    op.alter_column('planned_crosses', 'created_at',
               existing_type=postgresql.TIMESTAMP(),
               type_=sa.DateTime(timezone=True),
               existing_nullable=False)
    op.alter_column('planned_crosses', 'updated_at',
               existing_type=postgresql.TIMESTAMP(),
               type_=sa.DateTime(timezone=True),
               existing_nullable=False)
    op.drop_index(op.f('idx_planned_crosses_org_id'), table_name='planned_crosses')
    op.alter_column('plates', 'created_at',
               existing_type=postgresql.TIMESTAMP(),
               type_=sa.DateTime(timezone=True),
               nullable=False,
               existing_server_default=sa.text('now()'))
    op.alter_column('plates', 'updated_at',
               existing_type=postgresql.TIMESTAMP(),
               type_=sa.DateTime(timezone=True),
               nullable=False,
               existing_server_default=sa.text('now()'))
    op.drop_index(op.f('idx_plates_org_id'), table_name='plates')
    op.create_index(op.f('ix_plates_id'), 'plates', ['id'], unique=False)
    op.create_index(op.f('ix_policy_adoptions_id'), 'policy_adoptions', ['id'], unique=False)
    op.alter_column('programs', 'research_context',
               existing_type=postgresql.JSONB(astext_type=sa.Text()),
               type_=sa.JSON(),
               existing_nullable=True)
    op.alter_column('programs', 'created_at',
               existing_type=postgresql.TIMESTAMP(),
               type_=sa.DateTime(timezone=True),
               existing_nullable=False)
    op.alter_column('programs', 'updated_at',
               existing_type=postgresql.TIMESTAMP(),
               type_=sa.DateTime(timezone=True),
               existing_nullable=False)
    op.drop_index(op.f('idx_programs_org_id'), table_name='programs')
    op.create_index(op.f('ix_publications_id'), 'publications', ['id'], unique=False)
    op.drop_index(op.f('idx_pyramiding_strategies_org_id'), table_name='pyramiding_strategies')
    op.alter_column('quiet_hours', 'created_at',
               existing_type=postgresql.TIMESTAMP(),
               type_=sa.DateTime(timezone=True),
               existing_nullable=False)
    op.alter_column('quiet_hours', 'updated_at',
               existing_type=postgresql.TIMESTAMP(),
               type_=sa.DateTime(timezone=True),
               existing_nullable=False)
    op.drop_index(op.f('idx_quiet_hours_org_id'), table_name='quiet_hours')
    op.drop_constraint(op.f('uq_quiet_hours_user'), 'quiet_hours', type_='unique')
    op.drop_index(op.f('ix_quiet_hours_user_id'), table_name='quiet_hours')
    op.create_index(op.f('ix_quiet_hours_user_id'), 'quiet_hours', ['user_id'], unique=True)
    op.create_index(op.f('ix_quiet_hours_id'), 'quiet_hours', ['id'], unique=False)
    op.drop_constraint(op.f('quiet_hours_user_id_fkey'), 'quiet_hours', type_='foreignkey')
    op.drop_constraint(op.f('quiet_hours_organization_id_fkey'), 'quiet_hours', type_='foreignkey')
    op.create_foreign_key(None, 'quiet_hours', 'organizations', ['organization_id'], ['id'])
    op.create_foreign_key(None, 'quiet_hours', 'users', ['user_id'], ['id'])
    op.alter_column('reference_sets', 'created_at',
               existing_type=postgresql.TIMESTAMP(),
               type_=sa.DateTime(timezone=True),
               nullable=False,
               existing_server_default=sa.text('now()'))
    op.alter_column('reference_sets', 'updated_at',
               existing_type=postgresql.TIMESTAMP(),
               type_=sa.DateTime(timezone=True),
               nullable=False,
               existing_server_default=sa.text('now()'))
    op.drop_index(op.f('idx_reference_sets_org_id'), table_name='reference_sets')
    op.create_index(op.f('ix_reference_sets_id'), 'reference_sets', ['id'], unique=False)
    op.alter_column('references', 'created_at',
               existing_type=postgresql.TIMESTAMP(),
               type_=sa.DateTime(timezone=True),
               nullable=False,
               existing_server_default=sa.text('now()'))
    op.alter_column('references', 'updated_at',
               existing_type=postgresql.TIMESTAMP(),
               type_=sa.DateTime(timezone=True),
               nullable=False,
               existing_server_default=sa.text('now()'))
    op.drop_index(op.f('idx_references_org_id'), table_name='references')
    op.create_index(op.f('ix_references_id'), 'references', ['id'], unique=False)
    op.alter_column('report_schedules', 'created_at',
               existing_type=postgresql.TIMESTAMP(),
               type_=sa.DateTime(timezone=True),
               existing_nullable=False)
    op.alter_column('report_schedules', 'updated_at',
               existing_type=postgresql.TIMESTAMP(),
               type_=sa.DateTime(timezone=True),
               existing_nullable=False)
    op.drop_index(op.f('idx_report_schedules_org_id'), table_name='report_schedules')
    op.create_index(op.f('ix_report_schedules_id'), 'report_schedules', ['id'], unique=False)
    op.alter_column('report_templates', 'created_at',
               existing_type=postgresql.TIMESTAMP(),
               type_=sa.DateTime(timezone=True),
               existing_nullable=False)
    op.alter_column('report_templates', 'updated_at',
               existing_type=postgresql.TIMESTAMP(),
               type_=sa.DateTime(timezone=True),
               existing_nullable=False)
    op.drop_index(op.f('idx_report_templates_org_id'), table_name='report_templates')
    op.drop_index(op.f('ix_report_templates_category'), table_name='report_templates')
    op.create_index(op.f('ix_report_templates_id'), 'report_templates', ['id'], unique=False)
    op.create_index(op.f('ix_research_projects_program_id'), 'research_projects', ['program_id'], unique=False)
    op.drop_index(op.f('idx_resistance_genes_org_id'), table_name='resistance_genes')
    op.alter_column('roles', 'created_at',
               existing_type=postgresql.TIMESTAMP(),
               type_=sa.DateTime(timezone=True),
               existing_nullable=False)
    op.alter_column('roles', 'updated_at',
               existing_type=postgresql.TIMESTAMP(),
               type_=sa.DateTime(timezone=True),
               existing_nullable=False)
    op.drop_index(op.f('idx_roles_org_id'), table_name='roles')
    op.create_index(op.f('ix_roles_id'), 'roles', ['id'], unique=False)
    op.drop_constraint(op.f('roles_organization_id_fkey'), 'roles', type_='foreignkey')
    op.create_foreign_key(None, 'roles', 'organizations', ['organization_id'], ['id'])
    op.alter_column('samples', 'created_at',
               existing_type=postgresql.TIMESTAMP(),
               type_=sa.DateTime(timezone=True),
               existing_nullable=False)
    op.alter_column('samples', 'updated_at',
               existing_type=postgresql.TIMESTAMP(),
               type_=sa.DateTime(timezone=True),
               existing_nullable=False)
    op.drop_index(op.f('idx_samples_org_id'), table_name='samples')
    op.drop_index(op.f('ix_samples_db_id'), table_name='samples')
    op.drop_index(op.f('ix_samples_name'), table_name='samples')
    op.drop_index(op.f('ix_samples_org_id'), table_name='samples')
    op.create_index(op.f('ix_samples_organization_id'), 'samples', ['organization_id'], unique=False)
    op.create_index(op.f('ix_samples_sample_db_id'), 'samples', ['sample_db_id'], unique=True)
    op.create_index(op.f('ix_samples_sample_name'), 'samples', ['sample_name'], unique=False)
    op.create_index(op.f('ix_samples_study_id'), 'samples', ['study_id'], unique=False)
    op.create_index(op.f('ix_sdg_indicators_id'), 'sdg_indicators', ['id'], unique=False)
    op.alter_column('seasons', 'created_at',
               existing_type=postgresql.TIMESTAMP(),
               type_=sa.DateTime(timezone=True),
               existing_nullable=False)
    op.alter_column('seasons', 'updated_at',
               existing_type=postgresql.TIMESTAMP(),
               type_=sa.DateTime(timezone=True),
               existing_nullable=False)
    op.drop_index(op.f('idx_seasons_org_id'), table_name='seasons')
    op.create_index(op.f('ix_seasons_id'), 'seasons', ['id'], unique=False)
    op.alter_column('seed_bank_accessions', 'organization_id',
               existing_type=sa.INTEGER(),
               nullable=False)
    # PATCH: Handle multiple Enum migrations with explicit casting
    # 1. Accession Status
    op.execute("DO $$ BEGIN CREATE TYPE accessionstatus AS ENUM ('ACTIVE', 'DEPLETED', 'REGENERATING'); EXCEPTION WHEN duplicate_object THEN null; END $$;")
    op.execute("ALTER TABLE seed_bank_accessions ALTER COLUMN status DROP DEFAULT")
    op.execute("ALTER TABLE seed_bank_accessions ALTER COLUMN status TYPE accessionstatus USING upper(status::text)::accessionstatus")
    
    op.drop_index(op.f('idx_seed_bank_accessions_org_id'), table_name='seed_bank_accessions')
    op.create_index(op.f('ix_seed_bank_accessions_organization_id'), 'seed_bank_accessions', ['organization_id'], unique=False)
    
    op.alter_column('seed_bank_exchanges', 'organization_id',
               existing_type=sa.INTEGER(),
               nullable=False)

    # 2. Exchange Type
    op.execute("DO $$ BEGIN CREATE TYPE exchangetype AS ENUM ('INCOMING', 'OUTGOING'); EXCEPTION WHEN duplicate_object THEN null; END $$;")
    op.execute("ALTER TABLE seed_bank_exchanges ALTER COLUMN type DROP DEFAULT")
    op.execute("ALTER TABLE seed_bank_exchanges ALTER COLUMN type TYPE exchangetype USING upper(type::text)::exchangetype")

    # 3. Exchange Status
    op.execute("DO $$ BEGIN CREATE TYPE exchangestatus AS ENUM ('PENDING', 'APPROVED', 'SHIPPED', 'RECEIVED', 'REJECTED'); EXCEPTION WHEN duplicate_object THEN null; END $$;")
    op.execute("ALTER TABLE seed_bank_exchanges ALTER COLUMN status DROP DEFAULT")
    op.execute("ALTER TABLE seed_bank_exchanges ALTER COLUMN status TYPE exchangestatus USING upper(status::text)::exchangestatus")

    op.drop_index(op.f('idx_seed_bank_exchanges_org_id'), table_name='seed_bank_exchanges')
    op.create_index(op.f('ix_seed_bank_exchanges_organization_id'), 'seed_bank_exchanges', ['organization_id'], unique=False)
    
    op.alter_column('seed_bank_regeneration_tasks', 'organization_id',
               existing_type=sa.INTEGER(),
               nullable=False)

    # 4. Regeneration Priority
    op.execute("DO $$ BEGIN CREATE TYPE regenerationpriority AS ENUM ('HIGH', 'MEDIUM', 'LOW'); EXCEPTION WHEN duplicate_object THEN null; END $$;")
    op.execute("ALTER TABLE seed_bank_regeneration_tasks ALTER COLUMN priority DROP DEFAULT")
    op.execute("ALTER TABLE seed_bank_regeneration_tasks ALTER COLUMN priority TYPE regenerationpriority USING upper(priority::text)::regenerationpriority")

    # 5. Regeneration Status (Note: 'in-progress' -> 'IN_PROGRESS' implies replace('-', '_'))
    op.execute("DO $$ BEGIN CREATE TYPE regenerationstatus AS ENUM ('PLANNED', 'IN_PROGRESS', 'HARVESTED', 'COMPLETED'); EXCEPTION WHEN duplicate_object THEN null; END $$;")
    op.execute("ALTER TABLE seed_bank_regeneration_tasks ALTER COLUMN status DROP DEFAULT")
    op.execute("ALTER TABLE seed_bank_regeneration_tasks ALTER COLUMN status TYPE regenerationstatus USING upper(replace(status::text, '-', '_'))::regenerationstatus")

    op.drop_index(op.f('idx_seed_bank_regeneration_tasks_org_id'), table_name='seed_bank_regeneration_tasks')
    op.create_index(op.f('ix_seed_bank_regeneration_tasks_organization_id'), 'seed_bank_regeneration_tasks', ['organization_id'], unique=False)
    
    op.alter_column('seed_bank_vaults', 'organization_id',
               existing_type=sa.INTEGER(),
               nullable=False)

    # 6. Vault Type
    op.execute("DO $$ BEGIN CREATE TYPE vaulttype AS ENUM ('BASE', 'ACTIVE', 'CRYO'); EXCEPTION WHEN duplicate_object THEN null; END $$;")
    op.execute("ALTER TABLE seed_bank_vaults ALTER COLUMN type DROP DEFAULT")
    op.execute("ALTER TABLE seed_bank_vaults ALTER COLUMN type TYPE vaulttype USING upper(type::text)::vaulttype")

    # 7. Vault Status
    op.execute("DO $$ BEGIN CREATE TYPE vaultstatus AS ENUM ('OPTIMAL', 'WARNING', 'CRITICAL'); EXCEPTION WHEN duplicate_object THEN null; END $$;")
    op.execute("ALTER TABLE seed_bank_vaults ALTER COLUMN status DROP DEFAULT")
    op.execute("ALTER TABLE seed_bank_vaults ALTER COLUMN status TYPE vaultstatus USING upper(status::text)::vaultstatus")

    op.drop_index(op.f('idx_seed_bank_vaults_org_id'), table_name='seed_bank_vaults')
    op.create_index(op.f('ix_seed_bank_vaults_organization_id'), 'seed_bank_vaults', ['organization_id'], unique=False)
    
    op.alter_column('seed_bank_viability_tests', 'organization_id',
               existing_type=sa.INTEGER(),
               nullable=False)

    # 8. Test Status
    op.execute("DO $$ BEGIN CREATE TYPE teststatus AS ENUM ('SCHEDULED', 'IN_PROGRESS', 'COMPLETED'); EXCEPTION WHEN duplicate_object THEN null; END $$;")
    op.execute("ALTER TABLE seed_bank_viability_tests ALTER COLUMN status DROP DEFAULT")
    op.execute("ALTER TABLE seed_bank_viability_tests ALTER COLUMN status TYPE teststatus USING upper(replace(status::text, '-', '_'))::teststatus")
    op.drop_index(op.f('idx_seed_bank_viability_tests_org_id'), table_name='seed_bank_viability_tests')
    op.create_index(op.f('ix_seed_bank_viability_tests_organization_id'), 'seed_bank_viability_tests', ['organization_id'], unique=False)
    op.drop_index(op.f('idx_seedling_batches_org_id'), table_name='seedling_batches')
    op.alter_column('seedlot_transactions', 'created_at',
               existing_type=postgresql.TIMESTAMP(),
               type_=sa.DateTime(timezone=True),
               existing_nullable=False)
    op.alter_column('seedlot_transactions', 'updated_at',
               existing_type=postgresql.TIMESTAMP(),
               type_=sa.DateTime(timezone=True),
               existing_nullable=False)
    op.drop_index(op.f('idx_seedlot_transactions_org_id'), table_name='seedlot_transactions')
    op.alter_column('seedlots', 'created_at',
               existing_type=postgresql.TIMESTAMP(),
               type_=sa.DateTime(timezone=True),
               existing_nullable=False)
    op.alter_column('seedlots', 'updated_at',
               existing_type=postgresql.TIMESTAMP(),
               type_=sa.DateTime(timezone=True),
               existing_nullable=False)
    op.drop_index(op.f('idx_seedlots_org_id'), table_name='seedlots')
    op.alter_column('soil_health_scores', 'recommendations',
               existing_type=postgresql.JSONB(astext_type=sa.Text()),
               type_=sa.JSON(),
               existing_nullable=True)
    op.alter_column('soil_health_scores', 'created_at',
               existing_type=postgresql.TIMESTAMP(timezone=True),
               nullable=False,
               existing_server_default=sa.text('now()'))
    op.alter_column('soil_health_scores', 'updated_at',
               existing_type=postgresql.TIMESTAMP(timezone=True),
               nullable=False,
               existing_server_default=sa.text('now()'))
    op.create_index(op.f('ix_soil_health_scores_field_id'), 'soil_health_scores', ['field_id'], unique=False)
    op.create_index(op.f('ix_soil_health_scores_id'), 'soil_health_scores', ['id'], unique=False)
    op.create_index(op.f('ix_soil_health_scores_overall_score'), 'soil_health_scores', ['overall_score'], unique=False)
    op.drop_constraint(op.f('soil_health_scores_organization_id_fkey'), 'soil_health_scores', type_='foreignkey')
    op.create_foreign_key(None, 'soil_health_scores', 'organizations', ['organization_id'], ['id'])
    op.alter_column('soil_moisture_readings', 'created_at',
               existing_type=postgresql.TIMESTAMP(timezone=True),
               nullable=False,
               existing_server_default=sa.text('now()'))
    op.alter_column('soil_moisture_readings', 'updated_at',
               existing_type=postgresql.TIMESTAMP(timezone=True),
               nullable=False,
               existing_server_default=sa.text('now()'))
    op.create_index('ix_soil_moisture_org_device_timestamp', 'soil_moisture_readings', ['organization_id', 'device_id', 'reading_timestamp'], unique=False)
    op.create_index(op.f('ix_soil_moisture_readings_field_id'), 'soil_moisture_readings', ['field_id'], unique=False)
    op.create_index(op.f('ix_soil_moisture_readings_id'), 'soil_moisture_readings', ['id'], unique=False)
    op.drop_constraint(op.f('soil_moisture_readings_field_id_fkey'), 'soil_moisture_readings', type_='foreignkey')
    op.drop_constraint(op.f('soil_moisture_readings_device_id_fkey'), 'soil_moisture_readings', type_='foreignkey')
    op.drop_constraint(op.f('soil_moisture_readings_organization_id_fkey'), 'soil_moisture_readings', type_='foreignkey')
    op.create_foreign_key(None, 'soil_moisture_readings', 'iot_devices', ['device_id'], ['id'])
    op.create_foreign_key(None, 'soil_moisture_readings', 'organizations', ['organization_id'], ['id'])
    op.create_foreign_key(None, 'soil_moisture_readings', 'locations', ['field_id'], ['id'])
    op.alter_column('soil_tests', 'created_at',
               existing_type=postgresql.TIMESTAMP(timezone=True),
               nullable=False,
               existing_server_default=sa.text('now()'))
    op.alter_column('soil_tests', 'updated_at',
               existing_type=postgresql.TIMESTAMP(timezone=True),
               nullable=False,
               existing_server_default=sa.text('now()'))
    op.drop_constraint(op.f('soil_tests_sample_id_key'), 'soil_tests', type_='unique')
    op.drop_index(op.f('ix_soil_tests_sample_id'), table_name='soil_tests')
    op.create_index(op.f('ix_soil_tests_sample_id'), 'soil_tests', ['sample_id'], unique=True)
    op.create_index(op.f('ix_soil_tests_id'), 'soil_tests', ['id'], unique=False)
    op.drop_constraint(op.f('soil_tests_organization_id_fkey'), 'soil_tests', type_='foreignkey')
    op.create_foreign_key(None, 'soil_tests', 'organizations', ['organization_id'], ['id'])
    op.drop_constraint(op.f('space_crops_crop_code_key'), 'space_crops', type_='unique')
    op.create_index(op.f('ix_space_crops_id'), 'space_crops', ['id'], unique=False)
    op.drop_constraint(op.f('space_experiments_experiment_code_key'), 'space_experiments', type_='unique')
    op.create_index(op.f('ix_space_experiments_id'), 'space_experiments', ['id'], unique=False)
    op.alter_column('spray_applications', 'weather_conditions',
               existing_type=postgresql.JSONB(astext_type=sa.Text()),
               type_=sa.JSON(),
               existing_nullable=True)
    op.alter_column('spray_applications', 'created_at',
               existing_type=postgresql.TIMESTAMP(timezone=True),
               nullable=False,
               existing_server_default=sa.text('now()'))
    op.alter_column('spray_applications', 'updated_at',
               existing_type=postgresql.TIMESTAMP(timezone=True),
               nullable=False,
               existing_server_default=sa.text('now()'))
    op.create_index(op.f('ix_spray_applications_field_id'), 'spray_applications', ['field_id'], unique=False)
    op.create_index(op.f('ix_spray_applications_id'), 'spray_applications', ['id'], unique=False)
    op.drop_constraint(op.f('spray_applications_organization_id_fkey'), 'spray_applications', type_='foreignkey')
    op.create_foreign_key(None, 'spray_applications', 'organizations', ['organization_id'], ['id'])
    op.alter_column('studies', 'created_at',
               existing_type=postgresql.TIMESTAMP(),
               type_=sa.DateTime(timezone=True),
               existing_nullable=False)
    op.alter_column('studies', 'updated_at',
               existing_type=postgresql.TIMESTAMP(),
               type_=sa.DateTime(timezone=True),
               existing_nullable=False)
    op.drop_index(op.f('idx_studies_org_id'), table_name='studies')
    op.create_index(op.f('ix_studies_location_id'), 'studies', ['location_id'], unique=False)
    op.alter_column('sync_history', 'created_at',
               existing_type=postgresql.TIMESTAMP(),
               type_=sa.DateTime(timezone=True),
               existing_nullable=False)
    op.alter_column('sync_history', 'updated_at',
               existing_type=postgresql.TIMESTAMP(),
               type_=sa.DateTime(timezone=True),
               existing_nullable=False)
    op.drop_index(op.f('idx_sync_history_org_id'), table_name='sync_history')
    op.create_index(op.f('ix_sync_history_id'), 'sync_history', ['id'], unique=False)
    op.alter_column('sync_items', 'created_at',
               existing_type=postgresql.TIMESTAMP(),
               type_=sa.DateTime(timezone=True),
               existing_nullable=False)
    op.alter_column('sync_items', 'updated_at',
               existing_type=postgresql.TIMESTAMP(),
               type_=sa.DateTime(timezone=True),
               existing_nullable=False)
    op.drop_index(op.f('idx_sync_items_org_id'), table_name='sync_items')
    op.drop_index(op.f('ix_sync_items_status'), table_name='sync_items')
    op.create_index(op.f('ix_sync_items_id'), 'sync_items', ['id'], unique=False)
    op.alter_column('sync_settings', 'created_at',
               existing_type=postgresql.TIMESTAMP(),
               type_=sa.DateTime(timezone=True),
               existing_nullable=False)
    op.alter_column('sync_settings', 'updated_at',
               existing_type=postgresql.TIMESTAMP(),
               type_=sa.DateTime(timezone=True),
               existing_nullable=False)
    op.drop_constraint(op.f('uq_sync_settings_user'), 'sync_settings', type_='unique')
    op.drop_index(op.f('ix_sync_settings_user_id'), table_name='sync_settings')
    op.create_index(op.f('ix_sync_settings_user_id'), 'sync_settings', ['user_id'], unique=True)
    op.create_index(op.f('ix_sync_settings_id'), 'sync_settings', ['id'], unique=False)
    op.alter_column('system_settings', 'created_at',
               existing_type=postgresql.TIMESTAMP(),
               type_=sa.DateTime(timezone=True),
               existing_nullable=False,
               existing_server_default=sa.text('now()'))
    op.alter_column('system_settings', 'updated_at',
               existing_type=postgresql.TIMESTAMP(),
               type_=sa.DateTime(timezone=True),
               existing_nullable=False,
               existing_server_default=sa.text('now()'))
    op.create_index(op.f('ix_system_settings_id'), 'system_settings', ['id'], unique=False)
    op.alter_column('team_invitations', 'created_at',
               existing_type=postgresql.TIMESTAMP(),
               type_=sa.DateTime(timezone=True),
               existing_nullable=False)
    op.alter_column('team_invitations', 'updated_at',
               existing_type=postgresql.TIMESTAMP(),
               type_=sa.DateTime(timezone=True),
               existing_nullable=False)
    op.drop_index(op.f('idx_team_invitations_org_id'), table_name='team_invitations')
    op.drop_constraint(op.f('uq_team_invitations_token'), 'team_invitations', type_='unique')
    op.drop_index(op.f('ix_team_invitations_token'), table_name='team_invitations')
    op.create_index(op.f('ix_team_invitations_token'), 'team_invitations', ['token'], unique=True)
    op.create_index(op.f('ix_team_invitations_id'), 'team_invitations', ['id'], unique=False)
    op.drop_constraint(op.f('team_invitations_invited_by_id_fkey'), 'team_invitations', type_='foreignkey')
    op.drop_constraint(op.f('team_invitations_team_id_fkey'), 'team_invitations', type_='foreignkey')
    op.drop_constraint(op.f('team_invitations_organization_id_fkey'), 'team_invitations', type_='foreignkey')
    op.create_foreign_key(None, 'team_invitations', 'users', ['invited_by_id'], ['id'])
    op.create_foreign_key(None, 'team_invitations', 'organizations', ['organization_id'], ['id'])
    op.create_foreign_key(None, 'team_invitations', 'teams', ['team_id'], ['id'])
    op.alter_column('team_members', 'created_at',
               existing_type=postgresql.TIMESTAMP(),
               type_=sa.DateTime(timezone=True),
               existing_nullable=False)
    op.alter_column('team_members', 'updated_at',
               existing_type=postgresql.TIMESTAMP(),
               type_=sa.DateTime(timezone=True),
               existing_nullable=False)
    op.drop_index(op.f('idx_team_members_org_id'), table_name='team_members')
    op.drop_constraint(op.f('uq_team_members_team_user'), 'team_members', type_='unique')
    op.create_index(op.f('ix_team_members_id'), 'team_members', ['id'], unique=False)
    op.drop_constraint(op.f('team_members_team_id_fkey'), 'team_members', type_='foreignkey')
    op.drop_constraint(op.f('team_members_organization_id_fkey'), 'team_members', type_='foreignkey')
    op.drop_constraint(op.f('team_members_user_id_fkey'), 'team_members', type_='foreignkey')
    op.create_foreign_key(None, 'team_members', 'teams', ['team_id'], ['id'])
    op.create_foreign_key(None, 'team_members', 'users', ['user_id'], ['id'])
    op.create_foreign_key(None, 'team_members', 'organizations', ['organization_id'], ['id'])
    op.alter_column('teams', 'created_at',
               existing_type=postgresql.TIMESTAMP(),
               type_=sa.DateTime(timezone=True),
               existing_nullable=False)
    op.alter_column('teams', 'updated_at',
               existing_type=postgresql.TIMESTAMP(),
               type_=sa.DateTime(timezone=True),
               existing_nullable=False)
    op.drop_index(op.f('idx_teams_org_id'), table_name='teams')
    op.create_index(op.f('ix_teams_id'), 'teams', ['id'], unique=False)
    op.drop_constraint(op.f('teams_organization_id_fkey'), 'teams', type_='foreignkey')
    op.drop_constraint(op.f('teams_lead_id_fkey'), 'teams', type_='foreignkey')
    op.create_foreign_key(None, 'teams', 'users', ['lead_id'], ['id'])
    op.create_foreign_key(None, 'teams', 'organizations', ['organization_id'], ['id'])
    op.drop_index(op.f('idx_tolerance_genes_org_id'), table_name='tolerance_genes')
    op.alter_column('trial_health', 'created_at',
               existing_type=postgresql.TIMESTAMP(),
               nullable=True)
    op.alter_column('trial_health', 'updated_at',
               existing_type=postgresql.TIMESTAMP(),
               nullable=True)
    op.drop_index(op.f('idx_trial_health_org_id'), table_name='trial_health')
    op.drop_index(op.f('ix_trial_health_disease_risk'), table_name='trial_health')
    op.alter_column('trials', 'created_at',
               existing_type=postgresql.TIMESTAMP(),
               type_=sa.DateTime(timezone=True),
               existing_nullable=False)
    op.alter_column('trials', 'updated_at',
               existing_type=postgresql.TIMESTAMP(),
               type_=sa.DateTime(timezone=True),
               existing_nullable=False)
    op.drop_index(op.f('idx_trials_org_id'), table_name='trials')
    op.create_index(op.f('ix_trials_location_id'), 'trials', ['location_id'], unique=False)
    op.alter_column('user_dock_preferences', 'created_at',
               existing_type=postgresql.TIMESTAMP(),
               type_=sa.DateTime(timezone=True),
               existing_nullable=False,
               existing_server_default=sa.text('now()'))
    op.alter_column('user_dock_preferences', 'updated_at',
               existing_type=postgresql.TIMESTAMP(),
               type_=sa.DateTime(timezone=True),
               existing_nullable=False,
               existing_server_default=sa.text('now()'))
    op.drop_constraint(op.f('uq_user_dock_preferences_user_id'), 'user_dock_preferences', type_='unique')
    op.drop_index(op.f('ix_user_dock_preferences_user_id'), table_name='user_dock_preferences')
    op.create_index(op.f('ix_user_dock_preferences_user_id'), 'user_dock_preferences', ['user_id'], unique=True)
    op.create_index(op.f('ix_user_dock_preferences_id'), 'user_dock_preferences', ['id'], unique=False)
    op.drop_constraint(op.f('user_dock_preferences_user_id_fkey'), 'user_dock_preferences', type_='foreignkey')
    op.drop_constraint(op.f('user_dock_preferences_organization_id_fkey'), 'user_dock_preferences', type_='foreignkey')
    op.create_foreign_key(None, 'user_dock_preferences', 'organizations', ['organization_id'], ['id'])
    op.create_foreign_key(None, 'user_dock_preferences', 'users', ['user_id'], ['id'])
    op.alter_column('user_preferences', 'default_workspace',
               existing_type=sa.VARCHAR(length=20),
               comment=None,
               existing_comment='Default workspace: breeding, seed-ops, research, genebank, admin',
               existing_nullable=True)
    op.alter_column('user_preferences', 'recent_workspaces',
               existing_type=postgresql.JSON(astext_type=sa.Text()),
               comment=None,
               existing_comment='List of recently used workspace IDs',
               existing_nullable=True,
               existing_server_default=sa.text("'[]'::json"))
    op.alter_column('user_preferences', 'show_gateway_on_login',
               existing_type=sa.BOOLEAN(),
               comment=None,
               existing_comment='Whether to show workspace gateway on login',
               existing_nullable=True,
               existing_server_default=sa.text('true'))
    op.alter_column('user_preferences', 'last_workspace',
               existing_type=sa.VARCHAR(length=20),
               comment=None,
               existing_comment='Last active workspace',
               existing_nullable=True)
    op.alter_column('user_preferences', 'created_at',
               existing_type=postgresql.TIMESTAMP(),
               type_=sa.DateTime(timezone=True),
               existing_nullable=False)
    op.alter_column('user_preferences', 'updated_at',
               existing_type=postgresql.TIMESTAMP(),
               type_=sa.DateTime(timezone=True),
               existing_nullable=False)
    op.drop_index(op.f('idx_user_preferences_org_id'), table_name='user_preferences')
    op.drop_index(op.f('ix_user_preferences_default_workspace'), table_name='user_preferences')
    op.drop_constraint(op.f('uq_user_preferences_user'), 'user_preferences', type_='unique')
    op.drop_index(op.f('ix_user_preferences_user_id'), table_name='user_preferences')
    op.create_index(op.f('ix_user_preferences_user_id'), 'user_preferences', ['user_id'], unique=True)
    op.create_index(op.f('ix_user_preferences_id'), 'user_preferences', ['id'], unique=False)
    op.drop_constraint(op.f('user_preferences_default_program_id_fkey'), 'user_preferences', type_='foreignkey')
    op.drop_constraint(op.f('user_preferences_default_location_id_fkey'), 'user_preferences', type_='foreignkey')
    op.drop_constraint(op.f('user_preferences_organization_id_fkey'), 'user_preferences', type_='foreignkey')
    op.drop_constraint(op.f('user_preferences_user_id_fkey'), 'user_preferences', type_='foreignkey')
    op.create_foreign_key(None, 'user_preferences', 'programs', ['default_program_id'], ['id'])
    op.create_foreign_key(None, 'user_preferences', 'organizations', ['organization_id'], ['id'])
    op.create_foreign_key(None, 'user_preferences', 'locations', ['default_location_id'], ['id'])
    op.create_foreign_key(None, 'user_preferences', 'users', ['user_id'], ['id'])
    op.alter_column('user_presence', 'created_at',
               existing_type=postgresql.TIMESTAMP(),
               type_=sa.DateTime(timezone=True),
               existing_nullable=False)
    op.alter_column('user_presence', 'updated_at',
               existing_type=postgresql.TIMESTAMP(),
               type_=sa.DateTime(timezone=True),
               existing_nullable=False)
    op.drop_constraint(op.f('uq_user_presence'), 'user_presence', type_='unique')
    op.drop_index(op.f('ix_user_presence_user_id'), table_name='user_presence')
    op.create_index(op.f('ix_user_presence_user_id'), 'user_presence', ['user_id'], unique=True)
    op.create_index(op.f('ix_user_presence_id'), 'user_presence', ['id'], unique=False)
    op.alter_column('user_profiles', 'created_at',
               existing_type=postgresql.TIMESTAMP(),
               type_=sa.DateTime(timezone=True),
               existing_nullable=False)
    op.alter_column('user_profiles', 'updated_at',
               existing_type=postgresql.TIMESTAMP(),
               type_=sa.DateTime(timezone=True),
               existing_nullable=False)
    op.drop_index(op.f('idx_user_profiles_org_id'), table_name='user_profiles')
    op.drop_constraint(op.f('uq_user_profiles_user'), 'user_profiles', type_='unique')
    op.drop_index(op.f('ix_user_profiles_user_id'), table_name='user_profiles')
    op.create_index(op.f('ix_user_profiles_user_id'), 'user_profiles', ['user_id'], unique=True)
    op.create_index(op.f('ix_user_profiles_id'), 'user_profiles', ['id'], unique=False)
    op.drop_constraint(op.f('user_profiles_organization_id_fkey'), 'user_profiles', type_='foreignkey')
    op.drop_constraint(op.f('user_profiles_user_id_fkey'), 'user_profiles', type_='foreignkey')
    op.create_foreign_key(None, 'user_profiles', 'organizations', ['organization_id'], ['id'])
    op.create_foreign_key(None, 'user_profiles', 'users', ['user_id'], ['id'])
    op.alter_column('user_roles', 'granted_at',
               existing_type=postgresql.TIMESTAMP(),
               nullable=True,
               existing_server_default=sa.text('now()'))
    op.alter_column('user_roles', 'created_at',
               existing_type=postgresql.TIMESTAMP(),
               type_=sa.DateTime(timezone=True),
               existing_nullable=False,
               existing_server_default=sa.text('now()'))
    op.alter_column('user_roles', 'updated_at',
               existing_type=postgresql.TIMESTAMP(),
               type_=sa.DateTime(timezone=True),
               existing_nullable=False,
               existing_server_default=sa.text('now()'))
    op.drop_constraint(op.f('uq_user_role'), 'user_roles', type_='unique')
    op.create_index(op.f('ix_user_roles_id'), 'user_roles', ['id'], unique=False)
    op.alter_column('user_sessions', 'created_at',
               existing_type=postgresql.TIMESTAMP(),
               type_=sa.DateTime(timezone=True),
               existing_nullable=False)
    op.alter_column('user_sessions', 'updated_at',
               existing_type=postgresql.TIMESTAMP(),
               type_=sa.DateTime(timezone=True),
               existing_nullable=False)
    op.drop_index(op.f('idx_user_sessions_org_id'), table_name='user_sessions')
    op.drop_constraint(op.f('uq_user_sessions_token'), 'user_sessions', type_='unique')
    op.drop_index(op.f('ix_user_sessions_session_token'), table_name='user_sessions')
    op.create_index(op.f('ix_user_sessions_session_token'), 'user_sessions', ['session_token'], unique=True)
    op.create_index(op.f('ix_user_sessions_id'), 'user_sessions', ['id'], unique=False)
    op.drop_constraint(op.f('user_sessions_user_id_fkey'), 'user_sessions', type_='foreignkey')
    op.drop_constraint(op.f('user_sessions_organization_id_fkey'), 'user_sessions', type_='foreignkey')
    op.create_foreign_key(None, 'user_sessions', 'users', ['user_id'], ['id'])
    op.create_foreign_key(None, 'user_sessions', 'organizations', ['organization_id'], ['id'])
    # op.alter_column('users', 'created_at',
    #            existing_type=postgresql.TIMESTAMP(),
    #            type_=sa.DateTime(timezone=True),
    #            existing_nullable=False)
    # op.alter_column('users', 'updated_at',
    #            existing_type=postgresql.TIMESTAMP(),
    #            type_=sa.DateTime(timezone=True),
    #            existing_nullable=False)
    op.drop_index(op.f('idx_users_org_id'), table_name='users')
    op.alter_column('validation_issues', 'created_at',
               existing_type=postgresql.TIMESTAMP(),
               nullable=True)
    op.alter_column('validation_issues', 'updated_at',
               existing_type=postgresql.TIMESTAMP(),
               nullable=True)
    op.drop_index(op.f('idx_validation_issues_org_id'), table_name='validation_issues')
    op.alter_column('validation_rules', 'created_at',
               existing_type=postgresql.TIMESTAMP(),
               nullable=True)
    op.alter_column('validation_rules', 'updated_at',
               existing_type=postgresql.TIMESTAMP(),
               nullable=True)
    op.drop_index(op.f('idx_validation_rules_org_id'), table_name='validation_rules')
    op.drop_index(op.f('ix_validation_rules_enabled'), table_name='validation_rules')
    op.alter_column('validation_runs', 'created_at',
               existing_type=postgresql.TIMESTAMP(),
               nullable=True)
    op.alter_column('validation_runs', 'updated_at',
               existing_type=postgresql.TIMESTAMP(),
               nullable=True)
    op.drop_index(op.f('idx_validation_runs_org_id'), table_name='validation_runs')
    op.drop_index(op.f('ix_validation_runs_status'), table_name='validation_runs')
    op.alter_column('variant_sets', 'created_at',
               existing_type=postgresql.TIMESTAMP(),
               type_=sa.DateTime(timezone=True),
               nullable=False,
               existing_server_default=sa.text('now()'))
    op.alter_column('variant_sets', 'updated_at',
               existing_type=postgresql.TIMESTAMP(),
               type_=sa.DateTime(timezone=True),
               nullable=False,
               existing_server_default=sa.text('now()'))
    op.drop_index(op.f('idx_variant_sets_org_id'), table_name='variant_sets')
    op.create_index(op.f('ix_variant_sets_id'), 'variant_sets', ['id'], unique=False)
    op.alter_column('variants', 'created_at',
               existing_type=postgresql.TIMESTAMP(),
               type_=sa.DateTime(timezone=True),
               nullable=False,
               existing_server_default=sa.text('now()'))
    op.alter_column('variants', 'updated_at',
               existing_type=postgresql.TIMESTAMP(),
               type_=sa.DateTime(timezone=True),
               nullable=False,
               existing_server_default=sa.text('now()'))
    op.drop_index(op.f('idx_variants_org_id'), table_name='variants')
    op.create_index(op.f('ix_variants_id'), 'variants', ['id'], unique=False)
    op.create_index(op.f('ix_variety_footprints_id'), 'variety_footprints', ['id'], unique=False)
    op.create_index(op.f('ix_variety_footprints_season_id'), 'variety_footprints', ['season_id'], unique=False)
    op.create_index(op.f('ix_variety_footprints_study_id'), 'variety_footprints', ['study_id'], unique=False)
    op.create_index(op.f('ix_variety_footprints_trial_id'), 'variety_footprints', ['trial_id'], unique=False)
    op.create_index(op.f('ix_variety_releases_id'), 'variety_releases', ['id'], unique=False)
    op.alter_column('vendor_orders', 'created_at',
               existing_type=postgresql.TIMESTAMP(),
               type_=sa.DateTime(timezone=True),
               nullable=False,
               existing_server_default=sa.text('now()'))
    op.alter_column('vendor_orders', 'updated_at',
               existing_type=postgresql.TIMESTAMP(),
               type_=sa.DateTime(timezone=True),
               nullable=False,
               existing_server_default=sa.text('now()'))
    op.drop_index(op.f('idx_vendor_orders_org_id'), table_name='vendor_orders')
    op.create_index(op.f('ix_vendor_orders_id'), 'vendor_orders', ['id'], unique=False)
    op.alter_column('water_balances', 'created_at',
               existing_type=postgresql.TIMESTAMP(timezone=True),
               nullable=False,
               existing_server_default=sa.text('now()'))
    op.alter_column('water_balances', 'updated_at',
               existing_type=postgresql.TIMESTAMP(timezone=True),
               nullable=False,
               existing_server_default=sa.text('now()'))
    op.create_index(op.f('ix_water_balances_id'), 'water_balances', ['id'], unique=False)
    op.drop_constraint(op.f('water_balances_organization_id_fkey'), 'water_balances', type_='foreignkey')
    op.drop_constraint(op.f('water_balances_field_id_fkey'), 'water_balances', type_='foreignkey')
    op.create_foreign_key(None, 'water_balances', 'organizations', ['organization_id'], ['id'])
    op.create_foreign_key(None, 'water_balances', 'fields', ['field_id'], ['id'])
    op.alter_column('workspace_members', 'created_at',
               existing_type=postgresql.TIMESTAMP(),
               type_=sa.DateTime(timezone=True),
               existing_nullable=False)
    op.alter_column('workspace_members', 'updated_at',
               existing_type=postgresql.TIMESTAMP(),
               type_=sa.DateTime(timezone=True),
               existing_nullable=False)
    op.drop_constraint(op.f('uq_workspace_member'), 'workspace_members', type_='unique')
    op.create_index(op.f('ix_workspace_members_id'), 'workspace_members', ['id'], unique=False)
    op.alter_column('yield_predictions', 'weather_factors',
               existing_type=postgresql.JSONB(astext_type=sa.Text()),
               type_=sa.JSON(),
               existing_nullable=True)
    op.alter_column('yield_predictions', 'soil_factors',
               existing_type=postgresql.JSONB(astext_type=sa.Text()),
               type_=sa.JSON(),
               existing_nullable=True)
    op.alter_column('yield_predictions', 'management_factors',
               existing_type=postgresql.JSONB(astext_type=sa.Text()),
               type_=sa.JSON(),
               existing_nullable=True)
    op.alter_column('yield_predictions', 'created_at',
               existing_type=postgresql.TIMESTAMP(timezone=True),
               nullable=False,
               existing_server_default=sa.text('now()'))
    op.alter_column('yield_predictions', 'updated_at',
               existing_type=postgresql.TIMESTAMP(timezone=True),
               nullable=False,
               existing_server_default=sa.text('now()'))
    op.create_index(op.f('ix_yield_predictions_id'), 'yield_predictions', ['id'], unique=False)
    op.create_index(op.f('ix_yield_predictions_trial_id'), 'yield_predictions', ['trial_id'], unique=False)
    op.drop_constraint(op.f('yield_predictions_field_id_fkey'), 'yield_predictions', type_='foreignkey')
    op.drop_constraint(op.f('yield_predictions_trial_id_fkey'), 'yield_predictions', type_='foreignkey')
    op.drop_constraint(op.f('yield_predictions_organization_id_fkey'), 'yield_predictions', type_='foreignkey')
    op.create_foreign_key(None, 'yield_predictions', 'trials', ['trial_id'], ['id'])
    op.create_foreign_key(None, 'yield_predictions', 'locations', ['field_id'], ['id'])
    op.create_foreign_key(None, 'yield_predictions', 'organizations', ['organization_id'], ['id'])
    # ### end Alembic commands ###


def downgrade() -> None:
    # ### commands auto generated by Alembic - please adjust! ###
    op.drop_constraint(None, 'yield_predictions', type_='foreignkey')
    op.drop_constraint(None, 'yield_predictions', type_='foreignkey')
    op.drop_constraint(None, 'yield_predictions', type_='foreignkey')
    op.create_foreign_key(op.f('yield_predictions_organization_id_fkey'), 'yield_predictions', 'organizations', ['organization_id'], ['id'], ondelete='CASCADE')
    op.create_foreign_key(op.f('yield_predictions_trial_id_fkey'), 'yield_predictions', 'trials', ['trial_id'], ['id'], ondelete='SET NULL')
    op.create_foreign_key(op.f('yield_predictions_field_id_fkey'), 'yield_predictions', 'locations', ['field_id'], ['id'], ondelete='CASCADE')
    op.drop_index(op.f('ix_yield_predictions_trial_id'), table_name='yield_predictions')
    op.drop_index(op.f('ix_yield_predictions_id'), table_name='yield_predictions')
    op.alter_column('yield_predictions', 'updated_at',
               existing_type=postgresql.TIMESTAMP(timezone=True),
               nullable=True,
               existing_server_default=sa.text('now()'))
    op.alter_column('yield_predictions', 'created_at',
               existing_type=postgresql.TIMESTAMP(timezone=True),
               nullable=True,
               existing_server_default=sa.text('now()'))
    op.alter_column('yield_predictions', 'management_factors',
               existing_type=sa.JSON(),
               type_=postgresql.JSONB(astext_type=sa.Text()),
               existing_nullable=True)
    op.alter_column('yield_predictions', 'soil_factors',
               existing_type=sa.JSON(),
               type_=postgresql.JSONB(astext_type=sa.Text()),
               existing_nullable=True)
    op.alter_column('yield_predictions', 'weather_factors',
               existing_type=sa.JSON(),
               type_=postgresql.JSONB(astext_type=sa.Text()),
               existing_nullable=True)
    op.drop_index(op.f('ix_workspace_members_id'), table_name='workspace_members')
    op.create_unique_constraint(op.f('uq_workspace_member'), 'workspace_members', ['workspace_id', 'user_id'], postgresql_nulls_not_distinct=False)
    op.alter_column('workspace_members', 'updated_at',
               existing_type=sa.DateTime(timezone=True),
               type_=postgresql.TIMESTAMP(),
               existing_nullable=False)
    op.alter_column('workspace_members', 'created_at',
               existing_type=sa.DateTime(timezone=True),
               type_=postgresql.TIMESTAMP(),
               existing_nullable=False)
    op.drop_constraint(None, 'water_balances', type_='foreignkey')
    op.drop_constraint(None, 'water_balances', type_='foreignkey')
    op.create_foreign_key(op.f('water_balances_field_id_fkey'), 'water_balances', 'fields', ['field_id'], ['id'], ondelete='CASCADE')
    op.create_foreign_key(op.f('water_balances_organization_id_fkey'), 'water_balances', 'organizations', ['organization_id'], ['id'], ondelete='CASCADE')
    op.drop_index(op.f('ix_water_balances_id'), table_name='water_balances')
    op.alter_column('water_balances', 'updated_at',
               existing_type=postgresql.TIMESTAMP(timezone=True),
               nullable=True,
               existing_server_default=sa.text('now()'))
    op.alter_column('water_balances', 'created_at',
               existing_type=postgresql.TIMESTAMP(timezone=True),
               nullable=True,
               existing_server_default=sa.text('now()'))
    op.drop_index(op.f('ix_vendor_orders_id'), table_name='vendor_orders')
    op.create_index(op.f('idx_vendor_orders_org_id'), 'vendor_orders', ['organization_id'], unique=False)
    op.alter_column('vendor_orders', 'updated_at',
               existing_type=sa.DateTime(timezone=True),
               type_=postgresql.TIMESTAMP(),
               nullable=True,
               existing_server_default=sa.text('now()'))
    op.alter_column('vendor_orders', 'created_at',
               existing_type=sa.DateTime(timezone=True),
               type_=postgresql.TIMESTAMP(),
               nullable=True,
               existing_server_default=sa.text('now()'))
    op.drop_index(op.f('ix_variety_releases_id'), table_name='variety_releases')
    op.drop_index(op.f('ix_variety_footprints_trial_id'), table_name='variety_footprints')
    op.drop_index(op.f('ix_variety_footprints_study_id'), table_name='variety_footprints')
    op.drop_index(op.f('ix_variety_footprints_season_id'), table_name='variety_footprints')
    op.drop_index(op.f('ix_variety_footprints_id'), table_name='variety_footprints')
    op.drop_index(op.f('ix_variants_id'), table_name='variants')
    op.create_index(op.f('idx_variants_org_id'), 'variants', ['organization_id'], unique=False)
    op.alter_column('variants', 'updated_at',
               existing_type=sa.DateTime(timezone=True),
               type_=postgresql.TIMESTAMP(),
               nullable=True,
               existing_server_default=sa.text('now()'))
    op.alter_column('variants', 'created_at',
               existing_type=sa.DateTime(timezone=True),
               type_=postgresql.TIMESTAMP(),
               nullable=True,
               existing_server_default=sa.text('now()'))
    op.drop_index(op.f('ix_variant_sets_id'), table_name='variant_sets')
    op.create_index(op.f('idx_variant_sets_org_id'), 'variant_sets', ['organization_id'], unique=False)
    op.alter_column('variant_sets', 'updated_at',
               existing_type=sa.DateTime(timezone=True),
               type_=postgresql.TIMESTAMP(),
               nullable=True,
               existing_server_default=sa.text('now()'))
    op.alter_column('variant_sets', 'created_at',
               existing_type=sa.DateTime(timezone=True),
               type_=postgresql.TIMESTAMP(),
               nullable=True,
               existing_server_default=sa.text('now()'))
    op.create_index(op.f('ix_validation_runs_status'), 'validation_runs', ['status'], unique=False)
    op.create_index(op.f('idx_validation_runs_org_id'), 'validation_runs', ['organization_id'], unique=False)
    op.alter_column('validation_runs', 'updated_at',
               existing_type=postgresql.TIMESTAMP(),
               nullable=False)
    op.alter_column('validation_runs', 'created_at',
               existing_type=postgresql.TIMESTAMP(),
               nullable=False)
    op.create_index(op.f('ix_validation_rules_enabled'), 'validation_rules', ['enabled'], unique=False)
    op.create_index(op.f('idx_validation_rules_org_id'), 'validation_rules', ['organization_id'], unique=False)
    op.alter_column('validation_rules', 'updated_at',
               existing_type=postgresql.TIMESTAMP(),
               nullable=False)
    op.alter_column('validation_rules', 'created_at',
               existing_type=postgresql.TIMESTAMP(),
               nullable=False)
    op.create_index(op.f('idx_validation_issues_org_id'), 'validation_issues', ['organization_id'], unique=False)
    op.alter_column('validation_issues', 'updated_at',
               existing_type=postgresql.TIMESTAMP(),
               nullable=False)
    op.alter_column('validation_issues', 'created_at',
               existing_type=postgresql.TIMESTAMP(),
               nullable=False)
    op.create_index(op.f('idx_users_org_id'), 'users', ['organization_id'], unique=False)
    op.alter_column('users', 'updated_at',
               existing_type=sa.DateTime(timezone=True),
               type_=postgresql.TIMESTAMP(),
               existing_nullable=False)
    op.alter_column('users', 'created_at',
               existing_type=sa.DateTime(timezone=True),
               type_=postgresql.TIMESTAMP(),
               existing_nullable=False)
    op.drop_constraint(None, 'user_sessions', type_='foreignkey')
    op.drop_constraint(None, 'user_sessions', type_='foreignkey')
    op.create_foreign_key(op.f('user_sessions_organization_id_fkey'), 'user_sessions', 'organizations', ['organization_id'], ['id'], ondelete='CASCADE')
    op.create_foreign_key(op.f('user_sessions_user_id_fkey'), 'user_sessions', 'users', ['user_id'], ['id'], ondelete='CASCADE')
    op.drop_index(op.f('ix_user_sessions_id'), table_name='user_sessions')
    op.drop_index(op.f('ix_user_sessions_session_token'), table_name='user_sessions')
    op.create_index(op.f('ix_user_sessions_session_token'), 'user_sessions', ['session_token'], unique=False)
    op.create_unique_constraint(op.f('uq_user_sessions_token'), 'user_sessions', ['session_token'], postgresql_nulls_not_distinct=False)
    op.create_index(op.f('idx_user_sessions_org_id'), 'user_sessions', ['organization_id'], unique=False)
    op.alter_column('user_sessions', 'updated_at',
               existing_type=sa.DateTime(timezone=True),
               type_=postgresql.TIMESTAMP(),
               existing_nullable=False)
    op.alter_column('user_sessions', 'created_at',
               existing_type=sa.DateTime(timezone=True),
               type_=postgresql.TIMESTAMP(),
               existing_nullable=False)
    op.drop_index(op.f('ix_user_roles_id'), table_name='user_roles')
    op.create_unique_constraint(op.f('uq_user_role'), 'user_roles', ['user_id', 'role_id'], postgresql_nulls_not_distinct=False)
    op.alter_column('user_roles', 'updated_at',
               existing_type=sa.DateTime(timezone=True),
               type_=postgresql.TIMESTAMP(),
               existing_nullable=False,
               existing_server_default=sa.text('now()'))
    op.alter_column('user_roles', 'created_at',
               existing_type=sa.DateTime(timezone=True),
               type_=postgresql.TIMESTAMP(),
               existing_nullable=False,
               existing_server_default=sa.text('now()'))
    op.alter_column('user_roles', 'granted_at',
               existing_type=postgresql.TIMESTAMP(),
               nullable=False,
               existing_server_default=sa.text('now()'))
    op.drop_constraint(None, 'user_profiles', type_='foreignkey')
    op.drop_constraint(None, 'user_profiles', type_='foreignkey')
    op.create_foreign_key(op.f('user_profiles_user_id_fkey'), 'user_profiles', 'users', ['user_id'], ['id'], ondelete='CASCADE')
    op.create_foreign_key(op.f('user_profiles_organization_id_fkey'), 'user_profiles', 'organizations', ['organization_id'], ['id'], ondelete='CASCADE')
    op.drop_index(op.f('ix_user_profiles_id'), table_name='user_profiles')
    op.drop_index(op.f('ix_user_profiles_user_id'), table_name='user_profiles')
    op.create_index(op.f('ix_user_profiles_user_id'), 'user_profiles', ['user_id'], unique=False)
    op.create_unique_constraint(op.f('uq_user_profiles_user'), 'user_profiles', ['user_id'], postgresql_nulls_not_distinct=False)
    op.create_index(op.f('idx_user_profiles_org_id'), 'user_profiles', ['organization_id'], unique=False)
    op.alter_column('user_profiles', 'updated_at',
               existing_type=sa.DateTime(timezone=True),
               type_=postgresql.TIMESTAMP(),
               existing_nullable=False)
    op.alter_column('user_profiles', 'created_at',
               existing_type=sa.DateTime(timezone=True),
               type_=postgresql.TIMESTAMP(),
               existing_nullable=False)
    op.drop_index(op.f('ix_user_presence_id'), table_name='user_presence')
    op.drop_index(op.f('ix_user_presence_user_id'), table_name='user_presence')
    op.create_index(op.f('ix_user_presence_user_id'), 'user_presence', ['user_id'], unique=False)
    op.create_unique_constraint(op.f('uq_user_presence'), 'user_presence', ['user_id'], postgresql_nulls_not_distinct=False)
    op.alter_column('user_presence', 'updated_at',
               existing_type=sa.DateTime(timezone=True),
               type_=postgresql.TIMESTAMP(),
               existing_nullable=False)
    op.alter_column('user_presence', 'created_at',
               existing_type=sa.DateTime(timezone=True),
               type_=postgresql.TIMESTAMP(),
               existing_nullable=False)
    op.drop_constraint(None, 'user_preferences', type_='foreignkey')
    op.drop_constraint(None, 'user_preferences', type_='foreignkey')
    op.drop_constraint(None, 'user_preferences', type_='foreignkey')
    op.drop_constraint(None, 'user_preferences', type_='foreignkey')
    op.create_foreign_key(op.f('user_preferences_user_id_fkey'), 'user_preferences', 'users', ['user_id'], ['id'], ondelete='CASCADE')
    op.create_foreign_key(op.f('user_preferences_organization_id_fkey'), 'user_preferences', 'organizations', ['organization_id'], ['id'], ondelete='CASCADE')
    op.create_foreign_key(op.f('user_preferences_default_location_id_fkey'), 'user_preferences', 'locations', ['default_location_id'], ['id'], ondelete='SET NULL')
    op.create_foreign_key(op.f('user_preferences_default_program_id_fkey'), 'user_preferences', 'programs', ['default_program_id'], ['id'], ondelete='SET NULL')
    op.drop_index(op.f('ix_user_preferences_id'), table_name='user_preferences')
    op.drop_index(op.f('ix_user_preferences_user_id'), table_name='user_preferences')
    op.create_index(op.f('ix_user_preferences_user_id'), 'user_preferences', ['user_id'], unique=False)
    op.create_unique_constraint(op.f('uq_user_preferences_user'), 'user_preferences', ['user_id'], postgresql_nulls_not_distinct=False)
    op.create_index(op.f('ix_user_preferences_default_workspace'), 'user_preferences', ['default_workspace'], unique=False)
    op.create_index(op.f('idx_user_preferences_org_id'), 'user_preferences', ['organization_id'], unique=False)
    op.alter_column('user_preferences', 'updated_at',
               existing_type=sa.DateTime(timezone=True),
               type_=postgresql.TIMESTAMP(),
               existing_nullable=False)
    op.alter_column('user_preferences', 'created_at',
               existing_type=sa.DateTime(timezone=True),
               type_=postgresql.TIMESTAMP(),
               existing_nullable=False)
    op.alter_column('user_preferences', 'last_workspace',
               existing_type=sa.VARCHAR(length=20),
               comment='Last active workspace',
               existing_nullable=True)
    op.alter_column('user_preferences', 'show_gateway_on_login',
               existing_type=sa.BOOLEAN(),
               comment='Whether to show workspace gateway on login',
               existing_nullable=True,
               existing_server_default=sa.text('true'))
    op.alter_column('user_preferences', 'recent_workspaces',
               existing_type=postgresql.JSON(astext_type=sa.Text()),
               comment='List of recently used workspace IDs',
               existing_nullable=True,
               existing_server_default=sa.text("'[]'::json"))
    op.alter_column('user_preferences', 'default_workspace',
               existing_type=sa.VARCHAR(length=20),
               comment='Default workspace: breeding, seed-ops, research, genebank, admin',
               existing_nullable=True)
    op.drop_constraint(None, 'user_dock_preferences', type_='foreignkey')
    op.drop_constraint(None, 'user_dock_preferences', type_='foreignkey')
    op.create_foreign_key(op.f('user_dock_preferences_organization_id_fkey'), 'user_dock_preferences', 'organizations', ['organization_id'], ['id'], ondelete='CASCADE')
    op.create_foreign_key(op.f('user_dock_preferences_user_id_fkey'), 'user_dock_preferences', 'users', ['user_id'], ['id'], ondelete='CASCADE')
    op.drop_index(op.f('ix_user_dock_preferences_id'), table_name='user_dock_preferences')
    op.drop_index(op.f('ix_user_dock_preferences_user_id'), table_name='user_dock_preferences')
    op.create_index(op.f('ix_user_dock_preferences_user_id'), 'user_dock_preferences', ['user_id'], unique=False)
    op.create_unique_constraint(op.f('uq_user_dock_preferences_user_id'), 'user_dock_preferences', ['user_id'], postgresql_nulls_not_distinct=False)
    op.alter_column('user_dock_preferences', 'updated_at',
               existing_type=sa.DateTime(timezone=True),
               type_=postgresql.TIMESTAMP(),
               existing_nullable=False,
               existing_server_default=sa.text('now()'))
    op.alter_column('user_dock_preferences', 'created_at',
               existing_type=sa.DateTime(timezone=True),
               type_=postgresql.TIMESTAMP(),
               existing_nullable=False,
               existing_server_default=sa.text('now()'))
    op.drop_index(op.f('ix_trials_location_id'), table_name='trials')
    op.create_index(op.f('idx_trials_org_id'), 'trials', ['organization_id'], unique=False)
    op.alter_column('trials', 'updated_at',
               existing_type=sa.DateTime(timezone=True),
               type_=postgresql.TIMESTAMP(),
               existing_nullable=False)
    op.alter_column('trials', 'created_at',
               existing_type=sa.DateTime(timezone=True),
               type_=postgresql.TIMESTAMP(),
               existing_nullable=False)
    op.create_index(op.f('ix_trial_health_disease_risk'), 'trial_health', ['disease_risk'], unique=False)
    op.create_index(op.f('idx_trial_health_org_id'), 'trial_health', ['organization_id'], unique=False)
    op.alter_column('trial_health', 'updated_at',
               existing_type=postgresql.TIMESTAMP(),
               nullable=False)
    op.alter_column('trial_health', 'created_at',
               existing_type=postgresql.TIMESTAMP(),
               nullable=False)
    op.create_index(op.f('idx_tolerance_genes_org_id'), 'tolerance_genes', ['organization_id'], unique=False)
    op.drop_constraint(None, 'teams', type_='foreignkey')
    op.drop_constraint(None, 'teams', type_='foreignkey')
    op.create_foreign_key(op.f('teams_lead_id_fkey'), 'teams', 'users', ['lead_id'], ['id'], ondelete='SET NULL')
    op.create_foreign_key(op.f('teams_organization_id_fkey'), 'teams', 'organizations', ['organization_id'], ['id'], ondelete='CASCADE')
    op.drop_index(op.f('ix_teams_id'), table_name='teams')
    op.create_index(op.f('idx_teams_org_id'), 'teams', ['organization_id'], unique=False)
    op.alter_column('teams', 'updated_at',
               existing_type=sa.DateTime(timezone=True),
               type_=postgresql.TIMESTAMP(),
               existing_nullable=False)
    op.alter_column('teams', 'created_at',
               existing_type=sa.DateTime(timezone=True),
               type_=postgresql.TIMESTAMP(),
               existing_nullable=False)
    op.drop_constraint(None, 'team_members', type_='foreignkey')
    op.drop_constraint(None, 'team_members', type_='foreignkey')
    op.drop_constraint(None, 'team_members', type_='foreignkey')
    op.create_foreign_key(op.f('team_members_user_id_fkey'), 'team_members', 'users', ['user_id'], ['id'], ondelete='CASCADE')
    op.create_foreign_key(op.f('team_members_organization_id_fkey'), 'team_members', 'organizations', ['organization_id'], ['id'], ondelete='CASCADE')
    op.create_foreign_key(op.f('team_members_team_id_fkey'), 'team_members', 'teams', ['team_id'], ['id'], ondelete='CASCADE')
    op.drop_index(op.f('ix_team_members_id'), table_name='team_members')
    op.create_unique_constraint(op.f('uq_team_members_team_user'), 'team_members', ['team_id', 'user_id'], postgresql_nulls_not_distinct=False)
    op.create_index(op.f('idx_team_members_org_id'), 'team_members', ['organization_id'], unique=False)
    op.alter_column('team_members', 'updated_at',
               existing_type=sa.DateTime(timezone=True),
               type_=postgresql.TIMESTAMP(),
               existing_nullable=False)
    op.alter_column('team_members', 'created_at',
               existing_type=sa.DateTime(timezone=True),
               type_=postgresql.TIMESTAMP(),
               existing_nullable=False)
    op.drop_constraint(None, 'team_invitations', type_='foreignkey')
    op.drop_constraint(None, 'team_invitations', type_='foreignkey')
    op.drop_constraint(None, 'team_invitations', type_='foreignkey')
    op.create_foreign_key(op.f('team_invitations_organization_id_fkey'), 'team_invitations', 'organizations', ['organization_id'], ['id'], ondelete='CASCADE')
    op.create_foreign_key(op.f('team_invitations_team_id_fkey'), 'team_invitations', 'teams', ['team_id'], ['id'], ondelete='SET NULL')
    op.create_foreign_key(op.f('team_invitations_invited_by_id_fkey'), 'team_invitations', 'users', ['invited_by_id'], ['id'], ondelete='SET NULL')
    op.drop_index(op.f('ix_team_invitations_id'), table_name='team_invitations')
    op.drop_index(op.f('ix_team_invitations_token'), table_name='team_invitations')
    op.create_index(op.f('ix_team_invitations_token'), 'team_invitations', ['token'], unique=False)
    op.create_unique_constraint(op.f('uq_team_invitations_token'), 'team_invitations', ['token'], postgresql_nulls_not_distinct=False)
    op.create_index(op.f('idx_team_invitations_org_id'), 'team_invitations', ['organization_id'], unique=False)
    op.alter_column('team_invitations', 'updated_at',
               existing_type=sa.DateTime(timezone=True),
               type_=postgresql.TIMESTAMP(),
               existing_nullable=False)
    op.alter_column('team_invitations', 'created_at',
               existing_type=sa.DateTime(timezone=True),
               type_=postgresql.TIMESTAMP(),
               existing_nullable=False)
    op.drop_index(op.f('ix_system_settings_id'), table_name='system_settings')
    op.alter_column('system_settings', 'updated_at',
               existing_type=sa.DateTime(timezone=True),
               type_=postgresql.TIMESTAMP(),
               existing_nullable=False,
               existing_server_default=sa.text('now()'))
    op.alter_column('system_settings', 'created_at',
               existing_type=sa.DateTime(timezone=True),
               type_=postgresql.TIMESTAMP(),
               existing_nullable=False,
               existing_server_default=sa.text('now()'))
    op.drop_index(op.f('ix_sync_settings_id'), table_name='sync_settings')
    op.drop_index(op.f('ix_sync_settings_user_id'), table_name='sync_settings')
    op.create_index(op.f('ix_sync_settings_user_id'), 'sync_settings', ['user_id'], unique=False)
    op.create_unique_constraint(op.f('uq_sync_settings_user'), 'sync_settings', ['user_id'], postgresql_nulls_not_distinct=False)
    op.alter_column('sync_settings', 'updated_at',
               existing_type=sa.DateTime(timezone=True),
               type_=postgresql.TIMESTAMP(),
               existing_nullable=False)
    op.alter_column('sync_settings', 'created_at',
               existing_type=sa.DateTime(timezone=True),
               type_=postgresql.TIMESTAMP(),
               existing_nullable=False)
    op.drop_index(op.f('ix_sync_items_id'), table_name='sync_items')
    op.create_index(op.f('ix_sync_items_status'), 'sync_items', ['status'], unique=False)
    op.create_index(op.f('idx_sync_items_org_id'), 'sync_items', ['organization_id'], unique=False)
    op.alter_column('sync_items', 'updated_at',
               existing_type=sa.DateTime(timezone=True),
               type_=postgresql.TIMESTAMP(),
               existing_nullable=False)
    op.alter_column('sync_items', 'created_at',
               existing_type=sa.DateTime(timezone=True),
               type_=postgresql.TIMESTAMP(),
               existing_nullable=False)
    op.drop_index(op.f('ix_sync_history_id'), table_name='sync_history')
    op.create_index(op.f('idx_sync_history_org_id'), 'sync_history', ['organization_id'], unique=False)
    op.alter_column('sync_history', 'updated_at',
               existing_type=sa.DateTime(timezone=True),
               type_=postgresql.TIMESTAMP(),
               existing_nullable=False)
    op.alter_column('sync_history', 'created_at',
               existing_type=sa.DateTime(timezone=True),
               type_=postgresql.TIMESTAMP(),
               existing_nullable=False)
    op.drop_index(op.f('ix_studies_location_id'), table_name='studies')
    op.create_index(op.f('idx_studies_org_id'), 'studies', ['organization_id'], unique=False)
    op.alter_column('studies', 'updated_at',
               existing_type=sa.DateTime(timezone=True),
               type_=postgresql.TIMESTAMP(),
               existing_nullable=False)
    op.alter_column('studies', 'created_at',
               existing_type=sa.DateTime(timezone=True),
               type_=postgresql.TIMESTAMP(),
               existing_nullable=False)
    op.drop_constraint(None, 'spray_applications', type_='foreignkey')
    op.create_foreign_key(op.f('spray_applications_organization_id_fkey'), 'spray_applications', 'organizations', ['organization_id'], ['id'], ondelete='CASCADE')
    op.drop_index(op.f('ix_spray_applications_id'), table_name='spray_applications')
    op.drop_index(op.f('ix_spray_applications_field_id'), table_name='spray_applications')
    op.alter_column('spray_applications', 'updated_at',
               existing_type=postgresql.TIMESTAMP(timezone=True),
               nullable=True,
               existing_server_default=sa.text('now()'))
    op.alter_column('spray_applications', 'created_at',
               existing_type=postgresql.TIMESTAMP(timezone=True),
               nullable=True,
               existing_server_default=sa.text('now()'))
    op.alter_column('spray_applications', 'weather_conditions',
               existing_type=sa.JSON(),
               type_=postgresql.JSONB(astext_type=sa.Text()),
               existing_nullable=True)
    op.drop_index(op.f('ix_space_experiments_id'), table_name='space_experiments')
    op.create_unique_constraint(op.f('space_experiments_experiment_code_key'), 'space_experiments', ['experiment_code'], postgresql_nulls_not_distinct=False)
    op.drop_index(op.f('ix_space_crops_id'), table_name='space_crops')
    op.create_unique_constraint(op.f('space_crops_crop_code_key'), 'space_crops', ['crop_code'], postgresql_nulls_not_distinct=False)
    op.drop_constraint(None, 'soil_tests', type_='foreignkey')
    op.create_foreign_key(op.f('soil_tests_organization_id_fkey'), 'soil_tests', 'organizations', ['organization_id'], ['id'], ondelete='CASCADE')
    op.drop_index(op.f('ix_soil_tests_id'), table_name='soil_tests')
    op.drop_index(op.f('ix_soil_tests_sample_id'), table_name='soil_tests')
    op.create_index(op.f('ix_soil_tests_sample_id'), 'soil_tests', ['sample_id'], unique=False)
    op.create_unique_constraint(op.f('soil_tests_sample_id_key'), 'soil_tests', ['sample_id'], postgresql_nulls_not_distinct=False)
    op.alter_column('soil_tests', 'updated_at',
               existing_type=postgresql.TIMESTAMP(timezone=True),
               nullable=True,
               existing_server_default=sa.text('now()'))
    op.alter_column('soil_tests', 'created_at',
               existing_type=postgresql.TIMESTAMP(timezone=True),
               nullable=True,
               existing_server_default=sa.text('now()'))
    op.drop_constraint(None, 'soil_moisture_readings', type_='foreignkey')
    op.drop_constraint(None, 'soil_moisture_readings', type_='foreignkey')
    op.drop_constraint(None, 'soil_moisture_readings', type_='foreignkey')
    op.create_foreign_key(op.f('soil_moisture_readings_organization_id_fkey'), 'soil_moisture_readings', 'organizations', ['organization_id'], ['id'], ondelete='CASCADE')
    op.create_foreign_key(op.f('soil_moisture_readings_device_id_fkey'), 'soil_moisture_readings', 'iot_devices', ['device_id'], ['id'], ondelete='CASCADE')
    op.create_foreign_key(op.f('soil_moisture_readings_field_id_fkey'), 'soil_moisture_readings', 'locations', ['field_id'], ['id'], ondelete='SET NULL')
    op.drop_index(op.f('ix_soil_moisture_readings_id'), table_name='soil_moisture_readings')
    op.drop_index(op.f('ix_soil_moisture_readings_field_id'), table_name='soil_moisture_readings')
    op.drop_index('ix_soil_moisture_org_device_timestamp', table_name='soil_moisture_readings')
    op.alter_column('soil_moisture_readings', 'updated_at',
               existing_type=postgresql.TIMESTAMP(timezone=True),
               nullable=True,
               existing_server_default=sa.text('now()'))
    op.alter_column('soil_moisture_readings', 'created_at',
               existing_type=postgresql.TIMESTAMP(timezone=True),
               nullable=True,
               existing_server_default=sa.text('now()'))
    op.drop_constraint(None, 'soil_health_scores', type_='foreignkey')
    op.create_foreign_key(op.f('soil_health_scores_organization_id_fkey'), 'soil_health_scores', 'organizations', ['organization_id'], ['id'], ondelete='CASCADE')
    op.drop_index(op.f('ix_soil_health_scores_overall_score'), table_name='soil_health_scores')
    op.drop_index(op.f('ix_soil_health_scores_id'), table_name='soil_health_scores')
    op.drop_index(op.f('ix_soil_health_scores_field_id'), table_name='soil_health_scores')
    op.alter_column('soil_health_scores', 'updated_at',
               existing_type=postgresql.TIMESTAMP(timezone=True),
               nullable=True,
               existing_server_default=sa.text('now()'))
    op.alter_column('soil_health_scores', 'created_at',
               existing_type=postgresql.TIMESTAMP(timezone=True),
               nullable=True,
               existing_server_default=sa.text('now()'))
    op.alter_column('soil_health_scores', 'recommendations',
               existing_type=sa.JSON(),
               type_=postgresql.JSONB(astext_type=sa.Text()),
               existing_nullable=True)
    op.create_index(op.f('idx_seedlots_org_id'), 'seedlots', ['organization_id'], unique=False)
    op.alter_column('seedlots', 'updated_at',
               existing_type=sa.DateTime(timezone=True),
               type_=postgresql.TIMESTAMP(),
               existing_nullable=False)
    op.alter_column('seedlots', 'created_at',
               existing_type=sa.DateTime(timezone=True),
               type_=postgresql.TIMESTAMP(),
               existing_nullable=False)
    op.create_index(op.f('idx_seedlot_transactions_org_id'), 'seedlot_transactions', ['organization_id'], unique=False)
    op.alter_column('seedlot_transactions', 'updated_at',
               existing_type=sa.DateTime(timezone=True),
               type_=postgresql.TIMESTAMP(),
               existing_nullable=False)
    op.alter_column('seedlot_transactions', 'created_at',
               existing_type=sa.DateTime(timezone=True),
               type_=postgresql.TIMESTAMP(),
               existing_nullable=False)
    op.create_index(op.f('idx_seedling_batches_org_id'), 'seedling_batches', ['organization_id'], unique=False)
    op.drop_index(op.f('ix_seed_bank_viability_tests_organization_id'), table_name='seed_bank_viability_tests')
    op.create_index(op.f('idx_seed_bank_viability_tests_org_id'), 'seed_bank_viability_tests', ['organization_id'], unique=False)
    op.alter_column('seed_bank_viability_tests', 'status',
               existing_type=sa.Enum('SCHEDULED', 'IN_PROGRESS', 'COMPLETED', name='teststatus'),
               type_=postgresql.ENUM('scheduled', 'in-progress', 'completed', name='test_status'),
               existing_nullable=True)
    op.alter_column('seed_bank_viability_tests', 'organization_id',
               existing_type=sa.INTEGER(),
               nullable=True)
    op.drop_index(op.f('ix_seed_bank_vaults_organization_id'), table_name='seed_bank_vaults')
    op.create_index(op.f('idx_seed_bank_vaults_org_id'), 'seed_bank_vaults', ['organization_id'], unique=False)
    op.alter_column('seed_bank_vaults', 'status',
               existing_type=sa.Enum('OPTIMAL', 'WARNING', 'CRITICAL', name='vaultstatus'),
               type_=postgresql.ENUM('optimal', 'warning', 'critical', name='vault_status'),
               existing_nullable=True)
    op.alter_column('seed_bank_vaults', 'type',
               existing_type=sa.Enum('BASE', 'ACTIVE', 'CRYO', name='vaulttype'),
               type_=postgresql.ENUM('base', 'active', 'cryo', name='vault_type'),
               existing_nullable=False)
    op.alter_column('seed_bank_vaults', 'organization_id',
               existing_type=sa.INTEGER(),
               nullable=True)
    op.drop_index(op.f('ix_seed_bank_regeneration_tasks_organization_id'), table_name='seed_bank_regeneration_tasks')
    op.create_index(op.f('idx_seed_bank_regeneration_tasks_org_id'), 'seed_bank_regeneration_tasks', ['organization_id'], unique=False)
    op.alter_column('seed_bank_regeneration_tasks', 'status',
               existing_type=sa.Enum('PLANNED', 'IN_PROGRESS', 'HARVESTED', 'COMPLETED', name='regenerationstatus'),
               type_=postgresql.ENUM('planned', 'in-progress', 'harvested', 'completed', name='regeneration_status'),
               existing_nullable=True)
    op.alter_column('seed_bank_regeneration_tasks', 'priority',
               existing_type=sa.Enum('HIGH', 'MEDIUM', 'LOW', name='regenerationpriority'),
               type_=postgresql.ENUM('high', 'medium', 'low', name='regeneration_priority'),
               existing_nullable=True)
    op.alter_column('seed_bank_regeneration_tasks', 'organization_id',
               existing_type=sa.INTEGER(),
               nullable=True)
    op.drop_index(op.f('ix_seed_bank_exchanges_organization_id'), table_name='seed_bank_exchanges')
    op.create_index(op.f('idx_seed_bank_exchanges_org_id'), 'seed_bank_exchanges', ['organization_id'], unique=False)
    op.alter_column('seed_bank_exchanges', 'status',
               existing_type=sa.Enum('PENDING', 'APPROVED', 'SHIPPED', 'RECEIVED', 'REJECTED', name='exchangestatus'),
               type_=postgresql.ENUM('pending', 'approved', 'shipped', 'received', 'rejected', name='exchange_status'),
               existing_nullable=True)
    op.alter_column('seed_bank_exchanges', 'type',
               existing_type=sa.Enum('INCOMING', 'OUTGOING', name='exchangetype'),
               type_=postgresql.ENUM('incoming', 'outgoing', name='exchange_type'),
               existing_nullable=False)
    op.alter_column('seed_bank_exchanges', 'organization_id',
               existing_type=sa.INTEGER(),
               nullable=True)
    op.drop_index(op.f('ix_seed_bank_accessions_organization_id'), table_name='seed_bank_accessions')
    op.create_index(op.f('idx_seed_bank_accessions_org_id'), 'seed_bank_accessions', ['organization_id'], unique=False)
    op.alter_column('seed_bank_accessions', 'status',
               existing_type=sa.Enum('ACTIVE', 'DEPLETED', 'REGENERATING', name='accessionstatus'),
               type_=postgresql.ENUM('active', 'depleted', 'regenerating', name='accession_status'),
               existing_nullable=True)
    op.alter_column('seed_bank_accessions', 'organization_id',
               existing_type=sa.INTEGER(),
               nullable=True)
    op.drop_index(op.f('ix_seasons_id'), table_name='seasons')
    op.create_index(op.f('idx_seasons_org_id'), 'seasons', ['organization_id'], unique=False)
    op.alter_column('seasons', 'updated_at',
               existing_type=sa.DateTime(timezone=True),
               type_=postgresql.TIMESTAMP(),
               existing_nullable=False)
    op.alter_column('seasons', 'created_at',
               existing_type=sa.DateTime(timezone=True),
               type_=postgresql.TIMESTAMP(),
               existing_nullable=False)
    op.drop_index(op.f('ix_sdg_indicators_id'), table_name='sdg_indicators')
    op.drop_index(op.f('ix_samples_study_id'), table_name='samples')
    op.drop_index(op.f('ix_samples_sample_name'), table_name='samples')
    op.drop_index(op.f('ix_samples_sample_db_id'), table_name='samples')
    op.drop_index(op.f('ix_samples_organization_id'), table_name='samples')
    op.create_index(op.f('ix_samples_org_id'), 'samples', ['organization_id'], unique=False)
    op.create_index(op.f('ix_samples_name'), 'samples', ['sample_name'], unique=False)
    op.create_index(op.f('ix_samples_db_id'), 'samples', ['sample_db_id'], unique=True)
    op.create_index(op.f('idx_samples_org_id'), 'samples', ['organization_id'], unique=False)
    op.alter_column('samples', 'updated_at',
               existing_type=sa.DateTime(timezone=True),
               type_=postgresql.TIMESTAMP(),
               existing_nullable=False)
    op.alter_column('samples', 'created_at',
               existing_type=sa.DateTime(timezone=True),
               type_=postgresql.TIMESTAMP(),
               existing_nullable=False)
    op.drop_constraint(None, 'roles', type_='foreignkey')
    op.create_foreign_key(op.f('roles_organization_id_fkey'), 'roles', 'organizations', ['organization_id'], ['id'], ondelete='CASCADE')
    op.drop_index(op.f('ix_roles_id'), table_name='roles')
    op.create_index(op.f('idx_roles_org_id'), 'roles', ['organization_id'], unique=False)
    op.alter_column('roles', 'updated_at',
               existing_type=sa.DateTime(timezone=True),
               type_=postgresql.TIMESTAMP(),
               existing_nullable=False)
    op.alter_column('roles', 'created_at',
               existing_type=sa.DateTime(timezone=True),
               type_=postgresql.TIMESTAMP(),
               existing_nullable=False)
    op.create_index(op.f('idx_resistance_genes_org_id'), 'resistance_genes', ['organization_id'], unique=False)
    op.drop_index(op.f('ix_research_projects_program_id'), table_name='research_projects')
    op.drop_index(op.f('ix_report_templates_id'), table_name='report_templates')
    op.create_index(op.f('ix_report_templates_category'), 'report_templates', ['category'], unique=False)
    op.create_index(op.f('idx_report_templates_org_id'), 'report_templates', ['organization_id'], unique=False)
    op.alter_column('report_templates', 'updated_at',
               existing_type=sa.DateTime(timezone=True),
               type_=postgresql.TIMESTAMP(),
               existing_nullable=False)
    op.alter_column('report_templates', 'created_at',
               existing_type=sa.DateTime(timezone=True),
               type_=postgresql.TIMESTAMP(),
               existing_nullable=False)
    op.drop_index(op.f('ix_report_schedules_id'), table_name='report_schedules')
    op.create_index(op.f('idx_report_schedules_org_id'), 'report_schedules', ['organization_id'], unique=False)
    op.alter_column('report_schedules', 'updated_at',
               existing_type=sa.DateTime(timezone=True),
               type_=postgresql.TIMESTAMP(),
               existing_nullable=False)
    op.alter_column('report_schedules', 'created_at',
               existing_type=sa.DateTime(timezone=True),
               type_=postgresql.TIMESTAMP(),
               existing_nullable=False)
    op.drop_index(op.f('ix_references_id'), table_name='references')
    op.create_index(op.f('idx_references_org_id'), 'references', ['organization_id'], unique=False)
    op.alter_column('references', 'updated_at',
               existing_type=sa.DateTime(timezone=True),
               type_=postgresql.TIMESTAMP(),
               nullable=True,
               existing_server_default=sa.text('now()'))
    op.alter_column('references', 'created_at',
               existing_type=sa.DateTime(timezone=True),
               type_=postgresql.TIMESTAMP(),
               nullable=True,
               existing_server_default=sa.text('now()'))
    op.drop_index(op.f('ix_reference_sets_id'), table_name='reference_sets')
    op.create_index(op.f('idx_reference_sets_org_id'), 'reference_sets', ['organization_id'], unique=False)
    op.alter_column('reference_sets', 'updated_at',
               existing_type=sa.DateTime(timezone=True),
               type_=postgresql.TIMESTAMP(),
               nullable=True,
               existing_server_default=sa.text('now()'))
    op.alter_column('reference_sets', 'created_at',
               existing_type=sa.DateTime(timezone=True),
               type_=postgresql.TIMESTAMP(),
               nullable=True,
               existing_server_default=sa.text('now()'))
    op.drop_constraint(None, 'quiet_hours', type_='foreignkey')
    op.drop_constraint(None, 'quiet_hours', type_='foreignkey')
    op.create_foreign_key(op.f('quiet_hours_organization_id_fkey'), 'quiet_hours', 'organizations', ['organization_id'], ['id'], ondelete='CASCADE')
    op.create_foreign_key(op.f('quiet_hours_user_id_fkey'), 'quiet_hours', 'users', ['user_id'], ['id'], ondelete='CASCADE')
    op.drop_index(op.f('ix_quiet_hours_id'), table_name='quiet_hours')
    op.drop_index(op.f('ix_quiet_hours_user_id'), table_name='quiet_hours')
    op.create_index(op.f('ix_quiet_hours_user_id'), 'quiet_hours', ['user_id'], unique=False)
    op.create_unique_constraint(op.f('uq_quiet_hours_user'), 'quiet_hours', ['user_id'], postgresql_nulls_not_distinct=False)
    op.create_index(op.f('idx_quiet_hours_org_id'), 'quiet_hours', ['organization_id'], unique=False)
    op.alter_column('quiet_hours', 'updated_at',
               existing_type=sa.DateTime(timezone=True),
               type_=postgresql.TIMESTAMP(),
               existing_nullable=False)
    op.alter_column('quiet_hours', 'created_at',
               existing_type=sa.DateTime(timezone=True),
               type_=postgresql.TIMESTAMP(),
               existing_nullable=False)
    op.create_index(op.f('idx_pyramiding_strategies_org_id'), 'pyramiding_strategies', ['organization_id'], unique=False)
    op.drop_index(op.f('ix_publications_id'), table_name='publications')
    op.create_index(op.f('idx_programs_org_id'), 'programs', ['organization_id'], unique=False)
    op.alter_column('programs', 'updated_at',
               existing_type=sa.DateTime(timezone=True),
               type_=postgresql.TIMESTAMP(),
               existing_nullable=False)
    op.alter_column('programs', 'created_at',
               existing_type=sa.DateTime(timezone=True),
               type_=postgresql.TIMESTAMP(),
               existing_nullable=False)
    op.alter_column('programs', 'research_context',
               existing_type=sa.JSON(),
               type_=postgresql.JSONB(astext_type=sa.Text()),
               existing_nullable=True)
    op.drop_index(op.f('ix_policy_adoptions_id'), table_name='policy_adoptions')
    op.drop_index(op.f('ix_plates_id'), table_name='plates')
    op.create_index(op.f('idx_plates_org_id'), 'plates', ['organization_id'], unique=False)
    op.alter_column('plates', 'updated_at',
               existing_type=sa.DateTime(timezone=True),
               type_=postgresql.TIMESTAMP(),
               nullable=True,
               existing_server_default=sa.text('now()'))
    op.alter_column('plates', 'created_at',
               existing_type=sa.DateTime(timezone=True),
               type_=postgresql.TIMESTAMP(),
               nullable=True,
               existing_server_default=sa.text('now()'))
    op.create_index(op.f('idx_planned_crosses_org_id'), 'planned_crosses', ['organization_id'], unique=False)
    op.alter_column('planned_crosses', 'updated_at',
               existing_type=sa.DateTime(timezone=True),
               type_=postgresql.TIMESTAMP(),
               existing_nullable=False)
    op.alter_column('planned_crosses', 'created_at',
               existing_type=sa.DateTime(timezone=True),
               type_=postgresql.TIMESTAMP(),
               existing_nullable=False)
    op.drop_index(op.f('ix_phenomic_models_id'), table_name='phenomic_models')
    op.create_unique_constraint(op.f('phenomic_models_model_code_key'), 'phenomic_models', ['model_code'], postgresql_nulls_not_distinct=False)
    op.drop_index(op.f('ix_phenomic_datasets_id'), table_name='phenomic_datasets')
    op.create_unique_constraint(op.f('phenomic_datasets_dataset_code_key'), 'phenomic_datasets', ['dataset_code'], postgresql_nulls_not_distinct=False)
    op.drop_constraint(None, 'pest_observations', type_='foreignkey')
    op.drop_constraint(None, 'pest_observations', type_='foreignkey')
    op.drop_constraint(None, 'pest_observations', type_='foreignkey')
    op.create_foreign_key(op.f('pest_observations_study_id_fkey'), 'pest_observations', 'studies', ['study_id'], ['id'], ondelete='SET NULL')
    op.create_foreign_key(op.f('pest_observations_field_id_fkey'), 'pest_observations', 'locations', ['field_id'], ['id'], ondelete='CASCADE')
    op.create_foreign_key(op.f('pest_observations_organization_id_fkey'), 'pest_observations', 'organizations', ['organization_id'], ['id'], ondelete='CASCADE')
    op.drop_index(op.f('ix_pest_observations_study_id'), table_name='pest_observations')
    op.drop_index(op.f('ix_pest_observations_id'), table_name='pest_observations')
    op.alter_column('pest_observations', 'updated_at',
               existing_type=postgresql.TIMESTAMP(timezone=True),
               nullable=True,
               existing_server_default=sa.text('now()'))
    op.alter_column('pest_observations', 'created_at',
               existing_type=postgresql.TIMESTAMP(timezone=True),
               nullable=True,
               existing_server_default=sa.text('now()'))
    op.alter_column('pest_observations', 'image_urls',
               existing_type=sa.JSON(),
               type_=postgresql.JSONB(astext_type=sa.Text()),
               existing_nullable=True)
    op.alter_column('pest_observations', 'weather_conditions',
               existing_type=sa.JSON(),
               type_=postgresql.JSONB(astext_type=sa.Text()),
               existing_nullable=True)
    op.drop_index(op.f('ix_people_organization_id'), table_name='people')
    op.create_index(op.f('idx_people_org_id'), 'people', ['organization_id'], unique=False)
    op.alter_column('people', 'updated_at',
               existing_type=sa.DateTime(timezone=True),
               type_=postgresql.TIMESTAMP(),
               existing_nullable=False)
    op.alter_column('people', 'created_at',
               existing_type=sa.DateTime(timezone=True),
               type_=postgresql.TIMESTAMP(),
               existing_nullable=False)
    op.alter_column('organizations', 'updated_at',
               existing_type=sa.DateTime(timezone=True),
               type_=postgresql.TIMESTAMP(),
               existing_nullable=False)
    op.alter_column('organizations', 'created_at',
               existing_type=sa.DateTime(timezone=True),
               type_=postgresql.TIMESTAMP(),
               existing_nullable=False)
    op.drop_index(op.f('ix_ontologies_id'), table_name='ontologies')
    op.create_index(op.f('idx_ontologies_org_id'), 'ontologies', ['organization_id'], unique=False)
    op.alter_column('ontologies', 'updated_at',
               existing_type=sa.DateTime(timezone=True),
               type_=postgresql.TIMESTAMP(),
               existing_nullable=False)
    op.alter_column('ontologies', 'created_at',
               existing_type=sa.DateTime(timezone=True),
               type_=postgresql.TIMESTAMP(),
               existing_nullable=False)
    op.drop_index(op.f('ix_offline_data_cache_organization_id'), table_name='offline_data_cache')
    op.drop_index(op.f('ix_offline_data_cache_id'), table_name='offline_data_cache')
    op.create_unique_constraint(op.f('uq_user_cache_category'), 'offline_data_cache', ['user_id', 'category'], postgresql_nulls_not_distinct=False)
    op.create_index(op.f('idx_offline_data_cache_org_id'), 'offline_data_cache', ['organization_id'], unique=False)
    op.alter_column('offline_data_cache', 'updated_at',
               existing_type=sa.DateTime(timezone=True),
               type_=postgresql.TIMESTAMP(),
               existing_nullable=False)
    op.alter_column('offline_data_cache', 'created_at',
               existing_type=sa.DateTime(timezone=True),
               type_=postgresql.TIMESTAMP(),
               existing_nullable=False)
    op.drop_index(op.f('ix_observations_organization_id'), table_name='observations')
    op.drop_index(op.f('ix_observations_observation_variable_id'), table_name='observations')
    op.drop_index(op.f('ix_observations_observation_unit_id'), table_name='observations')
    op.drop_index(op.f('ix_observations_observation_db_id'), table_name='observations')
    op.drop_index(op.f('ix_observations_germplasm_id'), table_name='observations')
    op.create_index(op.f('ix_observations_variable_id'), 'observations', ['observation_variable_id'], unique=False)
    op.create_index(op.f('ix_observations_unit_id'), 'observations', ['observation_unit_id'], unique=False)
    op.create_index(op.f('ix_observations_org_id'), 'observations', ['organization_id'], unique=False)
    op.create_index(op.f('ix_observations_db_id'), 'observations', ['observation_db_id'], unique=True)
    op.create_index(op.f('idx_observations_org_id'), 'observations', ['organization_id'], unique=False)
    op.alter_column('observations', 'updated_at',
               existing_type=sa.DateTime(timezone=True),
               type_=postgresql.TIMESTAMP(),
               existing_nullable=False)
    op.alter_column('observations', 'created_at',
               existing_type=sa.DateTime(timezone=True),
               type_=postgresql.TIMESTAMP(),
               existing_nullable=False)
    op.drop_index(op.f('ix_observation_variables_organization_id'), table_name='observation_variables')
    op.drop_index(op.f('ix_observation_variables_observation_variable_name'), table_name='observation_variables')
    op.drop_index(op.f('ix_observation_variables_observation_variable_db_id'), table_name='observation_variables')
    op.create_index(op.f('ix_observation_variables_org_id'), 'observation_variables', ['organization_id'], unique=False)
    op.create_index(op.f('ix_observation_variables_name'), 'observation_variables', ['observation_variable_name'], unique=False)
    op.create_index(op.f('ix_observation_variables_db_id'), 'observation_variables', ['observation_variable_db_id'], unique=True)
    op.create_index(op.f('idx_observation_variables_org_id'), 'observation_variables', ['organization_id'], unique=False)
    op.alter_column('observation_variables', 'updated_at',
               existing_type=sa.DateTime(timezone=True),
               type_=postgresql.TIMESTAMP(),
               existing_nullable=False)
    op.alter_column('observation_variables', 'created_at',
               existing_type=sa.DateTime(timezone=True),
               type_=postgresql.TIMESTAMP(),
               existing_nullable=False)
    op.drop_index(op.f('ix_observation_units_organization_id'), table_name='observation_units')
    op.drop_index(op.f('ix_observation_units_observation_unit_name'), table_name='observation_units')
    op.drop_index(op.f('ix_observation_units_observation_unit_db_id'), table_name='observation_units')
    op.create_index(op.f('ix_observation_units_org_id'), 'observation_units', ['organization_id'], unique=False)
    op.create_index(op.f('ix_observation_units_name'), 'observation_units', ['observation_unit_name'], unique=False)
    op.create_index(op.f('ix_observation_units_db_id'), 'observation_units', ['observation_unit_db_id'], unique=True)
    op.create_index(op.f('idx_observation_units_org_id'), 'observation_units', ['organization_id'], unique=False)
    op.alter_column('observation_units', 'updated_at',
               existing_type=sa.DateTime(timezone=True),
               type_=postgresql.TIMESTAMP(),
               existing_nullable=False)
    op.alter_column('observation_units', 'created_at',
               existing_type=sa.DateTime(timezone=True),
               type_=postgresql.TIMESTAMP(),
               existing_nullable=False)
    op.create_index(op.f('idx_nursery_locations_org_id'), 'nursery_locations', ['organization_id'], unique=False)
    op.drop_constraint(None, 'notifications', type_='foreignkey')
    op.drop_constraint(None, 'notifications', type_='foreignkey')
    op.create_foreign_key(op.f('notifications_organization_id_fkey'), 'notifications', 'organizations', ['organization_id'], ['id'], ondelete='CASCADE')
    op.create_foreign_key(op.f('notifications_user_id_fkey'), 'notifications', 'users', ['user_id'], ['id'], ondelete='CASCADE')
    op.drop_index(op.f('ix_notifications_id'), table_name='notifications')
    op.create_index(op.f('ix_notifications_created_at'), 'notifications', ['created_at'], unique=False)
    op.create_index(op.f('idx_notifications_org_id'), 'notifications', ['organization_id'], unique=False)
    op.alter_column('notifications', 'updated_at',
               existing_type=sa.DateTime(timezone=True),
               type_=postgresql.TIMESTAMP(),
               existing_nullable=False)
    op.alter_column('notifications', 'created_at',
               existing_type=sa.DateTime(timezone=True),
               type_=postgresql.TIMESTAMP(),
               existing_nullable=False)
    op.drop_constraint(None, 'notification_preferences', type_='foreignkey')
    op.drop_constraint(None, 'notification_preferences', type_='foreignkey')
    op.create_foreign_key(op.f('notification_preferences_user_id_fkey'), 'notification_preferences', 'users', ['user_id'], ['id'], ondelete='CASCADE')
    op.create_foreign_key(op.f('notification_preferences_organization_id_fkey'), 'notification_preferences', 'organizations', ['organization_id'], ['id'], ondelete='CASCADE')
    op.drop_index(op.f('ix_notification_preferences_id'), table_name='notification_preferences')
    op.create_unique_constraint(op.f('uq_notification_pref_user_category'), 'notification_preferences', ['user_id', 'category'], postgresql_nulls_not_distinct=False)
    op.create_index(op.f('idx_notification_preferences_org_id'), 'notification_preferences', ['organization_id'], unique=False)
    op.alter_column('notification_preferences', 'updated_at',
               existing_type=sa.DateTime(timezone=True),
               type_=postgresql.TIMESTAMP(),
               existing_nullable=False)
    op.alter_column('notification_preferences', 'created_at',
               existing_type=sa.DateTime(timezone=True),
               type_=postgresql.TIMESTAMP(),
               existing_nullable=False)
    op.drop_index(op.f('ix_messages_id'), table_name='messages')
    op.alter_column('messages', 'updated_at',
               existing_type=sa.DateTime(timezone=True),
               type_=postgresql.TIMESTAMP(),
               existing_nullable=False,
               existing_server_default=sa.text('now()'))
    op.alter_column('messages', 'created_at',
               existing_type=sa.DateTime(timezone=True),
               type_=postgresql.TIMESTAMP(),
               existing_nullable=False,
               existing_server_default=sa.text('now()'))
    op.drop_index(op.f('ix_marker_positions_variant_name'), table_name='marker_positions')
    op.drop_index(op.f('ix_marker_positions_id'), table_name='marker_positions')
    op.create_index(op.f('idx_marker_positions_org_id'), 'marker_positions', ['organization_id'], unique=False)
    op.alter_column('marker_positions', 'updated_at',
               existing_type=sa.DateTime(timezone=True),
               type_=postgresql.TIMESTAMP(),
               nullable=True,
               existing_server_default=sa.text('now()'))
    op.alter_column('marker_positions', 'created_at',
               existing_type=sa.DateTime(timezone=True),
               type_=postgresql.TIMESTAMP(),
               nullable=True,
               existing_server_default=sa.text('now()'))
    op.drop_index(op.f('ix_locations_organization_id'), table_name='locations')
    op.create_index(op.f('idx_locations_org_id'), 'locations', ['organization_id'], unique=False)
    op.alter_column('locations', 'updated_at',
               existing_type=sa.DateTime(timezone=True),
               type_=postgresql.TIMESTAMP(),
               existing_nullable=False)
    op.alter_column('locations', 'created_at',
               existing_type=sa.DateTime(timezone=True),
               type_=postgresql.TIMESTAMP(),
               existing_nullable=False)
    op.drop_index(op.f('ix_lists_id'), table_name='lists')
    op.create_index(op.f('idx_lists_org_id'), 'lists', ['organization_id'], unique=False)
    op.alter_column('lists', 'updated_at',
               existing_type=sa.DateTime(timezone=True),
               type_=postgresql.TIMESTAMP(),
               existing_nullable=False)
    op.alter_column('lists', 'created_at',
               existing_type=sa.DateTime(timezone=True),
               type_=postgresql.TIMESTAMP(),
               existing_nullable=False)
    op.drop_index(op.f('ix_linkage_groups_id'), table_name='linkage_groups')
    op.create_index(op.f('idx_linkage_groups_org_id'), 'linkage_groups', ['organization_id'], unique=False)
    op.alter_column('linkage_groups', 'updated_at',
               existing_type=sa.DateTime(timezone=True),
               type_=postgresql.TIMESTAMP(),
               nullable=True,
               existing_server_default=sa.text('now()'))
    op.alter_column('linkage_groups', 'created_at',
               existing_type=sa.DateTime(timezone=True),
               type_=postgresql.TIMESTAMP(),
               nullable=True,
               existing_server_default=sa.text('now()'))
    op.drop_constraint(None, 'irrigation_schedules', type_='foreignkey')
    op.create_foreign_key(op.f('irrigation_schedules_organization_id_fkey'), 'irrigation_schedules', 'organizations', ['organization_id'], ['id'], ondelete='CASCADE')
    op.drop_index(op.f('ix_irrigation_schedules_id'), table_name='irrigation_schedules')
    op.drop_index(op.f('ix_irrigation_schedules_field_id'), table_name='irrigation_schedules')
    op.alter_column('irrigation_schedules', 'updated_at',
               existing_type=postgresql.TIMESTAMP(timezone=True),
               nullable=True,
               existing_server_default=sa.text('now()'))
    op.alter_column('irrigation_schedules', 'created_at',
               existing_type=postgresql.TIMESTAMP(timezone=True),
               nullable=True,
               existing_server_default=sa.text('now()'))
    op.alter_column('irrigation_schedules', 'status',
               existing_type=sa.Enum('planned', 'in_progress', 'completed', 'canceled', name='irrigationstatus'),
               type_=sa.VARCHAR(length=20),
               existing_nullable=True,
               existing_server_default=sa.text("'planned'::character varying"))
    op.drop_constraint(None, 'ipm_strategies', type_='foreignkey')
    op.drop_constraint(None, 'ipm_strategies', type_='foreignkey')
    op.create_foreign_key(op.f('ipm_strategies_organization_id_fkey'), 'ipm_strategies', 'organizations', ['organization_id'], ['id'], ondelete='CASCADE')
    op.create_foreign_key(op.f('ipm_strategies_field_id_fkey'), 'ipm_strategies', 'locations', ['field_id'], ['id'], ondelete='SET NULL')
    op.drop_index(op.f('ix_ipm_strategies_id'), table_name='ipm_strategies')
    op.drop_index(op.f('ix_ipm_strategies_field_id'), table_name='ipm_strategies')
    op.alter_column('ipm_strategies', 'updated_at',
               existing_type=postgresql.TIMESTAMP(timezone=True),
               nullable=True,
               existing_server_default=sa.text('now()'))
    op.alter_column('ipm_strategies', 'created_at',
               existing_type=postgresql.TIMESTAMP(timezone=True),
               nullable=True,
               existing_server_default=sa.text('now()'))
    op.alter_column('ipm_strategies', 'growth_stages',
               existing_type=sa.JSON(),
               type_=postgresql.JSONB(astext_type=sa.Text()),
               existing_nullable=True)
    op.alter_column('ipm_strategies', 'chemical_controls',
               existing_type=sa.JSON(),
               type_=postgresql.JSONB(astext_type=sa.Text()),
               existing_nullable=True)
    op.alter_column('ipm_strategies', 'physical_controls',
               existing_type=sa.JSON(),
               type_=postgresql.JSONB(astext_type=sa.Text()),
               existing_nullable=True)
    op.alter_column('ipm_strategies', 'biological_controls',
               existing_type=sa.JSON(),
               type_=postgresql.JSONB(astext_type=sa.Text()),
               existing_nullable=True)
    op.alter_column('ipm_strategies', 'monitoring_methods',
               existing_type=sa.JSON(),
               type_=postgresql.JSONB(astext_type=sa.Text()),
               existing_nullable=True)
    op.alter_column('ipm_strategies', 'prevention_methods',
               existing_type=sa.JSON(),
               type_=postgresql.JSONB(astext_type=sa.Text()),
               existing_nullable=True)
    op.drop_index(op.f('ix_iot_telemetry_id'), table_name='iot_telemetry')
    op.alter_column('iot_telemetry', 'updated_at',
               existing_type=sa.DateTime(timezone=True),
               type_=postgresql.TIMESTAMP(),
               existing_nullable=False,
               existing_server_default=sa.text('now()'))
    op.alter_column('iot_telemetry', 'created_at',
               existing_type=sa.DateTime(timezone=True),
               type_=postgresql.TIMESTAMP(),
               existing_nullable=False,
               existing_server_default=sa.text('now()'))
    op.drop_index(op.f('ix_iot_sensors_id'), table_name='iot_sensors')
    op.alter_column('iot_sensors', 'updated_at',
               existing_type=sa.DateTime(timezone=True),
               type_=postgresql.TIMESTAMP(),
               existing_nullable=False,
               existing_server_default=sa.text('now()'))
    op.alter_column('iot_sensors', 'created_at',
               existing_type=sa.DateTime(timezone=True),
               type_=postgresql.TIMESTAMP(),
               existing_nullable=False,
               existing_server_default=sa.text('now()'))
    op.drop_index(op.f('ix_iot_environment_links_id'), table_name='iot_environment_links')
    op.alter_column('iot_environment_links', 'updated_at',
               existing_type=sa.DateTime(timezone=True),
               type_=postgresql.TIMESTAMP(),
               existing_nullable=False,
               existing_server_default=sa.text('now()'))
    op.alter_column('iot_environment_links', 'created_at',
               existing_type=sa.DateTime(timezone=True),
               type_=postgresql.TIMESTAMP(),
               existing_nullable=False,
               existing_server_default=sa.text('now()'))
    op.drop_index(op.f('ix_iot_devices_study_id'), table_name='iot_devices')
    op.drop_index(op.f('ix_iot_devices_id'), table_name='iot_devices')
    op.drop_index(op.f('ix_iot_devices_field_id'), table_name='iot_devices')
    op.create_index(op.f('idx_iot_devices_org_id'), 'iot_devices', ['organization_id'], unique=False)
    op.alter_column('iot_devices', 'updated_at',
               existing_type=sa.DateTime(timezone=True),
               type_=postgresql.TIMESTAMP(),
               existing_nullable=False,
               existing_server_default=sa.text('now()'))
    op.alter_column('iot_devices', 'created_at',
               existing_type=sa.DateTime(timezone=True),
               type_=postgresql.TIMESTAMP(),
               existing_nullable=False,
               existing_server_default=sa.text('now()'))
    op.drop_index(op.f('ix_iot_alert_rules_id'), table_name='iot_alert_rules')
    op.create_index(op.f('idx_iot_alert_rules_org_id'), 'iot_alert_rules', ['organization_id'], unique=False)
    op.alter_column('iot_alert_rules', 'updated_at',
               existing_type=sa.DateTime(timezone=True),
               type_=postgresql.TIMESTAMP(),
               existing_nullable=False,
               existing_server_default=sa.text('now()'))
    op.alter_column('iot_alert_rules', 'created_at',
               existing_type=sa.DateTime(timezone=True),
               type_=postgresql.TIMESTAMP(),
               existing_nullable=False,
               existing_server_default=sa.text('now()'))
    op.drop_index(op.f('ix_iot_alert_events_id'), table_name='iot_alert_events')
    op.alter_column('iot_alert_events', 'updated_at',
               existing_type=sa.DateTime(timezone=True),
               type_=postgresql.TIMESTAMP(),
               existing_nullable=False,
               existing_server_default=sa.text('now()'))
    op.alter_column('iot_alert_events', 'created_at',
               existing_type=sa.DateTime(timezone=True),
               type_=postgresql.TIMESTAMP(),
               existing_nullable=False,
               existing_server_default=sa.text('now()'))
    op.drop_index(op.f('ix_iot_aggregates_id'), table_name='iot_aggregates')
    op.alter_column('iot_aggregates', 'updated_at',
               existing_type=sa.DateTime(timezone=True),
               type_=postgresql.TIMESTAMP(),
               existing_nullable=False,
               existing_server_default=sa.text('now()'))
    op.alter_column('iot_aggregates', 'created_at',
               existing_type=sa.DateTime(timezone=True),
               type_=postgresql.TIMESTAMP(),
               existing_nullable=False,
               existing_server_default=sa.text('now()'))
    op.drop_index(op.f('ix_impact_reports_id'), table_name='impact_reports')
    op.drop_index(op.f('ix_impact_metrics_id'), table_name='impact_metrics')
    op.drop_index(op.f('ix_images_organization_id'), table_name='images')
    op.drop_index(op.f('ix_images_image_name'), table_name='images')
    op.drop_index(op.f('ix_images_image_db_id'), table_name='images')
    op.create_index(op.f('ix_images_org_id'), 'images', ['organization_id'], unique=False)
    op.create_index(op.f('ix_images_name'), 'images', ['image_name'], unique=False)
    op.create_index(op.f('ix_images_db_id'), 'images', ['image_db_id'], unique=True)
    op.create_index(op.f('idx_images_org_id'), 'images', ['organization_id'], unique=False)
    op.alter_column('images', 'updated_at',
               existing_type=sa.DateTime(timezone=True),
               type_=postgresql.TIMESTAMP(),
               existing_nullable=False)
    op.alter_column('images', 'created_at',
               existing_type=sa.DateTime(timezone=True),
               type_=postgresql.TIMESTAMP(),
               existing_nullable=False)
    op.create_index(op.f('ix_health_alerts_severity'), 'health_alerts', ['severity'], unique=False)
    op.create_index(op.f('ix_health_alerts_acknowledged'), 'health_alerts', ['acknowledged'], unique=False)
    op.create_index(op.f('idx_health_alerts_org_id'), 'health_alerts', ['organization_id'], unique=False)
    op.alter_column('health_alerts', 'updated_at',
               existing_type=postgresql.TIMESTAMP(),
               nullable=False)
    op.alter_column('health_alerts', 'created_at',
               existing_type=postgresql.TIMESTAMP(),
               nullable=False)
    op.drop_index(op.f('ix_growing_degree_day_logs_organization_id'), table_name='growing_degree_day_logs')
    op.drop_index(op.f('ix_growing_degree_day_logs_log_date'), table_name='growing_degree_day_logs')
    op.drop_index(op.f('ix_growing_degree_day_logs_id'), table_name='growing_degree_day_logs')
    op.drop_index(op.f('ix_growing_degree_day_logs_field_id'), table_name='growing_degree_day_logs')
    op.drop_index(op.f('ix_growing_degree_day_logs_crop_name'), table_name='growing_degree_day_logs')
    op.drop_index('ix_gdd_org_field_date', table_name='growing_degree_day_logs')
    op.drop_index('ix_gdd_org_crop_date', table_name='growing_degree_day_logs')
    op.create_index(op.f('ix_gdd_organization_id'), 'growing_degree_day_logs', ['organization_id'], unique=False)
    op.create_index(op.f('ix_gdd_log_date'), 'growing_degree_day_logs', ['log_date'], unique=False)
    op.create_index(op.f('ix_gdd_crop_name'), 'growing_degree_day_logs', ['crop_name'], unique=False)
    op.alter_column('growing_degree_day_logs', 'updated_at',
               existing_type=postgresql.TIMESTAMP(timezone=True),
               nullable=True,
               existing_server_default=sa.text('now()'))
    op.alter_column('growing_degree_day_logs', 'created_at',
               existing_type=postgresql.TIMESTAMP(timezone=True),
               nullable=True,
               existing_server_default=sa.text('now()'))
    op.alter_column('growing_degree_day_logs', 'growth_stage',
               existing_type=sa.VARCHAR(length=100),
               comment=None,
               existing_comment="Predicted or observed growth stage (e.g., 'V6', 'R1', 'Flowering')",
               existing_nullable=True)
    op.alter_column('growing_degree_day_logs', 'min_temperature',
               existing_type=sa.DOUBLE_PRECISION(precision=53),
               comment=None,
               existing_comment='Daily minimum temperature in Celsius',
               existing_nullable=True)
    op.alter_column('growing_degree_day_logs', 'max_temperature',
               existing_type=sa.DOUBLE_PRECISION(precision=53),
               comment=None,
               existing_comment='Daily maximum temperature in Celsius',
               existing_nullable=True)
    op.alter_column('growing_degree_day_logs', 'base_temperature',
               existing_type=sa.DOUBLE_PRECISION(precision=53),
               comment=None,
               existing_comment='Base temperature in Celsius (crop-specific)',
               existing_nullable=False,
               existing_server_default=sa.text("'10'::double precision"))
    op.alter_column('growing_degree_day_logs', 'cumulative_gdd',
               existing_type=sa.DOUBLE_PRECISION(precision=53),
               comment=None,
               existing_comment='Total GDD since planting date',
               existing_nullable=False)
    op.alter_column('growing_degree_day_logs', 'daily_gdd',
               existing_type=sa.DOUBLE_PRECISION(precision=53),
               comment=None,
               existing_comment='GDD accumulated on this day (always >= 0)',
               existing_nullable=False)
    op.create_index(op.f('ix_germplasm_collections_status'), 'germplasm_collections', ['status'], unique=False)
    op.create_index(op.f('idx_germplasm_collections_org_id'), 'germplasm_collections', ['organization_id'], unique=False)
    op.alter_column('germplasm_collections', 'updated_at',
               existing_type=postgresql.TIMESTAMP(),
               nullable=False)
    op.alter_column('germplasm_collections', 'created_at',
               existing_type=postgresql.TIMESTAMP(),
               nullable=False)
    op.add_column('germplasm_collection_members', sa.Column('updated_at', postgresql.TIMESTAMP(), autoincrement=False, nullable=False))
    op.add_column('germplasm_collection_members', sa.Column('created_at', postgresql.TIMESTAMP(), autoincrement=False, nullable=False))
    op.create_index(op.f('ix_germplasm_collection_members_unique'), 'germplasm_collection_members', ['collection_id', 'germplasm_id'], unique=True)
    op.create_index(op.f('idx_germplasm_attributes_org_id'), 'germplasm_attributes', ['organization_id'], unique=False)
    op.alter_column('germplasm_attributes', 'updated_at',
               existing_type=sa.DateTime(timezone=True),
               type_=postgresql.TIMESTAMP(),
               existing_nullable=False)
    op.alter_column('germplasm_attributes', 'created_at',
               existing_type=sa.DateTime(timezone=True),
               type_=postgresql.TIMESTAMP(),
               existing_nullable=False)
    op.create_index(op.f('idx_germplasm_org_id'), 'germplasm', ['organization_id'], unique=False)
    op.alter_column('germplasm', 'updated_at',
               existing_type=sa.DateTime(timezone=True),
               type_=postgresql.TIMESTAMP(),
               existing_nullable=False)
    op.alter_column('germplasm', 'created_at',
               existing_type=sa.DateTime(timezone=True),
               type_=postgresql.TIMESTAMP(),
               existing_nullable=False)
    op.drop_index(op.f('ix_genome_maps_id'), table_name='genome_maps')
    op.create_index(op.f('idx_genome_maps_org_id'), 'genome_maps', ['organization_id'], unique=False)
    op.alter_column('genome_maps', 'updated_at',
               existing_type=sa.DateTime(timezone=True),
               type_=postgresql.TIMESTAMP(),
               nullable=True,
               existing_server_default=sa.text('now()'))
    op.alter_column('genome_maps', 'created_at',
               existing_type=sa.DateTime(timezone=True),
               type_=postgresql.TIMESTAMP(),
               nullable=True,
               existing_server_default=sa.text('now()'))
    op.drop_index(op.f('ix_generated_reports_schedule_id'), table_name='generated_reports')
    op.drop_index(op.f('ix_generated_reports_id'), table_name='generated_reports')
    op.create_index(op.f('idx_generated_reports_org_id'), 'generated_reports', ['organization_id'], unique=False)
    op.alter_column('generated_reports', 'updated_at',
               existing_type=sa.DateTime(timezone=True),
               type_=postgresql.TIMESTAMP(),
               existing_nullable=False)
    op.alter_column('generated_reports', 'created_at',
               existing_type=sa.DateTime(timezone=True),
               type_=postgresql.TIMESTAMP(),
               existing_nullable=False)
    op.drop_index(op.f('ix_gdd_predictions_organization_id'), table_name='gdd_predictions')
    op.drop_index(op.f('ix_gdd_predictions_id'), table_name='gdd_predictions')
    op.drop_index(op.f('ix_gdd_predictions_field_id'), table_name='gdd_predictions')
    op.drop_index(op.f('ix_gdd_predictions_crop_name'), table_name='gdd_predictions')
    op.alter_column('gdd_predictions', 'updated_at',
               existing_type=postgresql.TIMESTAMP(timezone=True),
               nullable=True,
               existing_server_default=sa.text('now()'))
    op.alter_column('gdd_predictions', 'created_at',
               existing_type=postgresql.TIMESTAMP(timezone=True),
               nullable=True,
               existing_server_default=sa.text('now()'))
    op.drop_index(op.f('ix_firms_id'), table_name='firms')
    op.drop_index(op.f('ix_firms_firm_code'), table_name='firms')
    op.create_unique_constraint(op.f('firms_firm_code_key'), 'firms', ['firm_code'], postgresql_nulls_not_distinct=False)
    op.drop_constraint(None, 'fields', type_='foreignkey')
    op.drop_constraint(None, 'fields', type_='foreignkey')
    op.create_foreign_key(op.f('fields_location_id_fkey'), 'fields', 'locations', ['location_id'], ['id'], ondelete='SET NULL')
    op.create_foreign_key(op.f('fields_organization_id_fkey'), 'fields', 'organizations', ['organization_id'], ['id'], ondelete='CASCADE')
    op.drop_index(op.f('ix_fields_id'), table_name='fields')
    op.drop_index('idx_fields_geometry', table_name='fields', postgresql_using='gist')
    op.alter_column('fields', 'updated_at',
               existing_type=postgresql.TIMESTAMP(timezone=True),
               nullable=True,
               existing_server_default=sa.text('now()'))
    op.alter_column('fields', 'created_at',
               existing_type=postgresql.TIMESTAMP(timezone=True),
               nullable=True,
               existing_server_default=sa.text('now()'))
    op.drop_column('fields', 'geometry')
    op.create_index(op.f('idx_field_book_traits_org_id'), 'field_book_traits', ['organization_id'], unique=False)
    op.create_index(op.f('idx_field_book_studies_org_id'), 'field_book_studies', ['organization_id'], unique=False)
    op.create_index(op.f('idx_field_book_observations_org_id'), 'field_book_observations', ['organization_id'], unique=False)
    op.create_index(op.f('idx_field_book_entries_org_id'), 'field_book_entries', ['organization_id'], unique=False)
    op.drop_index(op.f('ix_fertilizer_recommendations_soil_test_id'), table_name='fertilizer_recommendations')
    op.drop_index(op.f('ix_fertilizer_recommendations_id'), table_name='fertilizer_recommendations')
    op.drop_index(op.f('ix_fertilizer_recommendations_field_id'), table_name='fertilizer_recommendations')
    op.drop_index('ix_fert_rec_org_field', table_name='fertilizer_recommendations')
    op.drop_index('ix_fert_rec_org_date', table_name='fertilizer_recommendations')
    op.drop_index('ix_fert_rec_org_crop', table_name='fertilizer_recommendations')
    op.alter_column('fertilizer_recommendations', 'updated_at',
               existing_type=postgresql.TIMESTAMP(timezone=True),
               nullable=True,
               existing_server_default=sa.text('now()'))
    op.alter_column('fertilizer_recommendations', 'created_at',
               existing_type=postgresql.TIMESTAMP(timezone=True),
               nullable=True,
               existing_server_default=sa.text('now()'))
    op.alter_column('fertilizer_recommendations', 'notes',
               existing_type=sa.TEXT(),
               comment=None,
               existing_comment='Additional recommendations or caveats',
               existing_nullable=True)
    op.alter_column('fertilizer_recommendations', 'valid_until',
               existing_type=sa.DATE(),
               comment=None,
               existing_comment='Recommendation expiration date',
               existing_nullable=True)
    op.alter_column('fertilizer_recommendations', 'recommendation_date',
               existing_type=sa.DATE(),
               comment=None,
               existing_comment='Date recommendation was generated',
               existing_nullable=False)
    op.alter_column('fertilizer_recommendations', 'currency',
               existing_type=sa.VARCHAR(length=3),
               comment=None,
               existing_comment='ISO 4217 currency code',
               existing_nullable=True,
               existing_server_default=sa.text("'USD'::character varying"))
    op.alter_column('fertilizer_recommendations', 'estimated_cost',
               existing_type=sa.DOUBLE_PRECISION(precision=53),
               comment=None,
               existing_comment='Total estimated fertilizer cost',
               existing_nullable=True)
    op.alter_column('fertilizer_recommendations', 'application_timing',
               existing_type=postgresql.JSONB(astext_type=sa.Text()),
               comment=None,
               existing_comment='Split application schedule with timing and amounts',
               existing_nullable=True)
    op.alter_column('fertilizer_recommendations', 'zn_kg_ha',
               existing_type=sa.DOUBLE_PRECISION(precision=53),
               comment=None,
               existing_comment='Zinc recommendation in kg/ha',
               existing_nullable=True,
               existing_server_default=sa.text("'0'::double precision"))
    op.alter_column('fertilizer_recommendations', 's_kg_ha',
               existing_type=sa.DOUBLE_PRECISION(precision=53),
               comment=None,
               existing_comment='Sulfur recommendation in kg/ha',
               existing_nullable=True,
               existing_server_default=sa.text("'0'::double precision"))
    op.alter_column('fertilizer_recommendations', 'k_kg_ha',
               existing_type=sa.DOUBLE_PRECISION(precision=53),
               comment=None,
               existing_comment='Potassium (K2O) recommendation in kg/ha',
               existing_nullable=False,
               existing_server_default=sa.text("'0'::double precision"))
    op.alter_column('fertilizer_recommendations', 'p_kg_ha',
               existing_type=sa.DOUBLE_PRECISION(precision=53),
               comment=None,
               existing_comment='Phosphorus (P2O5) recommendation in kg/ha',
               existing_nullable=False,
               existing_server_default=sa.text("'0'::double precision"))
    op.alter_column('fertilizer_recommendations', 'n_kg_ha',
               existing_type=sa.DOUBLE_PRECISION(precision=53),
               comment=None,
               existing_comment='Nitrogen recommendation in kg/ha',
               existing_nullable=False,
               existing_server_default=sa.text("'0'::double precision"))
    op.alter_column('fertilizer_recommendations', 'yield_unit',
               existing_type=sa.VARCHAR(length=20),
               comment=None,
               existing_comment='Unit for yield (t/ha, kg/ha, bu/ac)',
               existing_nullable=False,
               existing_server_default=sa.text("'t/ha'::character varying"))
    op.alter_column('fertilizer_recommendations', 'target_yield',
               existing_type=sa.DOUBLE_PRECISION(precision=53),
               comment=None,
               existing_comment='Target yield value',
               existing_nullable=False)
    op.drop_index(op.f('ix_events_organization_id'), table_name='events')
    op.drop_index(op.f('ix_events_event_type'), table_name='events')
    op.drop_index(op.f('ix_events_event_db_id'), table_name='events')
    op.create_index(op.f('ix_events_type'), 'events', ['event_type'], unique=False)
    op.create_index(op.f('ix_events_org_id'), 'events', ['organization_id'], unique=False)
    op.create_index(op.f('ix_events_db_id'), 'events', ['event_db_id'], unique=True)
    op.create_index(op.f('idx_events_org_id'), 'events', ['organization_id'], unique=False)
    op.alter_column('events', 'updated_at',
               existing_type=sa.DateTime(timezone=True),
               type_=postgresql.TIMESTAMP(),
               existing_nullable=False)
    op.alter_column('events', 'created_at',
               existing_type=sa.DateTime(timezone=True),
               type_=postgresql.TIMESTAMP(),
               existing_nullable=False)
    op.drop_index(op.f('ix_emission_sources_id'), table_name='emission_sources')
    op.drop_index(op.f('ix_emission_factors_id'), table_name='emission_factors')
    op.drop_index(op.f('ix_dus_trials_trial_code'), table_name='dus_trials')
    op.drop_index(op.f('ix_dus_trials_id'), table_name='dus_trials')
    op.create_unique_constraint(op.f('dus_trials_trial_code_key'), 'dus_trials', ['trial_code'], postgresql_nulls_not_distinct=False)
    op.drop_index(op.f('ix_dus_scores_id'), table_name='dus_scores')
    op.drop_index(op.f('ix_dus_entries_id'), table_name='dus_entries')
    op.drop_index(op.f('ix_dispatches_id'), table_name='dispatches')
    op.drop_index(op.f('ix_dispatches_dispatch_number'), table_name='dispatches')
    op.create_unique_constraint(op.f('dispatches_dispatch_number_key'), 'dispatches', ['dispatch_number'], postgresql_nulls_not_distinct=False)
    op.drop_index(op.f('ix_dispatch_items_id'), table_name='dispatch_items')
    op.create_index(op.f('idx_diseases_org_id'), 'diseases', ['organization_id'], unique=False)
    op.drop_constraint(None, 'disease_risk_forecasts', type_='foreignkey')
    op.drop_constraint(None, 'disease_risk_forecasts', type_='foreignkey')
    op.create_foreign_key(op.f('disease_risk_forecasts_location_id_fkey'), 'disease_risk_forecasts', 'locations', ['location_id'], ['id'], ondelete='SET NULL')
    op.create_foreign_key(op.f('disease_risk_forecasts_organization_id_fkey'), 'disease_risk_forecasts', 'organizations', ['organization_id'], ['id'], ondelete='CASCADE')
    op.drop_index(op.f('ix_disease_risk_forecasts_location_id'), table_name='disease_risk_forecasts')
    op.drop_index(op.f('ix_disease_risk_forecasts_id'), table_name='disease_risk_forecasts')
    op.drop_index(op.f('ix_disease_risk_forecasts_crop_name'), table_name='disease_risk_forecasts')
    op.alter_column('disease_risk_forecasts', 'updated_at',
               existing_type=postgresql.TIMESTAMP(timezone=True),
               nullable=True,
               existing_server_default=sa.text('now()'))
    op.alter_column('disease_risk_forecasts', 'created_at',
               existing_type=postgresql.TIMESTAMP(timezone=True),
               nullable=True,
               existing_server_default=sa.text('now()'))
    op.alter_column('disease_risk_forecasts', 'recommended_actions',
               existing_type=sa.JSON(),
               type_=postgresql.JSONB(astext_type=sa.Text()),
               existing_nullable=True)
    op.alter_column('disease_risk_forecasts', 'contributing_factors',
               existing_type=sa.JSON(),
               type_=postgresql.JSONB(astext_type=sa.Text()),
               existing_nullable=True)
    op.drop_index(op.f('ix_dh_protocols_protocol_code'), table_name='dh_protocols')
    op.drop_index(op.f('ix_dh_protocols_id'), table_name='dh_protocols')
    op.create_unique_constraint(op.f('dh_protocols_protocol_code_key'), 'dh_protocols', ['protocol_code'], postgresql_nulls_not_distinct=False)
    op.drop_index(op.f('ix_dh_batches_id'), table_name='dh_batches')
    op.drop_index(op.f('ix_dh_batches_batch_code'), table_name='dh_batches')
    op.create_unique_constraint(op.f('dh_batches_batch_code_key'), 'dh_batches', ['batch_code'], postgresql_nulls_not_distinct=False)
    op.create_index(op.f('idx_crossing_projects_org_id'), 'crossing_projects', ['organization_id'], unique=False)
    op.alter_column('crossing_projects', 'updated_at',
               existing_type=sa.DateTime(timezone=True),
               type_=postgresql.TIMESTAMP(),
               existing_nullable=False)
    op.alter_column('crossing_projects', 'created_at',
               existing_type=sa.DateTime(timezone=True),
               type_=postgresql.TIMESTAMP(),
               existing_nullable=False)
    op.create_index(op.f('idx_crosses_org_id'), 'crosses', ['organization_id'], unique=False)
    op.alter_column('crosses', 'updated_at',
               existing_type=sa.DateTime(timezone=True),
               type_=postgresql.TIMESTAMP(),
               existing_nullable=False)
    op.alter_column('crosses', 'created_at',
               existing_type=sa.DateTime(timezone=True),
               type_=postgresql.TIMESTAMP(),
               existing_nullable=False)
    op.drop_constraint(None, 'crop_suitabilities', type_='foreignkey')
    op.drop_constraint(None, 'crop_suitabilities', type_='foreignkey')
    op.create_foreign_key(op.f('crop_suitabilities_location_id_fkey'), 'crop_suitabilities', 'locations', ['location_id'], ['id'], ondelete='CASCADE')
    op.create_foreign_key(op.f('crop_suitabilities_organization_id_fkey'), 'crop_suitabilities', 'organizations', ['organization_id'], ['id'], ondelete='CASCADE')
    op.drop_index(op.f('ix_crop_suitabilities_id'), table_name='crop_suitabilities')
    op.alter_column('crop_suitabilities', 'updated_at',
               existing_type=postgresql.TIMESTAMP(timezone=True),
               nullable=True,
               existing_server_default=sa.text('now()'))
    op.alter_column('crop_suitabilities', 'created_at',
               existing_type=postgresql.TIMESTAMP(timezone=True),
               nullable=True,
               existing_server_default=sa.text('now()'))
    op.alter_column('crop_suitabilities', 'recommendations',
               existing_type=sa.JSON(),
               type_=postgresql.JSONB(astext_type=sa.Text()),
               existing_nullable=True)
    op.alter_column('crop_suitabilities', 'limiting_factors',
               existing_type=sa.JSON(),
               type_=postgresql.JSONB(astext_type=sa.Text()),
               existing_nullable=True)
    op.drop_constraint(None, 'crop_calendars', type_='foreignkey')
    op.create_foreign_key(op.f('crop_calendars_organization_id_fkey'), 'crop_calendars', 'organizations', ['organization_id'], ['id'], ondelete='CASCADE')
    op.drop_index(op.f('ix_crop_calendars_id'), table_name='crop_calendars')
    op.alter_column('crop_calendars', 'updated_at',
               existing_type=postgresql.TIMESTAMP(timezone=True),
               nullable=True,
               existing_server_default=sa.text('now()'))
    op.alter_column('crop_calendars', 'created_at',
               existing_type=postgresql.TIMESTAMP(timezone=True),
               nullable=True,
               existing_server_default=sa.text('now()'))
    op.drop_index(op.f('ix_conversations_id'), table_name='conversations')
    op.alter_column('conversations', 'updated_at',
               existing_type=sa.DateTime(timezone=True),
               type_=postgresql.TIMESTAMP(),
               existing_nullable=False,
               existing_server_default=sa.text('now()'))
    op.alter_column('conversations', 'created_at',
               existing_type=sa.DateTime(timezone=True),
               type_=postgresql.TIMESTAMP(),
               existing_nullable=False,
               existing_server_default=sa.text('now()'))
    op.drop_index(op.f('ix_conversation_participants_id'), table_name='conversation_participants')
    op.create_unique_constraint(op.f('uq_conversation_participant'), 'conversation_participants', ['conversation_id', 'user_id'], postgresql_nulls_not_distinct=False)
    op.alter_column('conversation_participants', 'updated_at',
               existing_type=sa.DateTime(timezone=True),
               type_=postgresql.TIMESTAMP(),
               existing_nullable=False,
               existing_server_default=sa.text('now()'))
    op.alter_column('conversation_participants', 'created_at',
               existing_type=sa.DateTime(timezone=True),
               type_=postgresql.TIMESTAMP(),
               existing_nullable=False,
               existing_server_default=sa.text('now()'))
    op.drop_index(op.f('ix_collaboration_workspaces_id'), table_name='collaboration_workspaces')
    op.create_index(op.f('idx_collaboration_workspaces_org_id'), 'collaboration_workspaces', ['organization_id'], unique=False)
    op.alter_column('collaboration_workspaces', 'updated_at',
               existing_type=sa.DateTime(timezone=True),
               type_=postgresql.TIMESTAMP(),
               existing_nullable=False)
    op.alter_column('collaboration_workspaces', 'created_at',
               existing_type=sa.DateTime(timezone=True),
               type_=postgresql.TIMESTAMP(),
               existing_nullable=False)
    op.drop_index(op.f('ix_collaboration_tasks_id'), table_name='collaboration_tasks')
    op.create_index(op.f('idx_collaboration_tasks_org_id'), 'collaboration_tasks', ['organization_id'], unique=False)
    op.alter_column('collaboration_tasks', 'updated_at',
               existing_type=sa.DateTime(timezone=True),
               type_=postgresql.TIMESTAMP(),
               existing_nullable=False)
    op.alter_column('collaboration_tasks', 'created_at',
               existing_type=sa.DateTime(timezone=True),
               type_=postgresql.TIMESTAMP(),
               existing_nullable=False)
    op.drop_index(op.f('ix_collaboration_comments_workspace_id'), table_name='collaboration_comments')
    op.drop_index(op.f('ix_collaboration_comments_user_id'), table_name='collaboration_comments')
    op.drop_index(op.f('ix_collaboration_comments_id'), table_name='collaboration_comments')
    op.create_index(op.f('idx_collaboration_comments_org_id'), 'collaboration_comments', ['organization_id'], unique=False)
    op.alter_column('collaboration_comments', 'updated_at',
               existing_type=sa.DateTime(timezone=True),
               type_=postgresql.TIMESTAMP(),
               existing_nullable=False)
    op.alter_column('collaboration_comments', 'created_at',
               existing_type=sa.DateTime(timezone=True),
               type_=postgresql.TIMESTAMP(),
               existing_nullable=False)
    op.drop_index(op.f('ix_collaboration_activities_id'), table_name='collaboration_activities')
    op.create_index(op.f('idx_collaboration_activities_org_id'), 'collaboration_activities', ['organization_id'], unique=False)
    op.alter_column('collaboration_activities', 'updated_at',
               existing_type=sa.DateTime(timezone=True),
               type_=postgresql.TIMESTAMP(),
               existing_nullable=False)
    op.alter_column('collaboration_activities', 'created_at',
               existing_type=sa.DateTime(timezone=True),
               type_=postgresql.TIMESTAMP(),
               existing_nullable=False)
    op.drop_index(op.f('ix_carbon_stocks_id'), table_name='carbon_stocks')
    op.drop_constraint(None, 'carbon_sequestration', type_='foreignkey')
    op.drop_constraint(None, 'carbon_sequestration', type_='foreignkey')
    op.create_foreign_key(op.f('carbon_sequestration_organization_id_fkey'), 'carbon_sequestration', 'organizations', ['organization_id'], ['id'], ondelete='CASCADE')
    op.create_foreign_key(op.f('carbon_sequestration_field_id_fkey'), 'carbon_sequestration', 'locations', ['field_id'], ['id'], ondelete='SET NULL')
    op.drop_index(op.f('ix_carbon_sequestration_id'), table_name='carbon_sequestration')
    op.drop_index(op.f('ix_carbon_sequestration_field_id'), table_name='carbon_sequestration')
    op.alter_column('carbon_sequestration', 'updated_at',
               existing_type=postgresql.TIMESTAMP(timezone=True),
               nullable=True,
               existing_server_default=sa.text('now()'))
    op.alter_column('carbon_sequestration', 'created_at',
               existing_type=postgresql.TIMESTAMP(timezone=True),
               nullable=True,
               existing_server_default=sa.text('now()'))
    op.alter_column('carbon_sequestration', 'practice_changes',
               existing_type=sa.JSON(),
               type_=postgresql.JSONB(astext_type=sa.Text()),
               existing_nullable=True)
    op.drop_index(op.f('ix_carbon_measurements_id'), table_name='carbon_measurements')
    op.drop_index(op.f('ix_calls_id'), table_name='calls')
    op.create_index(op.f('idx_calls_org_id'), 'calls', ['organization_id'], unique=False)
    op.alter_column('calls', 'updated_at',
               existing_type=sa.DateTime(timezone=True),
               type_=postgresql.TIMESTAMP(),
               nullable=True,
               existing_server_default=sa.text('now()'))
    op.alter_column('calls', 'created_at',
               existing_type=sa.DateTime(timezone=True),
               type_=postgresql.TIMESTAMP(),
               nullable=True,
               existing_server_default=sa.text('now()'))
    op.drop_index(op.f('ix_call_sets_id'), table_name='call_sets')
    op.create_index(op.f('idx_call_sets_org_id'), 'call_sets', ['organization_id'], unique=False)
    op.alter_column('call_sets', 'updated_at',
               existing_type=sa.DateTime(timezone=True),
               type_=postgresql.TIMESTAMP(),
               nullable=True,
               existing_server_default=sa.text('now()'))
    op.alter_column('call_sets', 'created_at',
               existing_type=sa.DateTime(timezone=True),
               type_=postgresql.TIMESTAMP(),
               nullable=True,
               existing_server_default=sa.text('now()'))
    op.create_index(op.f('idx_breeding_methods_org_id'), 'breeding_methods', ['organization_id'], unique=False)
    op.alter_column('breeding_methods', 'updated_at',
               existing_type=sa.DateTime(timezone=True),
               type_=postgresql.TIMESTAMP(),
               existing_nullable=False)
    op.alter_column('breeding_methods', 'created_at',
               existing_type=sa.DateTime(timezone=True),
               type_=postgresql.TIMESTAMP(),
               existing_nullable=False)
    op.create_index(op.f('ix_backups_status'), 'backups', ['status'], unique=False)
    op.create_index(op.f('ix_backups_created_at'), 'backups', ['created_at'], unique=False)
    op.create_index(op.f('ix_backups_backup_type'), 'backups', ['backup_type'], unique=False)
    op.create_index(op.f('idx_backups_org_id'), 'backups', ['organization_id'], unique=False)
    op.alter_column('backups', 'updated_at',
               existing_type=postgresql.TIMESTAMP(),
               nullable=False)
    op.alter_column('backups', 'created_at',
               existing_type=postgresql.TIMESTAMP(),
               nullable=False)
    op.drop_index(op.f('ix_ai_usage_daily_organization_id'), table_name='ai_usage_daily')
    op.drop_index(op.f('ix_ai_usage_daily_id'), table_name='ai_usage_daily')
    op.drop_constraint(None, 'activity_logs', type_='foreignkey')
    op.drop_constraint(None, 'activity_logs', type_='foreignkey')
    op.create_foreign_key(op.f('activity_logs_organization_id_fkey'), 'activity_logs', 'organizations', ['organization_id'], ['id'], ondelete='CASCADE')
    op.create_foreign_key(op.f('activity_logs_user_id_fkey'), 'activity_logs', 'users', ['user_id'], ['id'], ondelete='CASCADE')
    op.drop_index(op.f('ix_activity_logs_id'), table_name='activity_logs')
    op.create_index(op.f('ix_activity_logs_created_at'), 'activity_logs', ['created_at'], unique=False)
    op.create_index(op.f('idx_activity_logs_org_id'), 'activity_logs', ['organization_id'], unique=False)
    op.alter_column('activity_logs', 'updated_at',
               existing_type=sa.DateTime(timezone=True),
               type_=postgresql.TIMESTAMP(),
               existing_nullable=False)
    op.alter_column('activity_logs', 'created_at',
               existing_type=sa.DateTime(timezone=True),
               type_=postgresql.TIMESTAMP(),
               existing_nullable=False)
    op.create_index(op.f('idx_abiotic_stresses_org_id'), 'abiotic_stresses', ['organization_id'], unique=False)
    op.create_table('security_responses',
    sa.Column('id', sa.UUID(), autoincrement=False, nullable=False),
    sa.Column('timestamp', postgresql.TIMESTAMP(), autoincrement=False, nullable=False),
    sa.Column('action', sa.VARCHAR(length=50), autoincrement=False, nullable=False),
    sa.Column('status', sa.VARCHAR(length=20), autoincrement=False, nullable=False),
    sa.Column('target_type', sa.VARCHAR(length=20), autoincrement=False, nullable=True),
    sa.Column('target', sa.VARCHAR(length=255), autoincrement=False, nullable=True),
    sa.Column('threat_id', sa.UUID(), autoincrement=False, nullable=True),
    sa.Column('triggered_by', sa.VARCHAR(length=50), autoincrement=False, nullable=True),
    sa.Column('result', sa.TEXT(), autoincrement=False, nullable=True),
    sa.Column('duration_seconds', sa.INTEGER(), autoincrement=False, nullable=True),
    sa.Column('executed_by', sa.VARCHAR(length=255), autoincrement=False, nullable=True),
    sa.PrimaryKeyConstraint('id', name=op.f('security_responses_pkey'))
    )
    op.create_index(op.f('ix_security_responses_timestamp'), 'security_responses', ['timestamp'], unique=False)
    op.create_index(op.f('ix_security_responses_threat_id'), 'security_responses', ['threat_id'], unique=False)
    op.create_index(op.f('ix_security_responses_target'), 'security_responses', ['target'], unique=False)
    op.create_index(op.f('ix_security_responses_action'), 'security_responses', ['action'], unique=False)
    op.create_table('security_blocked',
    sa.Column('id', sa.UUID(), autoincrement=False, nullable=False),
    sa.Column('entity_type', sa.VARCHAR(length=20), autoincrement=False, nullable=False),
    sa.Column('entity_value', sa.VARCHAR(length=255), autoincrement=False, nullable=False),
    sa.Column('blocked_at', postgresql.TIMESTAMP(), autoincrement=False, nullable=False),
    sa.Column('expires_at', postgresql.TIMESTAMP(), autoincrement=False, nullable=False),
    sa.Column('reason', sa.TEXT(), autoincrement=False, nullable=True),
    sa.Column('blocked_by', sa.VARCHAR(length=255), autoincrement=False, nullable=True),
    sa.Column('threat_id', sa.UUID(), autoincrement=False, nullable=True),
    sa.PrimaryKeyConstraint('id', name=op.f('security_blocked_pkey'))
    )
    op.create_index(op.f('ix_security_blocked_expires_at'), 'security_blocked', ['expires_at'], unique=False)
    op.create_index(op.f('ix_security_blocked_entity_value'), 'security_blocked', ['entity_value'], unique=False)
    op.create_index(op.f('ix_security_blocked_entity_type'), 'security_blocked', ['entity_type'], unique=False)
    op.create_index(op.f('ix_blocked_entity'), 'security_blocked', ['entity_type', 'entity_value'], unique=True)
    op.create_table('germplasm_attribute_definitions',
    sa.Column('id', sa.INTEGER(), server_default=sa.text("nextval('germplasm_attribute_definitions_id_seq'::regclass)"), autoincrement=True, nullable=False),
    sa.Column('created_at', postgresql.TIMESTAMP(), autoincrement=False, nullable=False),
    sa.Column('updated_at', postgresql.TIMESTAMP(), autoincrement=False, nullable=False),
    sa.Column('organization_id', sa.INTEGER(), autoincrement=False, nullable=False),
    sa.Column('attribute_db_id', sa.VARCHAR(length=255), autoincrement=False, nullable=True),
    sa.Column('attribute_name', sa.VARCHAR(length=255), autoincrement=False, nullable=False),
    sa.Column('attribute_pui', sa.VARCHAR(length=255), autoincrement=False, nullable=True),
    sa.Column('attribute_description', sa.TEXT(), autoincrement=False, nullable=True),
    sa.Column('attribute_category', sa.VARCHAR(length=100), autoincrement=False, nullable=True),
    sa.Column('common_crop_name', sa.VARCHAR(length=100), autoincrement=False, nullable=True),
    sa.Column('context_of_use', postgresql.JSON(astext_type=sa.Text()), autoincrement=False, nullable=True),
    sa.Column('default_value', sa.VARCHAR(length=255), autoincrement=False, nullable=True),
    sa.Column('documentation_url', sa.TEXT(), autoincrement=False, nullable=True),
    sa.Column('growth_stage', sa.VARCHAR(length=100), autoincrement=False, nullable=True),
    sa.Column('institution', sa.VARCHAR(length=255), autoincrement=False, nullable=True),
    sa.Column('language', sa.VARCHAR(length=10), autoincrement=False, nullable=True),
    sa.Column('scientist', sa.VARCHAR(length=255), autoincrement=False, nullable=True),
    sa.Column('status', sa.VARCHAR(length=50), autoincrement=False, nullable=True),
    sa.Column('submission_timestamp', sa.VARCHAR(length=50), autoincrement=False, nullable=True),
    sa.Column('synonyms', postgresql.JSON(astext_type=sa.Text()), autoincrement=False, nullable=True),
    sa.Column('trait_db_id', sa.VARCHAR(length=255), autoincrement=False, nullable=True),
    sa.Column('trait_name', sa.VARCHAR(length=255), autoincrement=False, nullable=True),
    sa.Column('trait_description', sa.TEXT(), autoincrement=False, nullable=True),
    sa.Column('trait_class', sa.VARCHAR(length=100), autoincrement=False, nullable=True),
    sa.Column('method_db_id', sa.VARCHAR(length=255), autoincrement=False, nullable=True),
    sa.Column('method_name', sa.VARCHAR(length=255), autoincrement=False, nullable=True),
    sa.Column('method_description', sa.TEXT(), autoincrement=False, nullable=True),
    sa.Column('method_class', sa.VARCHAR(length=100), autoincrement=False, nullable=True),
    sa.Column('scale_db_id', sa.VARCHAR(length=255), autoincrement=False, nullable=True),
    sa.Column('scale_name', sa.VARCHAR(length=255), autoincrement=False, nullable=True),
    sa.Column('data_type', sa.VARCHAR(length=50), autoincrement=False, nullable=True),
    sa.Column('additional_info', postgresql.JSON(astext_type=sa.Text()), autoincrement=False, nullable=True),
    sa.Column('external_references', postgresql.JSON(astext_type=sa.Text()), autoincrement=False, nullable=True),
    sa.ForeignKeyConstraint(['organization_id'], ['organizations.id'], name='germplasm_attribute_definitions_organization_id_fkey'),
    sa.PrimaryKeyConstraint('id', name='germplasm_attribute_definitions_pkey'),
    postgresql_ignore_search_path=False
    )
    op.create_index(op.f('ix_germplasm_attribute_definitions_organization_id'), 'germplasm_attribute_definitions', ['organization_id'], unique=False)
    op.create_index(op.f('ix_germplasm_attribute_definitions_attribute_name'), 'germplasm_attribute_definitions', ['attribute_name'], unique=False)
    op.create_index(op.f('ix_germplasm_attribute_definitions_attribute_db_id'), 'germplasm_attribute_definitions', ['attribute_db_id'], unique=True)
    op.create_index(op.f('ix_germplasm_attribute_definitions_attribute_category'), 'germplasm_attribute_definitions', ['attribute_category'], unique=False)
    op.create_index(op.f('idx_germplasm_attribute_definitions_org_id'), 'germplasm_attribute_definitions', ['organization_id'], unique=False)
    op.create_table('methods',
    sa.Column('id', sa.INTEGER(), autoincrement=True, nullable=False),
    sa.Column('created_at', postgresql.TIMESTAMP(), autoincrement=False, nullable=False),
    sa.Column('updated_at', postgresql.TIMESTAMP(), autoincrement=False, nullable=False),
    sa.Column('organization_id', sa.INTEGER(), autoincrement=False, nullable=False),
    sa.Column('method_db_id', sa.VARCHAR(length=255), autoincrement=False, nullable=True),
    sa.Column('method_name', sa.VARCHAR(length=255), autoincrement=False, nullable=False),
    sa.Column('method_pui', sa.VARCHAR(length=255), autoincrement=False, nullable=True),
    sa.Column('method_class', sa.VARCHAR(length=100), autoincrement=False, nullable=True),
    sa.Column('description', sa.TEXT(), autoincrement=False, nullable=True),
    sa.Column('formula', sa.TEXT(), autoincrement=False, nullable=True),
    sa.Column('reference', sa.TEXT(), autoincrement=False, nullable=True),
    sa.Column('bibliographical_reference', sa.TEXT(), autoincrement=False, nullable=True),
    sa.Column('ontology_db_id', sa.VARCHAR(length=255), autoincrement=False, nullable=True),
    sa.Column('ontology_name', sa.VARCHAR(length=255), autoincrement=False, nullable=True),
    sa.Column('ontology_version', sa.VARCHAR(length=50), autoincrement=False, nullable=True),
    sa.Column('additional_info', postgresql.JSON(astext_type=sa.Text()), autoincrement=False, nullable=True),
    sa.Column('external_references', postgresql.JSON(astext_type=sa.Text()), autoincrement=False, nullable=True),
    sa.ForeignKeyConstraint(['organization_id'], ['organizations.id'], name=op.f('methods_organization_id_fkey')),
    sa.PrimaryKeyConstraint('id', name=op.f('methods_pkey'))
    )
    op.create_index(op.f('ix_methods_organization_id'), 'methods', ['organization_id'], unique=False)
    op.create_index(op.f('ix_methods_method_name'), 'methods', ['method_name'], unique=False)
    op.create_index(op.f('ix_methods_method_db_id'), 'methods', ['method_db_id'], unique=True)
    op.create_index(op.f('idx_methods_org_id'), 'methods', ['organization_id'], unique=False)
    op.create_table('spatial_ref_sys',
    sa.Column('srid', sa.INTEGER(), autoincrement=False, nullable=False),
    sa.Column('auth_name', sa.VARCHAR(length=256), autoincrement=False, nullable=True),
    sa.Column('auth_srid', sa.INTEGER(), autoincrement=False, nullable=True),
    sa.Column('srtext', sa.VARCHAR(length=2048), autoincrement=False, nullable=True),
    sa.Column('proj4text', sa.VARCHAR(length=2048), autoincrement=False, nullable=True),
    sa.CheckConstraint('srid > 0 AND srid <= 998999', name=op.f('spatial_ref_sys_srid_check')),
    sa.PrimaryKeyConstraint('srid', name=op.f('spatial_ref_sys_pkey'))
    )
    op.create_table('security_audit_log',
    sa.Column('id', sa.UUID(), autoincrement=False, nullable=False),
    sa.Column('timestamp', postgresql.TIMESTAMP(), autoincrement=False, nullable=False),
    sa.Column('category', sa.VARCHAR(length=50), autoincrement=False, nullable=False),
    sa.Column('severity', sa.VARCHAR(length=20), autoincrement=False, nullable=False),
    sa.Column('action', sa.VARCHAR(length=100), autoincrement=False, nullable=False),
    sa.Column('actor', sa.VARCHAR(length=255), autoincrement=False, nullable=True),
    sa.Column('target', sa.VARCHAR(length=500), autoincrement=False, nullable=True),
    sa.Column('source_ip', sa.VARCHAR(length=45), autoincrement=False, nullable=True),
    sa.Column('details', postgresql.JSON(astext_type=sa.Text()), autoincrement=False, nullable=True),
    sa.Column('success', sa.BOOLEAN(), autoincrement=False, nullable=False),
    sa.Column('user_agent', sa.VARCHAR(length=500), autoincrement=False, nullable=True),
    sa.Column('request_id', sa.VARCHAR(length=100), autoincrement=False, nullable=True),
    sa.Column('session_id', sa.VARCHAR(length=100), autoincrement=False, nullable=True),
    sa.PrimaryKeyConstraint('id', name=op.f('security_audit_log_pkey'))
    )
    op.create_index(op.f('ix_security_audit_log_timestamp'), 'security_audit_log', ['timestamp'], unique=False)
    op.create_index(op.f('ix_security_audit_log_target'), 'security_audit_log', ['target'], unique=False)
    op.create_index(op.f('ix_security_audit_log_source_ip'), 'security_audit_log', ['source_ip'], unique=False)
    op.create_index(op.f('ix_security_audit_log_severity'), 'security_audit_log', ['severity'], unique=False)
    op.create_index(op.f('ix_security_audit_log_category'), 'security_audit_log', ['category'], unique=False)
    op.create_index(op.f('ix_security_audit_log_actor'), 'security_audit_log', ['actor'], unique=False)
    op.create_index(op.f('ix_security_audit_log_action'), 'security_audit_log', ['action'], unique=False)
    op.create_index(op.f('ix_audit_timestamp_category'), 'security_audit_log', ['timestamp', 'category'], unique=False)
    op.create_index(op.f('ix_audit_source_ip_timestamp'), 'security_audit_log', ['source_ip', 'timestamp'], unique=False)
    op.create_index(op.f('ix_audit_severity_timestamp'), 'security_audit_log', ['severity', 'timestamp'], unique=False)
    op.create_index(op.f('ix_audit_actor_timestamp'), 'security_audit_log', ['actor', 'timestamp'], unique=False)
    op.create_table('germplasm_attribute_values',
    sa.Column('id', sa.INTEGER(), autoincrement=True, nullable=False),
    sa.Column('created_at', postgresql.TIMESTAMP(), autoincrement=False, nullable=False),
    sa.Column('updated_at', postgresql.TIMESTAMP(), autoincrement=False, nullable=False),
    sa.Column('organization_id', sa.INTEGER(), autoincrement=False, nullable=False),
    sa.Column('germplasm_id', sa.INTEGER(), autoincrement=False, nullable=False),
    sa.Column('attribute_definition_id', sa.INTEGER(), autoincrement=False, nullable=True),
    sa.Column('attribute_value_db_id', sa.VARCHAR(length=255), autoincrement=False, nullable=True),
    sa.Column('attribute_db_id', sa.VARCHAR(length=255), autoincrement=False, nullable=True),
    sa.Column('attribute_name', sa.VARCHAR(length=255), autoincrement=False, nullable=True),
    sa.Column('germplasm_db_id', sa.VARCHAR(length=255), autoincrement=False, nullable=True),
    sa.Column('germplasm_name', sa.VARCHAR(length=255), autoincrement=False, nullable=True),
    sa.Column('value', sa.TEXT(), autoincrement=False, nullable=False),
    sa.Column('determined_date', sa.VARCHAR(length=50), autoincrement=False, nullable=True),
    sa.Column('additional_info', postgresql.JSON(astext_type=sa.Text()), autoincrement=False, nullable=True),
    sa.Column('external_references', postgresql.JSON(astext_type=sa.Text()), autoincrement=False, nullable=True),
    sa.ForeignKeyConstraint(['attribute_definition_id'], ['germplasm_attribute_definitions.id'], name=op.f('germplasm_attribute_values_attribute_definition_id_fkey')),
    sa.ForeignKeyConstraint(['germplasm_id'], ['germplasm.id'], name=op.f('germplasm_attribute_values_germplasm_id_fkey')),
    sa.ForeignKeyConstraint(['organization_id'], ['organizations.id'], name=op.f('germplasm_attribute_values_organization_id_fkey')),
    sa.PrimaryKeyConstraint('id', name=op.f('germplasm_attribute_values_pkey'))
    )
    op.create_index(op.f('ix_germplasm_attribute_values_organization_id'), 'germplasm_attribute_values', ['organization_id'], unique=False)
    op.create_index(op.f('ix_germplasm_attribute_values_germplasm_id'), 'germplasm_attribute_values', ['germplasm_id'], unique=False)
    op.create_index(op.f('ix_germplasm_attribute_values_attribute_value_db_id'), 'germplasm_attribute_values', ['attribute_value_db_id'], unique=True)
    op.create_index(op.f('ix_germplasm_attribute_values_attribute_db_id'), 'germplasm_attribute_values', ['attribute_db_id'], unique=False)
    op.create_index(op.f('idx_germplasm_attribute_values_org_id'), 'germplasm_attribute_values', ['organization_id'], unique=False)
    op.create_table('traits',
    sa.Column('id', sa.INTEGER(), autoincrement=True, nullable=False),
    sa.Column('created_at', postgresql.TIMESTAMP(), autoincrement=False, nullable=False),
    sa.Column('updated_at', postgresql.TIMESTAMP(), autoincrement=False, nullable=False),
    sa.Column('organization_id', sa.INTEGER(), autoincrement=False, nullable=False),
    sa.Column('trait_db_id', sa.VARCHAR(length=255), autoincrement=False, nullable=True),
    sa.Column('trait_name', sa.VARCHAR(length=255), autoincrement=False, nullable=False),
    sa.Column('trait_pui', sa.VARCHAR(length=255), autoincrement=False, nullable=True),
    sa.Column('trait_description', sa.TEXT(), autoincrement=False, nullable=True),
    sa.Column('trait_class', sa.VARCHAR(length=100), autoincrement=False, nullable=True),
    sa.Column('synonyms', postgresql.JSON(astext_type=sa.Text()), autoincrement=False, nullable=True),
    sa.Column('alternative_abbreviations', postgresql.JSON(astext_type=sa.Text()), autoincrement=False, nullable=True),
    sa.Column('main_abbreviation', sa.VARCHAR(length=50), autoincrement=False, nullable=True),
    sa.Column('ontology_db_id', sa.VARCHAR(length=255), autoincrement=False, nullable=True),
    sa.Column('ontology_name', sa.VARCHAR(length=255), autoincrement=False, nullable=True),
    sa.Column('entity', sa.VARCHAR(length=255), autoincrement=False, nullable=True),
    sa.Column('attribute', sa.VARCHAR(length=255), autoincrement=False, nullable=True),
    sa.Column('status', sa.VARCHAR(length=50), autoincrement=False, nullable=True),
    sa.Column('additional_info', postgresql.JSON(astext_type=sa.Text()), autoincrement=False, nullable=True),
    sa.Column('external_references', postgresql.JSON(astext_type=sa.Text()), autoincrement=False, nullable=True),
    sa.ForeignKeyConstraint(['organization_id'], ['organizations.id'], name=op.f('traits_organization_id_fkey')),
    sa.PrimaryKeyConstraint('id', name=op.f('traits_pkey'))
    )
    op.create_index(op.f('ix_traits_trait_name'), 'traits', ['trait_name'], unique=False)
    op.create_index(op.f('ix_traits_trait_db_id'), 'traits', ['trait_db_id'], unique=True)
    op.create_index(op.f('ix_traits_organization_id'), 'traits', ['organization_id'], unique=False)
    op.create_index(op.f('idx_traits_org_id'), 'traits', ['organization_id'], unique=False)
    op.create_table('vector_documents',
    sa.Column('id', sa.INTEGER(), autoincrement=True, nullable=False),
    sa.Column('doc_id', sa.VARCHAR(), autoincrement=False, nullable=False),
    sa.Column('doc_type', sa.VARCHAR(), autoincrement=False, nullable=False),
    sa.Column('title', sa.VARCHAR(), autoincrement=False, nullable=True),
    sa.Column('content', sa.TEXT(), autoincrement=False, nullable=False),
    sa.Column('content_hash', sa.VARCHAR(), autoincrement=False, nullable=True),
    sa.Column('metadata', sa.TEXT(), autoincrement=False, nullable=True),
    sa.Column('source_id', sa.VARCHAR(), autoincrement=False, nullable=True),
    sa.Column('source_type', sa.VARCHAR(), autoincrement=False, nullable=True),
    sa.Column('created_at', postgresql.TIMESTAMP(), server_default=sa.text('now()'), autoincrement=False, nullable=True),
    sa.Column('updated_at', postgresql.TIMESTAMP(), server_default=sa.text('now()'), autoincrement=False, nullable=True),
    sa.Column('embedding', sa.NullType(), autoincrement=False, nullable=True),
    sa.PrimaryKeyConstraint('id', name=op.f('vector_documents_pkey'))
    )
    op.create_index(op.f('ix_vector_documents_source_type'), 'vector_documents', ['source_type'], unique=False)
    op.create_index(op.f('ix_vector_documents_source_id'), 'vector_documents', ['source_id'], unique=False)
    op.create_index(op.f('ix_vector_documents_embedding'), 'vector_documents', ['embedding'], unique=False, postgresql_ops={'embedding': 'vector_cosine_ops'}, postgresql_with={'lists': '100'}, postgresql_using='ivfflat')
    op.create_index(op.f('ix_vector_documents_doc_type'), 'vector_documents', ['doc_type'], unique=False)
    op.create_index(op.f('ix_vector_documents_doc_id'), 'vector_documents', ['doc_id'], unique=True)
    op.create_index(op.f('ix_vector_documents_content_hash'), 'vector_documents', ['content_hash'], unique=False)
    op.create_index(op.f('ix_vector_doc_type_source'), 'vector_documents', ['doc_type', 'source_type'], unique=False)
    op.create_table('observation_levels',
    sa.Column('id', sa.INTEGER(), autoincrement=True, nullable=False),
    sa.Column('created_at', postgresql.TIMESTAMP(), autoincrement=False, nullable=False),
    sa.Column('updated_at', postgresql.TIMESTAMP(), autoincrement=False, nullable=False),
    sa.Column('organization_id', sa.INTEGER(), autoincrement=False, nullable=False),
    sa.Column('level_name', sa.VARCHAR(length=100), autoincrement=False, nullable=False),
    sa.Column('level_code', sa.VARCHAR(length=50), autoincrement=False, nullable=True),
    sa.Column('level_order', sa.INTEGER(), autoincrement=False, nullable=False),
    sa.ForeignKeyConstraint(['organization_id'], ['organizations.id'], name=op.f('observation_levels_organization_id_fkey')),
    sa.PrimaryKeyConstraint('id', name=op.f('observation_levels_pkey'))
    )
    op.create_index(op.f('ix_observation_levels_organization_id'), 'observation_levels', ['organization_id'], unique=False)
    op.create_index(op.f('ix_observation_levels_level_name'), 'observation_levels', ['level_name'], unique=False)
    op.create_index(op.f('idx_observation_levels_org_id'), 'observation_levels', ['organization_id'], unique=False)
    op.create_table('scales',
    sa.Column('id', sa.INTEGER(), autoincrement=True, nullable=False),
    sa.Column('created_at', postgresql.TIMESTAMP(), autoincrement=False, nullable=False),
    sa.Column('updated_at', postgresql.TIMESTAMP(), autoincrement=False, nullable=False),
    sa.Column('organization_id', sa.INTEGER(), autoincrement=False, nullable=False),
    sa.Column('scale_db_id', sa.VARCHAR(length=255), autoincrement=False, nullable=True),
    sa.Column('scale_name', sa.VARCHAR(length=255), autoincrement=False, nullable=False),
    sa.Column('scale_pui', sa.VARCHAR(length=255), autoincrement=False, nullable=True),
    sa.Column('data_type', sa.VARCHAR(length=50), autoincrement=False, nullable=True),
    sa.Column('decimal_places', sa.INTEGER(), autoincrement=False, nullable=True),
    sa.Column('valid_values_min', sa.INTEGER(), autoincrement=False, nullable=True),
    sa.Column('valid_values_max', sa.INTEGER(), autoincrement=False, nullable=True),
    sa.Column('valid_values_categories', postgresql.JSON(astext_type=sa.Text()), autoincrement=False, nullable=True),
    sa.Column('ontology_db_id', sa.VARCHAR(length=255), autoincrement=False, nullable=True),
    sa.Column('ontology_name', sa.VARCHAR(length=255), autoincrement=False, nullable=True),
    sa.Column('ontology_version', sa.VARCHAR(length=50), autoincrement=False, nullable=True),
    sa.Column('additional_info', postgresql.JSON(astext_type=sa.Text()), autoincrement=False, nullable=True),
    sa.Column('external_references', postgresql.JSON(astext_type=sa.Text()), autoincrement=False, nullable=True),
    sa.ForeignKeyConstraint(['organization_id'], ['organizations.id'], name=op.f('scales_organization_id_fkey')),
    sa.PrimaryKeyConstraint('id', name=op.f('scales_pkey'))
    )
    op.create_index(op.f('ix_scales_scale_name'), 'scales', ['scale_name'], unique=False)
    op.create_index(op.f('ix_scales_scale_db_id'), 'scales', ['scale_db_id'], unique=True)
    op.create_index(op.f('ix_scales_organization_id'), 'scales', ['organization_id'], unique=False)
    op.create_index(op.f('idx_scales_org_id'), 'scales', ['organization_id'], unique=False)
    op.create_table('security_threats',
    sa.Column('id', sa.UUID(), autoincrement=False, nullable=False),
    sa.Column('timestamp', postgresql.TIMESTAMP(), autoincrement=False, nullable=False),
    sa.Column('category', sa.VARCHAR(length=50), autoincrement=False, nullable=False),
    sa.Column('confidence', sa.VARCHAR(length=20), autoincrement=False, nullable=False),
    sa.Column('confidence_score', sa.INTEGER(), autoincrement=False, nullable=False),
    sa.Column('severity', sa.VARCHAR(length=20), autoincrement=False, nullable=False),
    sa.Column('source_ip', sa.VARCHAR(length=45), autoincrement=False, nullable=True),
    sa.Column('user_id', sa.VARCHAR(length=255), autoincrement=False, nullable=True),
    sa.Column('event_id', sa.VARCHAR(length=100), autoincrement=False, nullable=True),
    sa.Column('indicators', postgresql.JSON(astext_type=sa.Text()), autoincrement=False, nullable=True),
    sa.Column('recommended_actions', postgresql.JSON(astext_type=sa.Text()), autoincrement=False, nullable=True),
    sa.Column('resolved', sa.BOOLEAN(), autoincrement=False, nullable=False),
    sa.Column('resolved_at', postgresql.TIMESTAMP(), autoincrement=False, nullable=True),
    sa.Column('resolved_by', sa.VARCHAR(length=255), autoincrement=False, nullable=True),
    sa.Column('resolution_notes', sa.TEXT(), autoincrement=False, nullable=True),
    sa.PrimaryKeyConstraint('id', name=op.f('security_threats_pkey'))
    )
    op.create_index(op.f('ix_security_threats_user_id'), 'security_threats', ['user_id'], unique=False)
    op.create_index(op.f('ix_security_threats_timestamp'), 'security_threats', ['timestamp'], unique=False)
    op.create_index(op.f('ix_security_threats_source_ip'), 'security_threats', ['source_ip'], unique=False)
    op.create_index(op.f('ix_security_threats_severity'), 'security_threats', ['severity'], unique=False)
    op.create_index(op.f('ix_security_threats_category'), 'security_threats', ['category'], unique=False)
    op.drop_index(op.f('ix_speed_breeding_batches_organization_id'), table_name='speed_breeding_batches')
    op.drop_index(op.f('ix_speed_breeding_batches_id'), table_name='speed_breeding_batches')
    op.drop_table('speed_breeding_batches')
    op.drop_index(op.f('ix_shared_items_organization_id'), table_name='shared_items')
    op.drop_index(op.f('ix_shared_items_id'), table_name='shared_items')
    op.drop_table('shared_items')
    op.drop_index(op.f('ix_proposals_user_id'), table_name='proposals')
    op.drop_index(op.f('ix_proposals_organization_id'), table_name='proposals')
    op.drop_index(op.f('ix_proposals_id'), table_name='proposals')
    op.drop_table('proposals')
    op.drop_index(op.f('ix_expenses_organization_id'), table_name='expenses')
    op.drop_index(op.f('ix_expenses_id'), table_name='expenses')
    op.drop_table('expenses')
    op.drop_index(op.f('ix_vision_deployments_organization_id'), table_name='vision_deployments')
    op.drop_index(op.f('ix_vision_deployments_id'), table_name='vision_deployments')
    op.drop_table('vision_deployments')
    op.drop_index(op.f('ix_speed_breeding_protocols_organization_id'), table_name='speed_breeding_protocols')
    op.drop_index(op.f('ix_speed_breeding_protocols_id'), table_name='speed_breeding_protocols')
    op.drop_index(op.f('ix_speed_breeding_protocols_crop'), table_name='speed_breeding_protocols')
    op.drop_table('speed_breeding_protocols')
    op.drop_index(op.f('ix_speed_breeding_chambers_organization_id'), table_name='speed_breeding_chambers')
    op.drop_index(op.f('ix_speed_breeding_chambers_id'), table_name='speed_breeding_chambers')
    op.drop_table('speed_breeding_chambers')
    op.drop_index(op.f('ix_print_jobs_status'), table_name='print_jobs')
    op.drop_index(op.f('ix_print_jobs_organization_id'), table_name='print_jobs')
    op.drop_index(op.f('ix_print_jobs_job_id'), table_name='print_jobs')
    op.drop_index(op.f('ix_print_jobs_id'), table_name='print_jobs')
    op.drop_table('print_jobs')
    op.drop_index(op.f('ix_budget_categories_organization_id'), table_name='budget_categories')
    op.drop_index(op.f('ix_budget_categories_id'), table_name='budget_categories')
    op.drop_table('budget_categories')
    op.drop_index(op.f('ix_annotation_task_items_id'), table_name='annotation_task_items')
    op.drop_table('annotation_task_items')
    op.drop_index(op.f('ix_vision_models_organization_id'), table_name='vision_models')
    op.drop_index(op.f('ix_vision_models_id'), table_name='vision_models')
    op.drop_table('vision_models')
    op.drop_index(op.f('ix_vision_annotations_reviewer_id'), table_name='vision_annotations')
    op.drop_index(op.f('ix_vision_annotations_image_id'), table_name='vision_annotations')
    op.drop_index(op.f('ix_vision_annotations_id'), table_name='vision_annotations')
    op.drop_index(op.f('ix_vision_annotations_dataset_id'), table_name='vision_annotations')
    op.drop_index(op.f('ix_vision_annotations_annotator_id'), table_name='vision_annotations')
    op.drop_table('vision_annotations')
    op.drop_index(op.f('ix_annotation_tasks_id'), table_name='annotation_tasks')
    op.drop_index(op.f('ix_annotation_tasks_dataset_id'), table_name='annotation_tasks')
    op.drop_table('annotation_tasks')
    # ### end Alembic commands ###
