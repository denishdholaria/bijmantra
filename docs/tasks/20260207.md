# BijMantra ‚Äî Path Ahead & Action Plan

**Date**: February 7, 2026  
**Baseline**: Session 93 audit (all numbers verified against codebase)  
**Version**: preview-1 Prathama  
**Build**: ‚úÖ Passing (0 TS errors, 8.9s, Vite 7.3, Node v25.2.1, Python 3.14.2)

---

## Current Position

| Dimension | Number | Health |
|-----------|--------|--------|
| Total pages | 354 (248 + 106 divisions) | ‚úÖ |
| Pages with real API calls | 172 / 248 (69%) | üü° |
| Pages returning demo data | 41 | üî¥ |
| Backend API endpoints | 1,644 | ‚úÖ |
| BrAPI v2.1 compliance | 201/201 (100%) | ‚úÖ |
| Registered routes | 325 | ‚úÖ |
| DB table definitions | 278 | ‚úÖ |
| Alembic migrations | 48 (047 added) | ‚úÖ |
| Test files | 82 (57 backend, 18 E2E, 7 frontend) | üî¥ |
| Dead code files | 0 (was 5 / 1,379 lines ‚Äî Phase 0 ‚úÖ) | ‚úÖ |
| Backend demo violators | 0 files (Phase 1 ‚úÖ) | ‚úÖ |
| Build size | 14 MB / 422 chunks | üü° |
| Chunks > 500 KB | 4 (index 1.5MB, ECharts 1.1MB, R3F 802KB, Recharts 381KB) | üü° |

### What's Working Well
- **Web-OS Shell**: Unified navigation (SystemBar, Dock, STRATA, ShellSidebar, CommandPalette, ContextMenu)
- **Veena AI**: 32 real DB functions, 16 services, cloud-only architecture, v2 sidebar + chat
- **BrAPI**: 100% v2.1 spec coverage
- **Compute**: Fortran (9 kernels: BLUP, REML, kinship, GxE, stability, LD, PCA, selection index), Rust/WASM (genomics, matrix, stats), NumPy/OpenCV
- **Multi-tenancy**: RLS on 103 tables, org-scoped data

### What Needs Attention
- **41 demo data pages** ‚Äî the single biggest credibility gap
- **Testing** ‚Äî ~10% coverage is a risk for any refactoring
- **Bundle size** ‚Äî 4 chunks > 500 KB, 2 > 1 MB
- **Dead code** ‚Äî 5 orphaned files adding noise
- **CALF audit** ‚Äî stale (Jan 9, covers 221 of 354 pages)

---

## Phased Plan

### Phase 0: Hygiene (1 session) ‚úÖ COMPLETE
> **Goal**: Clean baseline before any feature work.
> **Result**: 8 files deleted, -1,379 lines, build passing 8.91s. Commit `bbd3a7e`.

| # | Task | Files | Risk | Effort |
|---|------|-------|------|--------|
| 0.1 | Delete dead Veena files | `Veena3DFlame.tsx` (53L), `VeenaWelcome.tsx` (173L), `VoiceCommand.tsx` (404L) | None ‚Äî 0 imports each | 5 min |
| 0.2 | Delete `DesktopShortcuts.tsx` | `DesktopShortcuts.tsx` (128L) + remove from `shell/index.ts` | None ‚Äî exported but never imported | 5 min |
| 0.3 | Audit `Veena.tsx` (old FAB) | 498L ‚Äî not rendered, but referenced in many files via text search. Likely only `VeenaTrigger` (VeenaLogo) is actually imported from it | Low ‚Äî verify no runtime import | 15 min |
| 0.4 | Replace `MockDashboardService` | `useDashboard.ts` ‚Üí wire to real API or remove hook entirely | Low ‚Äî only 1 consumer | 20 min |
| 0.5 | Clean barrel exports | Remove dead re-exports from `components/ai/index.ts`, `framework/shell/index.ts` | None | 5 min |
| 0.6 | Verify build + commit | ‚Äî | ‚Äî | 5 min |

**Total**: ~1 hour. **Output**: -1,316 lines of dead code, clean import graph.

---

### Phase 1: Demo Data Eradication ‚Äî Backend (2-3 weeks)
> **Goal**: Eliminate the 4 backend files that return hardcoded demo data.

These are the **source of truth violations** ‚Äî frontend pages can't be fixed until backends return real data.

#### 1A. `warehouse.py` + `field_scanner.py` ‚Äî DB migration ‚úÖ DONE
- **Action**: ~~Replace in-memory stores with real DB queries~~ Created `StorageLocation` + `FieldScan` models, migration 047, rewrote both APIs to org-scoped DB queries. Deleted in-memory field_scanner service singleton.
- **Commit**: `0f04a49` ‚Äî 7 files changed, +609/-618 lines

#### 1B. `gwas.py` ‚Äî `get_ld_demo_data()` ‚úÖ DONE
- **Action**: ~~Wire to real LD computation~~ Deleted the `/ld/demo` endpoint entirely (56 lines of fabricated data). Real `/ld` and `/ld/pruning` compute endpoints remain.

#### 1C. `pedigree.py` ‚Äî hardcoded `organization_id` ‚úÖ DONE
- **Action**: ~~Replace with `current_user.organization_id` from auth dependency~~ Done in `0662c4c`

#### 1D. `devguru.py` ‚Äî hardcoded user ‚úÖ DONE
- **Action**: ~~Replace with `current_user` from auth dependency~~ Done in `0662c4c`

#### 1E. `import_api.py` ‚Äî ‚úÖ ALREADY CLEAN
- **Finding**: File already uses `current_user.organization_id` throughout. No `DEFAULT_ORG_ID` found. CRITICAL_TODOS.md was stale.

#### 1F. `data_visualization.py` ‚Äî ‚úÖ ALREADY CLEAN
- **Finding**: Already returns honest empty results ("charts table not yet created"). Data source counts use real DB queries. Fixed in Session 77.

#### 1G. `collaboration.py` ‚Äî hardcoded zero stats ‚úÖ DONE
- **Action**: ~~Implement real COUNT queries~~ Done in `0662c4c`. Queries SharedItem + CollaborationActivity tables.

---

### Phase 2: Demo Data Eradication ‚Äî Frontend (3-4 weeks)
> **Goal**: Fix the 41 CALF-2 pages so they query real backend endpoints.

Grouped by domain for efficient batching (shared API patterns):

#### 2A. BrAPI Genotyping (12 pages) ‚Äî Highest volume
| Page | Route | Backend Endpoint |
|------|-------|-----------------|
| Variants | `/variants` | `/brapi/v2/variants` |
| Variant Sets | `/variantsets` | `/brapi/v2/variantsets` |
| Allele Matrix | `/allelematrix` | `/brapi/v2/allelematrix` |
| Calls | `/calls` | `/brapi/v2/calls` |
| Call Sets | `/callsets` | `/brapi/v2/callsets` |
| Plates | `/plates` | `/brapi/v2/plates` |
| Marker Positions | `/markerpositions` | `/brapi/v2/markerpositions` |
| Reference Sets | `/references` | `/brapi/v2/referencesets` |
| Genome Maps | `/genomemaps` | `/brapi/v2/maps` |
| Genetic Map | `/genetic-map` | `/api/v2/genetic-map` |
| Linkage Disequilibrium | `/linkage-disequilibrium` | `/api/v2/ld` |
| Haplotype Analysis | `/haplotype-analysis` | `/api/v2/haplotype` |

**Pattern**: Most are BrAPI list endpoints ‚Äî wire `useQuery` + `apiClient.get()`. Backend already returns data from DB for most BrAPI endpoints.
**Effort**: 2-3 sessions (template approach ‚Äî fix one, replicate pattern)

#### 2B. Breeding Domain (10 pages)
| Page | Route |
|------|-------|
| Breeding Pipeline | `/pipeline` |
| Breeding Simulator | `/breeding-simulator` |
| Breeding History | `/breeding-history` |
| Breeding Goals | `/breeding-goals` |
| Crossing Projects | `/crossingprojects` |
| Cross Prediction | `/cross-prediction` |
| Parent Selection | `/parent-selection` |
| Molecular Breeding | `/molecular-breeding` |
| Phenomic Selection | `/phenomic-selection` |
| Disease Resistance | `/disease-resistance` |

**Pattern**: Mix of list views (wire to DB) and computational views (need algorithm backend).
**Effort**: 3-4 sessions

#### 2C. Genomics Advanced (5 pages)
| Page | Route |
|------|-------|
| Genomic Selection | `/genomic-selection` |
| Population Genetics | `/population-genetics` |
| Parentage Analysis | `/parentage-analysis` |
| Marker Assisted Selection | `/marker-assisted-selection` |
| Bioinformatics | `/bioinformatics` |

**Pattern**: These need real algorithms, not just DB wiring. Fortran kernels (kinship, BLUP) + Rust/WASM already exist.
**Effort**: 3-4 sessions (connect existing compute to API ‚Üí frontend)

#### 2D. Analytics & Environment (5 pages)
| Page | Route |
|------|-------|
| GxE Interaction | `/gxe-interaction` |
| Stability Analysis | `/stability-analysis` |
| Trial Network | `/trial-network` |
| Data Quality | `/dataquality` |
| Data Validation | `/data-validation` |

**Pattern**: GxE + Stability have Fortran kernels. Others need backend queries.
**Effort**: 2 sessions

#### 2E. Pedigree & Other (9 pages)
| Page | Route |
|------|-------|
| Pedigree 3D | `/pedigree-3d` |
| Pedigree Viewer | `/pedigree` |
| Pedigree Analysis | `/pedigree-analysis` |
| Progeny | `/progeny` |
| Sample Tracking | `/sample-tracking` |
| Speed Breeding | `/speed-breeding` |
| Doubled Haploid | `/doubled-haploid` |
| Abiotic Stress | `/abiotic-stress` |
| Phenology Tracker | `/phenology-tracker` |

**Pattern**: Pedigree has backend service (pedigree.py, just needs org_id fix). Others need backend implementations.
**Effort**: 2-3 sessions

---

### Phase 3: Testing Foundation (2-3 weeks, parallel with Phase 2)
> **Goal**: Establish minimum viable test coverage for the critical paths.

Current state: 82 test files (~10% of 556 components). This is a major risk.

| # | Task | Target | Effort |
|---|------|--------|--------|
| 3.1 | Backend API smoke tests | Cover all 201 API files with basic 200/401 checks | 3-4 sessions |
| 3.2 | Frontend component tests | Core shell components (SystemBar, Dock, ShellSidebar, VeenaSidebar) | 2 sessions |
| 3.3 | E2E critical paths | Login ‚Üí Dashboard ‚Üí Breeding ‚Üí Genomics ‚Üí Veena chat | 1-2 sessions |
| 3.4 | CI/CD pipeline | GitHub Actions: lint ‚Üí type-check ‚Üí test ‚Üí build on PR | 1 session |

**Target**: 30% coverage minimum before any production deployment.

---

### Phase 4: Performance & Bundle Optimization (1 week)
> **Goal**: No chunk > 500 KB. Total bundle < 10 MB.

| Chunk | Current | Strategy |
|-------|---------|----------|
| `index.js` | 1,545 KB | Split vendor (react, react-dom, react-router) into separate chunk |
| `EChartsWrapper.js` | 1,136 KB | Dynamic import ‚Äî only load when chart page is visited |
| `react-three-fiber.js` | 802 KB | Dynamic import ‚Äî only Pedigree 3D uses it |
| `generateCategoricalChart.js` | 381 KB | Recharts tree-shaking or replace with lighter charting |

**Action**: Add `manualChunks` in `vite.config.ts` `rollupOptions`:
```js
manualChunks: {
  'vendor-react': ['react', 'react-dom', 'react-router-dom'],
  'vendor-query': ['@tanstack/react-query'],
  'vendor-echarts': ['echarts'],
  'vendor-three': ['three', '@react-three/fiber', '@react-three/drei'],
}
```

---

### Phase 5: CALF Re-Assessment (1 week, after Phase 2)
> **Goal**: Fresh audit of all 354 pages with updated CALF levels.

The current CALF audit (Jan 9) only covers 221 pages. 133 pages (106 divisions + 27 new pages) are unaudited.

| # | Task | Effort |
|---|------|--------|
| 5.1 | Audit 106 division pages | 2 sessions |
| 5.2 | Re-audit 41 (now fixed) demo pages | 1 session |
| 5.3 | Regenerate CALF.md + CALF_PAGE_LISTING.md | 1 session |
| 5.4 | Update metrics.json with new percentages | 30 min |

---

## Timeline Summary

```
Week 1  (Feb 7-14)   ‚ñê‚ñà‚ñà‚ñà‚ñà‚ñå Phase 0 (Hygiene) + Phase 1A-1D (Backend demo fix)
Week 2  (Feb 14-21)  ‚ñê‚ñà‚ñà‚ñà‚ñà‚ñå Phase 1E-1G (Backend security/stubs) + Phase 2A start
Week 3  (Feb 21-28)  ‚ñê‚ñà‚ñà‚ñà‚ñà‚ñå Phase 2A-2B (BrAPI genotyping + Breeding pages)
Week 4  (Mar 1-7)    ‚ñê‚ñà‚ñà‚ñà‚ñà‚ñå Phase 2C-2D (Genomics advanced + Analytics)
Week 5  (Mar 7-14)   ‚ñê‚ñà‚ñà‚ñà‚ñà‚ñå Phase 2E (Pedigree + Other) + Phase 3.1 start
Week 6  (Mar 14-21)  ‚ñê‚ñà‚ñà‚ñà‚ñà‚ñå Phase 3 (Testing) + Phase 4 (Bundle optimization)
Week 7  (Mar 21-28)  ‚ñê‚ñà‚ñà‚ñà‚ñà‚ñå Phase 5 (CALF re-assessment) + preview-2 prep
Week 8  (Mar 28-Apr) ‚ñê‚ñà‚ñà‚ñà‚ñà‚ñå preview-2 release candidate
```

---

## Success Criteria for preview-2

| Criterion | Target |
|-----------|--------|
| Demo data pages | 0 (down from 41) |
| Backend demo violators | 0 (down from 4) |
| Dead code files | 0 (down from 5) |
| Test coverage | ‚â• 30% |
| Largest chunk | < 500 KB |
| Total bundle | < 10 MB |
| CALF audit coverage | 354/354 pages |
| Zero Mock Data Policy | Fully compliant |

---

## Compute Engine Status (Reference)

### Fortran Kernels (9 files)
| Kernel | File | Used By |
|--------|------|---------|
| BLUP Solver | `blup_solver.f90` | Genomic selection, breeding values |
| REML Engine | `reml_engine.f90` | Variance component estimation |
| Kinship | `kinship.f90` | Relationship matrices |
| GxE Analysis | `gxe_analysis.f90` | Genotype √ó Environment |
| Stability Analysis | `stability_analysis.f90` | Eberhart-Russell, AMMI |
| LD Analysis | `ld_analysis.f90` | Linkage disequilibrium |
| PCA/SVD | `pca_svd.f90` | Population structure |
| Selection Index | `selection_index.f90` | Multi-trait selection |
| C Interface | `c_interface.f90` | FFI bindings |

### Rust/WASM (9 files)
| Module | File | Used By |
|--------|------|---------|
| Genomics | `genomics.rs` | Browser-side genotype processing |
| Matrix | `matrix.rs` | GRM computation |
| Statistics | `statistics.rs` | Summary stats |
| Population | `population.rs` | Pop gen metrics |
| Sequence | `sequence.rs` | Sequence analysis |
| Python Bindings | `python_bindings.rs` | PyO3 bridge |
| Fortran FFI | `fortran_ffi.rs` | Calls Fortran kernels |

### Frontend WASM Bindings
`frontend/src/wasm/` ‚Äî `hooks.ts`, `index.ts`, `types.ts` + `pkg/` (compiled output)

---

## Division Pages Inventory (106 total, unaudited)

| Division | Pages | Notes |
|----------|-------|-------|
| commercial | 6 | Business/licensing pages |
| future | 19 | Speculative/R&D modules |
| integrations | 3 | External system connectors |
| knowledge | 12 | Documentation/learning |
| plant-sciences | 7 | Core science pages |
| seed-bank | 19 | Gene bank management |
| seed-operations | 19 | Seed production/processing |
| sensor-networks | 9 | IoT/field sensors |
| space-research | 6 | Remote sensing/satellite |
| sun-earth-systems | 6 | Climate/solar models |

---

## Risk Register

| Risk | Likelihood | Impact | Mitigation |
|------|-----------|--------|------------|
| Demo data eradication breaks existing E2E tests | High | Medium | Run E2E suite after each batch of page fixes |
| Fortran/Rust kernels don't compile on CI | Medium | High | Add compute compilation to CI matrix |
| Bundle optimization breaks lazy loading | Low | High | Verify all routes load after chunk splitting |
| CALF re-assessment reveals more issues | High | Low | Expected ‚Äî the audit is meant to surface truth |
| Phase 2 blocked by missing DB seeders | Medium | High | Ensure demo org has representative data before page wiring |

---

*This plan is a living document. Update after each phase completion.*  
*Source of truth: `metrics.json` ¬∑ State: `.kiro/steering/STATE.md`*
